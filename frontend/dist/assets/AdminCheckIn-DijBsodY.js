import{d as O,b as H,n as Y,p as G,e as J,r as u,f as K,o as W,B as X,_ as Z,g as o,h as i,j as c,i as e,q as E,v as $,F as S,s as N,t as d,x as ee,k as D,w as M,m as j,y as L,l as se}from"./index-GOY9N8V9.js";const te=O({__name:"AdminCheckIn",setup(A,{expose:a}){a();const w=H(),s=Y(),b=G(),g=J(),r=u([]),y=u(""),f=u(null),v=u(""),m=u([]),h=u(null),C=u(!1),I=u(!1),k=u(null),x=u(""),P=u([]),F=K(()=>b.canManage("CheckIn")||b.isExecBoard()||b.isAdmin());W(async()=>{await T()});const T=async()=>{try{const n=await w.fetchEvents();r.value=n.filter(p=>p.attendanceType==="SOFT")}catch(n){console.error("Failed to load events:",n),g.error("Failed to load events")}},Q=()=>{f.value=r.value.find(n=>n.id===y.value)||null,U(),_(),P.value=[]},z=async()=>{if(!v.value.trim()){m.value=[];return}C.value=!0;try{const n=await s.searchUsers(v.value);m.value=n}catch(n){console.error("Failed to search users:",n),g.error("Failed to search users"),m.value=[]}finally{C.value=!1}},q=n=>{h.value=n,v.value="",m.value=[],_()},U=()=>{h.value=null,v.value="",m.value=[],_()},_=()=>{k.value=null,x.value=""},V={eventStore:w,userStore:s,permissions:b,toast:g,events:r,selectedEventId:y,selectedEvent:f,searchQuery:v,searchResults:m,selectedUser:h,searching:C,checkInLoading:I,checkInStatus:k,checkInMessage:x,recentCheckIns:P,canCheckInUsers:F,loadEvents:T,onEventChange:Q,searchUsers:z,selectUser:q,clearSelection:U,clearCheckInStatus:_,checkInUser:async()=>{var n,p,R,B;if(!(!h.value||!f.value)){I.value=!0,_();try{const t=await w.checkInUser(f.value.id,h.value.id);if(t.success)k.value="success",x.value=`${h.value.displayName||`${h.value.firstName} ${h.value.lastName}`} has been checked in successfully!`,P.value.unshift({id:Date.now().toString(),userId:h.value.id,user:t.user||h.value,checkedInAt:new Date().toISOString()}),U(),g.success(x.value);else{k.value="error";let l=t.message||"Check-in failed";t.message&&t.message.includes("already checked in")?(k.value="already-checked-in",l="This user has already checked in to this event."):t.message&&t.message.includes("requires manual RSVP")?l="This event requires the user to RSVP first. Please RSVP them to the event before checking in.":t.message&&t.message.includes("full and has no waitlist")?l="This event is full and has no waitlist. Please RSVP the user manually first.":t.message&&t.message.includes("not eligible to RSVP")?l="The user is not eligible to RSVP to this event. Please RSVP them manually first.":t.message&&t.message.includes("would be placed on the waitlist")?l="This event is full and the user would be placed on the waitlist. Please RSVP them manually first to join the waitlist.":t.message&&t.message.includes("on the waitlist")?l="The user is on the waitlist for this event. Please wait for confirmation before checking in.":t.message&&t.message.includes("RSVP is declined")?l="The user's RSVP for this event is declined. Please RSVP them again if they want to attend.":t.message&&t.message.includes("RSVP status")&&(l="The user's RSVP status prevents check-in. Please update their RSVP first."),x.value=l,g.error(l)}}catch(t){console.error("Failed to check in user:",t),k.value="error";let l="An unexpected error occurred. Please try again.";((n=t==null?void 0:t.response)==null?void 0:n.status)===401?l="You need to be logged in to check in users. Please log in and try again.":((p=t==null?void 0:t.response)==null?void 0:p.status)===403?l="You do not have permission to check in users to this event.":((R=t==null?void 0:t.response)==null?void 0:R.status)===404?l="Event or user not found. Please check your selection and try again.":((B=t==null?void 0:t.response)==null?void 0:B.status)>=500&&(l="Server error occurred. Please try again later."),x.value=l,g.error(l)}finally{I.value=!1}}},formatDate:n=>n?new Date(n).toLocaleDateString():"TBD",formatTime:n=>n?new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"TBD",formatDateTime:n=>new Date(n).toLocaleString(),BaseButton:X};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}}),ae={class:"space-y-6"},re={class:"bg-gray-800 shadow rounded-lg border border-gray-700"},ne={class:"px-4 py-5 sm:p-6"},le={class:"space-y-4"},oe=["value"],ie={key:0,class:"bg-gray-800 shadow rounded-lg border border-gray-700"},ce={class:"px-4 py-5 sm:p-6"},de={class:"text-lg leading-6 font-medium text-gray-100 mb-4"},ue={class:"mb-6"},he={class:"relative"},me={key:0,class:"mt-2 max-h-60 overflow-y-auto border border-gray-600 rounded-lg bg-gray-700"},ve=["onClick"],ge={class:"flex items-center justify-between"},fe={class:"text-sm font-medium text-gray-100"},ye={class:"text-xs text-gray-400"},ke={class:"text-xs text-gray-500"},xe={class:"mt-2 text-sm text-gray-400 text-center py-2"},be={key:0,class:"space-y-4"},_e={class:"bg-gray-700 rounded-lg p-4"},Se={class:"flex items-center justify-between"},we={class:"text-sm font-medium text-gray-100"},pe={class:"text-xs text-gray-400"},Ce={class:"flex items-center"},Ie={key:0,class:"flex-shrink-0"},Pe={key:1,class:"flex-shrink-0"},Ue={key:2,class:"flex-shrink-0"},Ne={class:"ml-3"},Te={key:1,class:"mt-8"},Ve={class:"space-y-2"},Re={class:"text-sm font-medium text-gray-100"},Be={class:"text-xs text-gray-400"},Ee={class:"text-xs text-gray-500"};function De(A,a,w,s,b,g){return i(),o("div",ae,[c(" Page Header "),a[14]||(a[14]=e("div",{class:"sm:flex sm:items-center sm:justify-between"},[e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-100"},"Admin Check-In"),e("p",{class:"mt-2 text-sm text-gray-400"}," Check in users to events (Admin/Executive Board only) ")])],-1)),c(" Event Selection "),e("div",re,[e("div",ne,[a[4]||(a[4]=e("h3",{class:"text-lg leading-6 font-medium text-gray-100 mb-4"},"Select Event",-1)),e("div",le,[e("div",null,[a[3]||(a[3]=e("label",{for:"event-select",class:"block text-sm font-medium text-gray-300 mb-2"}," Choose an event to check users into ",-1)),E(e("select",{id:"event-select","onUpdate:modelValue":a[0]||(a[0]=r=>s.selectedEventId=r),onChange:s.onEventChange,class:"block w-full px-3 py-2 border border-gray-600 rounded-lg bg-gray-700 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[a[2]||(a[2]=e("option",{value:""},"Select an event...",-1)),(i(!0),o(S,null,N(s.events,r=>(i(),o("option",{key:r.id,value:r.id},d(r.title)+" - "+d(s.formatDate(r.startTime))+" at "+d(s.formatTime(r.startTime)),9,oe))),128))],544),[[$,s.selectedEventId]])])])])]),c(" User Search and Check-in "),s.selectedEvent?(i(),o("div",ie,[e("div",ce,[e("h3",de," Check In Users to: "+d(s.selectedEvent.title),1),c(" User Search "),e("div",ue,[a[6]||(a[6]=e("label",{for:"user-search",class:"block text-sm font-medium text-gray-300 mb-2"}," Search for users to check in ",-1)),e("div",he,[E(e("input",{id:"user-search","onUpdate:modelValue":a[1]||(a[1]=r=>s.searchQuery=r),onInput:s.searchUsers,type:"text",placeholder:"Search by name or email...",class:"block w-full px-3 py-2 pl-10 border border-gray-600 rounded-lg bg-gray-700 text-gray-100 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,544),[[ee,s.searchQuery]]),a[5]||(a[5]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),c(" Search Results "),s.searchResults.length>0?(i(),o("div",me,[(i(!0),o(S,null,N(s.searchResults,r=>(i(),o("div",{key:r.id,onClick:y=>s.selectUser(r),class:"px-3 py-2 hover:bg-gray-600 cursor-pointer border-b border-gray-600 last:border-b-0"},[e("div",ge,[e("div",null,[e("div",fe,d(r.displayName||`${r.firstName} ${r.lastName}`),1),e("div",ye,d(r.email),1)]),e("div",ke,d(r.role),1)])],8,ve))),128))])):s.searchQuery&&!s.searching?(i(),o(S,{key:1},[c(" No Results "),e("div",xe,' No users found matching "'+d(s.searchQuery)+'" ',1)],2112)):c("v-if",!0)]),c(" Selected User Check-in "),s.selectedUser?(i(),o("div",be,[e("div",_e,[a[8]||(a[8]=e("h4",{class:"text-sm font-medium text-gray-300 mb-2"},"Selected User",-1)),e("div",Se,[e("div",null,[e("div",we,d(s.selectedUser.displayName||`${s.selectedUser.firstName} ${s.selectedUser.lastName}`),1),e("div",pe,d(s.selectedUser.email),1)]),D(s.BaseButton,{onClick:s.clearSelection,variant:"outline",size:"sm"},{default:M(()=>a[7]||(a[7]=[j(" Clear ",-1)])),_:1,__:[7]})])]),c(" Check-in Status "),s.checkInStatus?(i(),o("div",{key:0,class:L(["rounded-lg p-4",{"bg-green-900 border border-green-700":s.checkInStatus==="success","bg-red-900 border border-red-700":s.checkInStatus==="error","bg-yellow-900 border border-yellow-700":s.checkInStatus==="already-checked-in"}])},[e("div",Ce,[s.checkInStatus==="success"?(i(),o("div",Ie,a[9]||(a[9]=[e("svg",{class:"h-5 w-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):s.checkInStatus==="error"?(i(),o("div",Pe,a[10]||(a[10]=[e("svg",{class:"h-5 w-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):(i(),o("div",Ue,a[11]||(a[11]=[e("svg",{class:"h-5 w-5 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)]))),e("div",Ne,[e("p",{class:L(["text-sm font-medium",{"text-green-400":s.checkInStatus==="success","text-red-400":s.checkInStatus==="error","text-yellow-400":s.checkInStatus==="already-checked-in"}])},d(s.checkInMessage),3)])])],2)):c("v-if",!0),c(" Check-in Button "),D(s.BaseButton,{onClick:s.checkInUser,variant:"primary",loading:s.checkInLoading,disabled:!s.selectedUser,class:"w-full"},{default:M(()=>[j(" Check In "+d(s.selectedUser.displayName||`${s.selectedUser.firstName} ${s.selectedUser.lastName}`),1)]),_:1},8,["loading","disabled"])])):c("v-if",!0),c(" Recent Check-ins "),s.recentCheckIns.length>0?(i(),o("div",Te,[a[12]||(a[12]=e("h4",{class:"text-sm font-medium text-gray-300 mb-4"},"Recent Check-ins",-1)),e("div",Ve,[(i(!0),o(S,null,N(s.recentCheckIns,r=>{var y,f,v,m;return i(),o("div",{key:r.id,class:"flex items-center justify-between bg-gray-700 rounded-lg p-3"},[e("div",null,[e("div",Re,d(((y=r.user)==null?void 0:y.displayName)||`${(f=r.user)==null?void 0:f.firstName} ${(v=r.user)==null?void 0:v.lastName}`),1),e("div",Be,d((m=r.user)==null?void 0:m.email),1)]),e("div",Ee,d(s.formatDateTime(r.checkedInAt)),1)])}),128))])])):c("v-if",!0)])])):(i(),o(S,{key:1},[c(" No Event Selected "),a[13]||(a[13]=se('<div class="bg-gray-800 shadow rounded-lg border border-gray-700"><div class="px-4 py-5 sm:p-6 text-center"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><h3 class="mt-2 text-sm font-medium text-gray-100">No Event Selected</h3><p class="mt-1 text-sm text-gray-400">Please select an event above to begin checking in users.</p></div></div>',1))],2112))])}const Qe=Z(te,[["render",De],["__file","/workspace/frontend/src/pages/checkin/AdminCheckIn.vue"]]);export{Qe as default};
