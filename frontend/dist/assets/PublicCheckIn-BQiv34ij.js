import{d as P,u as j,a as M,b as R,c as F,e as V,r as y,f as Y,o as N,B as Q,_ as A,g as l,h as r,i as t,j as c,F as B,k as C,t as d,l as E,w as I,m as h}from"./index-CRW-1zzX.js";const z=P({__name:"PublicCheckIn",setup(L,{expose:e}){e();const p=j(),s=M(),x=R(),m=F(),b=V(),f=y(null),w=y(!1),_=y(!1),u=y("idle"),v=y(""),S=Y(()=>p.params.code);N(async()=>{await D()});const D=async()=>{var i,g,k;try{w.value=!0;const a=await x.fetchEventByCheckInCode(S.value);f.value=a,(i=a.checkIns)!=null&&i.some(n=>{var o;return n.userId===((o=m.user)==null?void 0:o.id)})&&(u.value="already-checked-in")}catch(a){console.error("Failed to load event:",a),f.value=null,((g=a==null?void 0:a.response)==null?void 0:g.status)===404?v.value="Event not found. The check-in code may be invalid or the event may have been removed.":((k=a==null?void 0:a.response)==null?void 0:k.status)===401?v.value="You need to be logged in to access this check-in page.":v.value="Failed to load event details. Please check your connection and try again."}finally{w.value=!1}},T={route:p,router:s,eventStore:x,authStore:m,toast:b,event:f,loading:w,checkInLoading:_,checkInStatus:u,errorMessage:v,checkInCode:S,loadEvent:D,checkIn:async()=>{var i,g,k,a;if(!(!f.value||!m.user)){_.value=!0;try{const n=await x.checkInUser(f.value.id,m.user.id);if(console.log("Check-in result:",n),n.success)u.value="success",b.success("Successfully checked in to the event! You were automatically RSVP'd.");else{u.value="error";let o=n.message||"Check-in failed";console.log("Original error message:",n.message),n.message&&n.message.includes("already checked in")?(o="You have already checked in to this event.",u.value="already-checked-in"):n.message&&n.message.includes("not found")?o="Event not found. Please check the QR code and try again.":n.message&&n.message.includes("Invalid QR code")&&(o="Invalid QR code. Please scan the correct QR code for this event."),v.value=o,b.error(o)}}catch(n){console.error("Failed to check in:",n),u.value="error";let o="An unexpected error occurred. Please try again.";((i=n==null?void 0:n.response)==null?void 0:i.status)===401?o="You need to be logged in to check in. Please log in and try again.":((g=n==null?void 0:n.response)==null?void 0:g.status)===403?o="You do not have permission to check in to this event.":((k=n==null?void 0:n.response)==null?void 0:k.status)===404?o="Event not found. Please check the QR code and try again.":((a=n==null?void 0:n.response)==null?void 0:a.status)>=500&&(o="Server error occurred. Please try again later."),v.value=o,b.error(o)}finally{_.value=!1}}},goBack:()=>{s.push("/dashboard")},formatDate:i=>i?new Date(i).toLocaleDateString():"TBD",formatTime:i=>i?new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"TBD",BaseButton:Q};return Object.defineProperty(T,"__isScriptSetup",{enumerable:!1,value:!0}),T}}),O={class:"min-h-screen bg-gray-900 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"},U={class:"max-w-md w-full space-y-8"},q={key:0,class:"text-center"},G={class:"bg-gray-800 shadow rounded-lg border border-gray-700 p-8"},H={class:"text-center"},J={class:"text-3xl font-bold text-gray-100 mb-2"},K={class:"text-gray-400 mb-6"},W={key:0,class:"mb-6"},X={key:1,class:"mb-6"},Z={class:"text-gray-300"},$={key:2,class:"mb-6"},ee={class:"mb-6"},te={class:"text-left bg-gray-700 rounded-lg p-4 mb-6"},se={class:"space-y-2 text-sm text-gray-300"},ne={key:0},oe={class:"text-center"},ae={class:"text-gray-400 mb-6"};function ie(L,e,p,s,x,m){return r(),l("div",O,[t("div",U,[c(" Loading State "),s.loading?(r(),l("div",q,e[0]||(e[0]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),t("p",{class:"mt-4 text-sm text-gray-400"},"Loading event...",-1)]))):s.event?(r(),l(B,{key:1},[c(" Event Check-in Form "),t("div",G,[t("div",H,[t("h2",J,d(s.event.title),1),t("p",K,d(s.formatDate(s.event.startTime))+" at "+d(s.formatTime(s.event.startTime)),1),c(" Check-in Status "),s.checkInStatus==="success"?(r(),l("div",W,e[1]||(e[1]=[E('<div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div><h3 class="text-xl font-semibold text-green-400 mb-2">Check-in Successful!</h3><p class="text-gray-300">You have been checked in to this event and automatically RSVP&#39;d.</p>',3)]))):s.checkInStatus==="error"?(r(),l("div",X,[e[2]||(e[2]=t("div",{class:"w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4"},[t("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1)),e[3]||(e[3]=t("h3",{class:"text-xl font-semibold text-red-400 mb-2"},"Check-in Failed",-1)),t("p",Z,d(s.errorMessage),1)])):s.checkInStatus==="already-checked-in"?(r(),l("div",$,e[4]||(e[4]=[E('<div class="w-16 h-16 bg-yellow-600 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div><h3 class="text-xl font-semibold text-yellow-400 mb-2">Already Checked In</h3><p class="text-gray-300">You have already checked in to this event.</p>',3)]))):(r(),l(B,{key:3},[c(" Check-in Button "),t("div",ee,[C(s.BaseButton,{onClick:s.checkIn,variant:"primary",size:"lg",loading:s.checkInLoading,class:"w-full"},{default:I(()=>e[5]||(e[5]=[h(" Check In to Event ",-1)])),_:1,__:[5]},8,["loading"])])],2112)),c(" Event Details "),t("div",te,[e[9]||(e[9]=t("h4",{class:"text-sm font-medium text-gray-400 mb-2"},"Event Details",-1)),t("div",se,[t("div",null,[e[6]||(e[6]=t("span",{class:"font-medium"},"Category:",-1)),h(" "+d(s.event.category),1)]),t("div",null,[e[7]||(e[7]=t("span",{class:"font-medium"},"Attendance Type:",-1)),h(" "+d(s.event.attendanceType),1)]),s.event.description?(r(),l("div",ne,[e[8]||(e[8]=t("span",{class:"font-medium"},"Description:",-1)),h(" "+d(s.event.description),1)])):c("v-if",!0)])]),c(" Back Button "),C(s.BaseButton,{onClick:s.goBack,variant:"secondary",class:"w-full"},{default:I(()=>e[10]||(e[10]=[h(" Back to Dashboard ",-1)])),_:1,__:[10]})])])],2112)):(r(),l(B,{key:2},[c(" Error State "),t("div",oe,[e[12]||(e[12]=t("div",{class:"w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4"},[t("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e[13]||(e[13]=t("h3",{class:"text-xl font-semibold text-gray-100 mb-2"},"Unable to Load Event",-1)),t("p",ae,d(s.errorMessage||"The check-in code is invalid or the event doesn't exist."),1),C(s.BaseButton,{onClick:s.goBack,variant:"secondary"},{default:I(()=>e[11]||(e[11]=[h(" Back to Dashboard ",-1)])),_:1,__:[11]})])],2112))])])}const ve=A(z,[["render",ie],["__file","/workspace/frontend/src/pages/checkin/PublicCheckIn.vue"]]);export{ve as default};
