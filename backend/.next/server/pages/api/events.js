"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/events";
exports.ids = ["pages/api/events"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "bullmq":
/*!*************************!*\
  !*** external "bullmq" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("bullmq");

/***/ }),

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "zod":
/*!**********************!*\
  !*** external "zod" ***!
  \**********************/
/***/ ((module) => {

module.exports = import("zod");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fevents&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fevents%2Findex.ts&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fevents&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fevents%2Findex.ts&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_events_index_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/pages/api/events/index.ts */ \"(api)/./src/pages/api/events/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_pages_api_events_index_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_src_pages_api_events_index_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_events_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_events_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/events\",\n        pathname: \"/api/events\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_events_index_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmV2ZW50cyZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnNyYyUyRnBhZ2VzJTJGYXBpJTJGZXZlbnRzJTJGaW5kZXgudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDNEQ7QUFDNUQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLDJEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywyREFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tcm0zNjAtYmFja2VuZC8/OTk5YiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vc3JjL3BhZ2VzL2FwaS9ldmVudHMvaW5kZXgudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9ldmVudHNcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9ldmVudHNcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fevents&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fevents%2Findex.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/managers/backgroundTaskManager.ts":
/*!***********************************************!*\
  !*** ./src/managers/backgroundTaskManager.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BackgroundTaskManager: () => (/* binding */ BackgroundTaskManager)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _utils_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/utils/logger */ \"(api)/./src/utils/logger.ts\");\n\n\nclass BackgroundTaskManager {\n    constructor(prisma){\n        this.prisma = prisma;\n    }\n    async createTask(params) {\n        const { name, description, entityType, entityId, subtaskNames = [] } = params;\n        try {\n            // Create parent task\n            const parentTask = await this.prisma.backgroundTask.create({\n                data: {\n                    name,\n                    description,\n                    entityType,\n                    entityId,\n                    status: _prisma_client__WEBPACK_IMPORTED_MODULE_0__.TaskStatus.PENDING,\n                    progress: 0\n                }\n            });\n            // Create subtasks as child BackgroundTask records\n            if (subtaskNames.length > 0) {\n                await this.prisma.backgroundTask.createMany({\n                    data: subtaskNames.map((subtaskName, index)=>({\n                            name: subtaskName,\n                            parentTaskId: parentTask.id,\n                            stepIndex: index,\n                            status: _prisma_client__WEBPACK_IMPORTED_MODULE_0__.TaskStatus.PENDING,\n                            progress: 0\n                        }))\n                });\n            }\n            const fullTask = await this.prisma.backgroundTask.findUnique({\n                where: {\n                    id: parentTask.id\n                },\n                include: {\n                    subtasks: true\n                }\n            });\n            _utils_logger__WEBPACK_IMPORTED_MODULE_1__.logger.info(\"Background task created\", {\n                taskId: parentTask.id,\n                name\n            });\n            // non-null by construction\n            return fullTask;\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(\"Failed to create background task\", {\n                error,\n                name\n            });\n            throw error;\n        }\n    }\n    async markTaskRunning(taskId) {\n        await this.prisma.backgroundTask.update({\n            where: {\n                id: taskId\n            },\n            data: {\n                status: _prisma_client__WEBPACK_IMPORTED_MODULE_0__.TaskStatus.RUNNING,\n                startedAt: new Date()\n            }\n        });\n    }\n    async updateTaskProgress(taskId, progress) {\n        await this.prisma.backgroundTask.update({\n            where: {\n                id: taskId\n            },\n            data: {\n                progress\n            }\n        });\n    }\n    async markTaskCompleted(taskId, result) {\n        await this.prisma.backgroundTask.update({\n            where: {\n                id: taskId\n            },\n            data: {\n                status: _prisma_client__WEBPACK_IMPORTED_MODULE_0__.TaskStatus.COMPLETED,\n                finishedAt: new Date(),\n                progress: 100,\n                result\n            }\n        });\n    }\n    async markTaskFailed(taskId, errorMessage) {\n        await this.prisma.backgroundTask.update({\n            where: {\n                id: taskId\n            },\n            data: {\n                status: _prisma_client__WEBPACK_IMPORTED_MODULE_0__.TaskStatus.FAILED,\n                finishedAt: new Date(),\n                error: errorMessage\n            }\n        });\n    }\n    async markSubtaskRunning(taskId, stepIndex) {\n        const subtaskId = await this.getSubtaskId(taskId, stepIndex);\n        const subtask = await this.prisma.backgroundTask.update({\n            where: {\n                id: subtaskId\n            },\n            data: {\n                status: _prisma_client__WEBPACK_IMPORTED_MODULE_0__.TaskStatus.RUNNING,\n                startedAt: new Date(),\n                progress: 0\n            }\n        });\n        return subtask;\n    }\n    async updateSubtaskProgress(taskId, stepIndex, progress) {\n        await this.prisma.backgroundTask.update({\n            where: {\n                id: await this.getSubtaskId(taskId, stepIndex)\n            },\n            data: {\n                progress\n            }\n        });\n    }\n    async markSubtaskCompleted(taskId, stepIndex, result) {\n        await this.prisma.backgroundTask.update({\n            where: {\n                id: await this.getSubtaskId(taskId, stepIndex)\n            },\n            data: {\n                status: _prisma_client__WEBPACK_IMPORTED_MODULE_0__.TaskStatus.COMPLETED,\n                finishedAt: new Date(),\n                progress: 100,\n                result\n            }\n        });\n    }\n    async markSubtaskFailed(taskId, stepIndex, errorMessage) {\n        await this.prisma.backgroundTask.update({\n            where: {\n                id: await this.getSubtaskId(taskId, stepIndex)\n            },\n            data: {\n                status: _prisma_client__WEBPACK_IMPORTED_MODULE_0__.TaskStatus.FAILED,\n                finishedAt: new Date(),\n                error: errorMessage\n            }\n        });\n    }\n    async getTask(taskId) {\n        return this.prisma.backgroundTask.findUnique({\n            where: {\n                id: taskId\n            },\n            include: {\n                subtasks: true\n            }\n        });\n    }\n    async listTasks(params = {}) {\n        const page = params.page || 1;\n        const limit = params.limit || 20;\n        const skip = (page - 1) * limit;\n        const where = {};\n        if (params.entityType) where.entityType = params.entityType;\n        if (params.entityId) where.entityId = params.entityId;\n        const [total, tasks] = await Promise.all([\n            this.prisma.backgroundTask.count({\n                where\n            }),\n            this.prisma.backgroundTask.findMany({\n                where,\n                orderBy: {\n                    createdAt: \"desc\"\n                },\n                skip,\n                take: limit,\n                include: {\n                    subtasks: true\n                }\n            })\n        ]);\n        return {\n            data: tasks,\n            pagination: {\n                page,\n                limit,\n                total,\n                totalPages: Math.ceil(total / limit)\n            }\n        };\n    }\n    async getSubtaskId(taskId, stepIndex) {\n        const subtask = await this.prisma.backgroundTask.findFirst({\n            where: {\n                parentTaskId: taskId,\n                stepIndex\n            }\n        });\n        if (!subtask) {\n            throw new Error(`Subtask not found for task ${taskId} at step ${stepIndex}`);\n        }\n        return subtask.id;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbWFuYWdlcnMvYmFja2dyb3VuZFRhc2tNYW5hZ2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBMEU7QUFDbEM7QUFFakMsTUFBTUU7SUFHWEMsWUFBWUMsTUFBb0IsQ0FBRTtRQUNoQyxJQUFJLENBQUNBLE1BQU0sR0FBR0E7SUFDaEI7SUFFQSxNQUFNQyxXQUFXQyxNQU1oQixFQUE0RDtRQUMzRCxNQUFNLEVBQUVDLElBQUksRUFBRUMsV0FBVyxFQUFFQyxVQUFVLEVBQUVDLFFBQVEsRUFBRUMsZUFBZSxFQUFFLEVBQUUsR0FBR0w7UUFDdkUsSUFBSTtZQUNGLHFCQUFxQjtZQUNyQixNQUFNTSxhQUFhLE1BQU0sSUFBSSxDQUFDUixNQUFNLENBQUNTLGNBQWMsQ0FBQ0MsTUFBTSxDQUFDO2dCQUN6REMsTUFBTTtvQkFDSlI7b0JBQ0FDO29CQUNBQztvQkFDQUM7b0JBQ0FNLFFBQVFoQixzREFBVUEsQ0FBQ2lCLE9BQU87b0JBQzFCQyxVQUFVO2dCQUNaO1lBQ0Y7WUFFQSxrREFBa0Q7WUFDbEQsSUFBSVAsYUFBYVEsTUFBTSxHQUFHLEdBQUc7Z0JBQzNCLE1BQU0sSUFBSSxDQUFDZixNQUFNLENBQUNTLGNBQWMsQ0FBQ08sVUFBVSxDQUFDO29CQUMxQ0wsTUFBTUosYUFBYVUsR0FBRyxDQUFDLENBQUNDLGFBQWFDLFFBQVc7NEJBQzlDaEIsTUFBTWU7NEJBQ05FLGNBQWNaLFdBQVdhLEVBQUU7NEJBQzNCQyxXQUFXSDs0QkFDWFAsUUFBUWhCLHNEQUFVQSxDQUFDaUIsT0FBTzs0QkFDMUJDLFVBQVU7d0JBQ1o7Z0JBQ0Y7WUFDRjtZQUVBLE1BQU1TLFdBQVcsTUFBTSxJQUFJLENBQUN2QixNQUFNLENBQUNTLGNBQWMsQ0FBQ2UsVUFBVSxDQUFDO2dCQUMzREMsT0FBTztvQkFBRUosSUFBSWIsV0FBV2EsRUFBRTtnQkFBQztnQkFDM0JLLFNBQVM7b0JBQUVDLFVBQVU7Z0JBQUs7WUFDNUI7WUFFQTlCLGlEQUFNQSxDQUFDK0IsSUFBSSxD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UyxNQUFNVjtnQkFDTjVCLFNBQVM7b0JBQUVDLFVBQVU7Z0JBQUs7WUFDNUI7U0FDRDtRQUNELE9BQU87WUFDTGhCLE1BQU04QztZQUNOUSxZQUFZO2dCQUNWWjtnQkFDQUM7Z0JBQ0FFO2dCQUNBVSxZQUFZQyxLQUFLQyxJQUFJLENBQUNaLFFBQVFGO1lBQ2hDO1FBQ0Y7SUFDRjtJQUVBLE1BQWNSLGFBQWFqQixNQUFjLEVBQUVQLFNBQWlCLEVBQW1CO1FBQzdFLE1BQU15QixVQUFVLE1BQU0sSUFBSSxDQUFDL0MsTUFBTSxDQUFDUyxjQUFjLENBQUM0RCxTQUFTLENBQUM7WUFBRTVDLE9BQU87Z0JBQUVMLGNBQWNTO2dCQUFRUDtZQUFVO1FBQUU7UUFDeEcsSUFBSSxDQUFDeUIsU0FBUztZQUNaLE1BQU0sSUFBSXVCLE1BQU0sQ0FBQywyQkFBMkIsRUFBRXpDLE9BQU8sU0FBUyxFQUFFUCxVQUFVLENBQUM7UUFDN0U7UUFDQSxPQUFPeUIsUUFBUTFCLEVBQUU7SUFDbkI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL21ybTM2MC1iYWNrZW5kLy4vc3JjL21hbmFnZXJzL2JhY2tncm91bmRUYXNrTWFuYWdlci50cz8xMDg0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCwgVGFza1N0YXR1cywgQmFja2dyb3VuZFRhc2sgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL3V0aWxzL2xvZ2dlcic7XG5cbmV4cG9ydCBjbGFzcyBCYWNrZ3JvdW5kVGFza01hbmFnZXIge1xuICBwcml2YXRlIHByaXNtYTogUHJpc21hQ2xpZW50O1xuXG4gIGNvbnN0cnVjdG9yKHByaXNtYTogUHJpc21hQ2xpZW50KSB7XG4gICAgdGhpcy5wcmlzbWEgPSBwcmlzbWE7XG4gIH1cblxuICBhc3luYyBjcmVhdGVUYXNrKHBhcmFtczoge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgICBlbnRpdHlUeXBlPzogc3RyaW5nO1xuICAgIGVudGl0eUlkPzogc3RyaW5nO1xuICAgIHN1YnRhc2tOYW1lcz86IHN0cmluZ1tdO1xuICB9KTogUHJvbWlzZTxCYWNrZ3JvdW5kVGFzayAmIHsgc3VidGFza3M6IEJhY2tncm91bmRUYXNrW10gfT4ge1xuICAgIGNvbnN0IHsgbmFtZSwgZGVzY3JpcHRpb24sIGVudGl0eVR5cGUsIGVudGl0eUlkLCBzdWJ0YXNrTmFtZXMgPSBbXSB9ID0gcGFyYW1zO1xuICAgIHRyeSB7XG4gICAgICAvLyBDcmVhdGUgcGFyZW50IHRhc2tcbiAgICAgIGNvbnN0IHBhcmVudFRhc2sgPSBhd2FpdCB0aGlzLnByaXNtYS5iYWNrZ3JvdW5kVGFzay5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbmFtZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgICBlbnRpdHlUeXBlLFxuICAgICAgICAgIGVudGl0eUlkLFxuICAgICAgICAgIHN0YXR1czogVGFza1N0YXR1cy5QRU5ESU5HLFxuICAgICAgICAgIHByb2dyZXNzOiAwXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBDcmVhdGUgc3VidGFza3MgYXMgY2hpbGQgQmFja2dyb3VuZFRhc2sgcmVjb3Jkc1xuICAgICAgaWYgKHN1YnRhc2tOYW1lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucHJpc21hLmJhY2tncm91bmRUYXNrLmNyZWF0ZU1hbnkoe1xuICAgICAgICAgIGRhdGE6IHN1YnRhc2tOYW1lcy5tYXAoKHN1YnRhc2tOYW1lLCBpbmRleCkgPT4gKHtcbiAgICAgICAgICAgIG5hbWU6IHN1YnRhc2tOYW1lLFxuICAgICAgICAgICAgcGFyZW50VGFza0lkOiBwYXJlbnRUYXNrLmlkLFxuICAgICAgICAgICAgc3RlcEluZGV4OiBpbmRleCxcbiAgICAgICAgICAgIHN0YXR1czogVGFza1N0YXR1cy5QRU5ESU5HLFxuICAgICAgICAgICAgcHJvZ3Jlc3M6IDBcbiAgICAgICAgICB9KSlcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGZ1bGxUYXNrID0gYXdhaXQgdGhpcy5wcmlzbWEuYmFja2dyb3VuZFRhc2suZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBwYXJlbnRUYXNrLmlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHsgc3VidGFza3M6IHRydWUgfVxuICAgICAgfSk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKCdCYWNrZ3JvdW5kIHRhc2sgY3JlYXRlZCcsIHsgdGFza0lkOiBwYXJlbnRUYXNrLmlkLCBuYW1lIH0pO1xuICAgICAgLy8gbm9uLW51bGwgYnkgY29uc3RydWN0aW9uXG4gICAgICByZXR1cm4gZnVsbFRhc2sgYXMgQmFja2dyb3VuZFRhc2sgJiB7IHN1YnRhc2tzOiBCYWNrZ3JvdW5kVGFza1tdIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBiYWNrZ3JvdW5kIHRhc2snLCB7IGVycm9yLCBuYW1lIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbWFya1Rhc2tSdW5uaW5nKHRhc2tJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5wcmlzbWEuYmFja2dyb3VuZFRhc2sudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB0YXNrSWQgfSxcbiAgICAgIGRhdGE6IHsgc3RhdHVzOiBUYXNrU3RhdHVzLlJVTk5JTkcsIHN0YXJ0ZWRBdDogbmV3IERhdGUoKSB9XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyB1cGRhdGVUYXNrUHJvZ3Jlc3ModGFza0lkOiBzdHJpbmcsIHByb2dyZXNzOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5iYWNrZ3JvdW5kVGFzay51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHRhc2tJZCB9LFxuICAgICAgZGF0YTogeyBwcm9ncmVzcyB9XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBtYXJrVGFza0NvbXBsZXRlZCh0YXNrSWQ6IHN0cmluZywgcmVzdWx0PzogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5wcmlzbWEuYmFja2dyb3VuZFRhc2sudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiB0YXNrSWQgfSxcbiAgICAgIGRhdGE6IHsgc3RhdHVzOiBUYXNrU3RhdHVzLkNPTVBMRVRFRCwgZmluaXNoZWRBdDogbmV3IERhdGUoKSwgcHJvZ3Jlc3M6IDEwMCwgcmVzdWx0IH1cbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIG1hcmtUYXNrRmFpbGVkKHRhc2tJZDogc3RyaW5nLCBlcnJvck1lc3NhZ2U6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMucHJpc21hLmJhY2tncm91bmRUYXNrLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogdGFza0lkIH0sXG4gICAgICBkYXRhOiB7IHN0YXR1czogVGFza1N0YXR1cy5GQUlMRUQsIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKCksIGVycm9yOiBlcnJvck1lc3NhZ2UgfVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgbWFya1N1YnRhc2tSdW5uaW5nKHRhc2tJZDogc3RyaW5nLCBzdGVwSW5kZXg6IG51bWJlcik6IFByb21pc2U8QmFja2dyb3VuZFRhc2s+IHtcbiAgICBjb25zdCBzdWJ0YXNrSWQgPSBhd2FpdCB0aGlzLmdldFN1YnRhc2tJZCh0YXNrSWQsIHN0ZXBJbmRleCk7XG4gICAgY29uc3Qgc3VidGFzayA9IGF3YWl0IHRoaXMucHJpc21hLmJhY2tncm91bmRUYXNrLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogc3VidGFza0lkIH0sXG4gICAgICBkYXRhOiB7IHN0YXR1czogVGFza1N0YXR1cy5SVU5OSU5HLCBzdGFydGVkQXQ6IG5ldyBEYXRlKCksIHByb2dyZXNzOiAwIH1cbiAgICB9KTtcbiAgICByZXR1cm4gc3VidGFzaztcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZVN1YnRhc2tQcm9ncmVzcyh0YXNrSWQ6IHN0cmluZywgc3RlcEluZGV4OiBudW1iZXIsIHByb2dyZXNzOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5iYWNrZ3JvdW5kVGFzay51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IGF3YWl0IHRoaXMuZ2V0U3VidGFza0lkKHRhc2tJZCwgc3RlcEluZGV4KSB9LFxuICAgICAgZGF0YTogeyBwcm9ncmVzcyB9XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBtYXJrU3VidGFza0NvbXBsZXRlZCh0YXNrSWQ6IHN0cmluZywgc3RlcEluZGV4OiBudW1iZXIsIHJlc3VsdD86IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMucHJpc21hLmJhY2tncm91bmRUYXNrLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogYXdhaXQgdGhpcy5nZXRTdWJ0YXNrSWQodGFza0lkLCBzdGVwSW5kZXgpIH0sXG4gICAgICBkYXRhOiB7IHN0YXR1czogVGFza1N0YXR1cy5DT01QTEVURUQsIGZpbmlzaGVkQXQ6IG5ldyBEYXRlKCksIHByb2dyZXNzOiAxMDAsIHJlc3VsdCB9XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBtYXJrU3VidGFza0ZhaWxlZCh0YXNrSWQ6IHN0cmluZywgc3RlcEluZGV4OiBudW1iZXIsIGVycm9yTWVzc2FnZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5wcmlzbWEuYmFja2dyb3VuZFRhc2sudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBhd2FpdCB0aGlzLmdldFN1YnRhc2tJZCh0YXNrSWQsIHN0ZXBJbmRleCkgfSxcbiAgICAgIGRhdGE6IHsgc3RhdHVzOiBUYXNrU3RhdHVzLkZBSUxFRCwgZmluaXNoZWRBdDogbmV3IERhdGUoKSwgZXJyb3I6IGVycm9yTWVzc2FnZSB9XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBnZXRUYXNrKHRhc2tJZDogc3RyaW5nKTogUHJvbWlzZTwoQmFja2dyb3VuZFRhc2sgJiB7IHN1YnRhc2tzOiBCYWNrZ3JvdW5kVGFza1tdIH0pIHwgbnVsbD4ge1xuICAgIHJldHVybiB0aGlzLnByaXNtYS5iYWNrZ3JvdW5kVGFzay5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQ6IHRhc2tJZCB9LCBpbmNsdWRlOiB7IHN1YnRhc2tzOiB0cnVlIH0gfSk7XG4gIH1cblxuICBhc3luYyBsaXN0VGFza3MocGFyYW1zOiB7IHBhZ2U/OiBudW1iZXI7IGxpbWl0PzogbnVtYmVyOyBlbnRpdHlUeXBlPzogc3RyaW5nOyBlbnRpdHlJZD86IHN0cmluZyB9ID0ge30pIHtcbiAgICBjb25zdCBwYWdlID0gcGFyYW1zLnBhZ2UgfHwgMTtcbiAgICBjb25zdCBsaW1pdCA9IHBhcmFtcy5saW1pdCB8fCAyMDtcbiAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuICAgIGNvbnN0IHdoZXJlOiBhbnkgPSB7fTtcbiAgICBpZiAocGFyYW1zLmVudGl0eVR5cGUpIHdoZXJlLmVudGl0eVR5cGUgPSBwYXJhbXMuZW50aXR5VHlwZTtcbiAgICBpZiAocGFyYW1zLmVudGl0eUlkKSB3aGVyZS5lbnRpdHlJZCA9IHBhcmFtcy5lbnRpdHlJZDtcbiAgICBjb25zdCBbdG90YWwsIHRhc2tzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgIHRoaXMucHJpc21hLmJhY2tncm91bmRUYXNrLmNvdW50KHsgd2hlcmUgfSksXG4gICAgICB0aGlzLnByaXNtYS5iYWNrZ3JvdW5kVGFzay5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXG4gICAgICAgIHNraXAsXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgICBpbmNsdWRlOiB7IHN1YnRhc2tzOiB0cnVlIH1cbiAgICAgIH0pXG4gICAgXSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGE6IHRhc2tzLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBwYWdlLFxuICAgICAgICBsaW1pdCxcbiAgICAgICAgdG90YWwsXG4gICAgICAgIHRvdGFsUGFnZXM6IE1hdGguY2VpbCh0b3RhbCAvIGxpbWl0KVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFN1YnRhc2tJZCh0YXNrSWQ6IHN0cmluZywgc3RlcEluZGV4OiBudW1iZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHN1YnRhc2sgPSBhd2FpdCB0aGlzLnByaXNtYS5iYWNrZ3JvdW5kVGFzay5maW5kRmlyc3QoeyB3aGVyZTogeyBwYXJlbnRUYXNrSWQ6IHRhc2tJZCwgc3RlcEluZGV4IH0gfSk7XG4gICAgaWYgKCFzdWJ0YXNrKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFN1YnRhc2sgbm90IGZvdW5kIGZvciB0YXNrICR7dGFza0lkfSBhdCBzdGVwICR7c3RlcEluZGV4fWApO1xuICAgIH1cbiAgICByZXR1cm4gc3VidGFzay5pZDtcbiAgfVxufVxuXG5cbiJdLCJuYW1lcyI6WyJUYXNrU3RhdHVzIiwibG9nZ2VyIiwiQmFja2dyb3VuZFRhc2tNYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJwcmlzbWEiLCJjcmVhdGVUYXNrIiwicGFyYW1zIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwic3VidGFza05hbWVzIiwicGFyZW50VGFzayIsImJhY2tncm91bmRUYXNrIiwiY3JlYXRlIiwiZGF0YSIsInN0YXR1cyIsIlBFTkRJTkciLCJwcm9ncmVzcyIsImxlbmd0aCIsImNyZWF0ZU1hbnkiLCJtYXAiLCJzdWJ0YXNrTmFtZSIsImluZGV4IiwicGFyZW50VGFza0lkIiwiaWQiLCJzdGVwSW5kZXgiLCJmdWxsVGFzayIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImluY2x1ZGUiLCJzdWJ0YXNrcyIsImluZm8iLCJ0YXNrSWQiLCJlcnJvciIsIm1hcmtUYXNrUnVubmluZyIsInVwZGF0ZSIsIlJVTk5JTkciLCJzdGFydGVkQXQiLCJEYXRlIiwidXBkYXRlVGFza1Byb2dyZXNzIiwibWFya1Rhc2tDb21wbGV0ZWQiLCJyZXN1bHQiLCJDT01QTEVURUQiLCJmaW5pc2hlZEF0IiwibWFya1Rhc2tGYWlsZWQiLCJlcnJvck1lc3NhZ2UiLCJGQUlMRUQiLCJtYXJrU3VidGFza1J1bm5pbmciLCJzdWJ0YXNrSWQiLCJnZXRTdWJ0YXNrSWQiLCJzdWJ0YXNrIiwidXBkYXRlU3VidGFza1Byb2dyZXNzIiwibWFya1N1YnRhc2tDb21wbGV0ZWQiLCJtYXJrU3VidGFza0ZhaWxlZCIsImdldFRhc2siLCJsaXN0VGFza3MiLCJwYWdlIiwibGltaXQiLCJza2lwIiwidG90YWwiLCJ0YXNrcyIsIlByb21pc2UiLCJhbGwiLCJjb3VudCIsImZpbmRNYW55Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsInRha2UiLCJwYWdpbmF0aW9uIiwidG90YWxQYWdlcyIsIk1hdGgiLCJjZWlsIiwiZmluZEZpcnN0IiwiRXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/managers/backgroundTaskManager.ts\n");

/***/ }),

/***/ "(api)/./src/managers/eventManager.ts":
/*!**************************************!*\
  !*** ./src/managers/eventManager.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EventManager: () => (/* binding */ EventManager)\n/* harmony export */ });\n/* harmony import */ var _utils_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/logger */ \"(api)/./src/utils/logger.ts\");\n\nclass EventManager {\n    constructor(prisma){\n        this.prisma = prisma;\n    }\n    async createEvent(data) {\n        try {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Creating new event\", {\n                title: data.title,\n                category: data.category\n            });\n            const event = await this.prisma.event.create({\n                data: {\n                    title: data.title,\n                    description: data.description,\n                    startTime: data.startTime,\n                    endTime: data.endTime,\n                    category: data.category,\n                    linkedTeamId: data.linkedTeamId,\n                    attendanceType: data.attendanceType\n                },\n                include: {\n                    linkedTeam: true,\n                    rsvps: {\n                        include: {\n                            user: true\n                        }\n                    },\n                    checkIns: {\n                        include: {\n                            user: true\n                        }\n                    }\n                }\n            });\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Event created successfully\", {\n                eventId: event.id\n            });\n            return event;\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to create event\", {\n                error,\n                data\n            });\n            throw error;\n        }\n    }\n    async getEventById(id) {\n        try {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Fetching event by ID\", {\n                eventId: id\n            });\n            const event = await this.prisma.event.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    linkedTeam: true,\n                    rsvps: {\n                        include: {\n                            user: true\n                        }\n                    },\n                    checkIns: {\n                        include: {\n                            user: true\n                        }\n                    }\n                }\n            });\n            return event;\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to fetch event by ID\", {\n                error,\n                eventId: id\n            });\n            throw error;\n        }\n    }\n    async getAllEvents(filters) {\n        try {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Fetching all events\", {\n                filters\n            });\n            const where = {};\n            if (filters?.category) {\n                where.category = filters.category;\n            }\n            if (filters?.linkedTeamId) {\n                where.linkedTeamId = filters.linkedTeamId;\n            }\n            if (filters?.startDate || filters?.endDate) {\n                where.startTime = {};\n                if (filters.startDate) {\n                    where.startTime.gte = filters.startDate;\n                }\n                if (filters.endDate) {\n                    where.startTime.lte = filters.endDate;\n                }\n            }\n            const events = await this.prisma.event.findMany({\n                where,\n                include: {\n                    linkedTeam: true,\n                    rsvps: {\n                        include: {\n                            user: true\n                        }\n                    },\n                    checkIns: {\n                        include: {\n                            user: true\n                        }\n                    }\n                },\n                orderBy: {\n                    startTime: \"asc\"\n                }\n            });\n            return events;\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to fetch events\", {\n                error,\n                filters\n            });\n            throw error;\n        }\n    }\n    async updateEvent(id, data) {\n        try {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Updating event\", {\n                eventId: id,\n                updates: data\n            });\n            const event = await this.prisma.event.update({\n                where: {\n                    id\n                },\n                data,\n                include: {\n                    linkedTeam: true,\n                    rsvps: {\n                        include: {\n                            user: true\n                        }\n                    },\n                    checkIns: {\n                        include: {\n                            user: true\n                        }\n                    }\n                }\n            });\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Event updated successfully\", {\n                eventId: id\n            });\n            return event;\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to update event\", {\n                error,\n                eventId: id,\n                data\n            });\n            throw error;\n        }\n    }\n    async deleteEvent(id) {\n        try {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Deleting event\", {\n                eventId: id\n            });\n            // Delete related records first\n            await this.prisma.eventAttendance.deleteMany({\n                where: {\n                    eventId: id\n                }\n            });\n            await this.prisma.event.delete({\n                where: {\n                    id\n                }\n            });\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Event deleted successfully\", {\n                eventId: id\n            });\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to delete event\", {\n                error,\n                eventId: id\n            });\n            throw error;\n        }\n    }\n    async rsvpToEvent(data) {\n        try {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Processing RSVP\", {\n                userId: data.userId,\n                eventId: data.eventId,\n                status: data.status\n            });\n            // Check if user is already RSVP'd\n            const existingRSVP = await this.prisma.eventAttendance.findUnique({\n                where: {\n                    userId_eventId: {\n                        userId: data.userId,\n                        eventId: data.eventId\n                    }\n                }\n            });\n            if (existingRSVP) {\n                // Update existing RSVP\n                await this.prisma.eventAttendance.update({\n                    where: {\n                        userId_eventId: {\n                            userId: data.userId,\n                            eventId: data.eventId\n                        }\n                    },\n                    data: {\n                        status: data.status,\n                        updatedAt: new Date()\n                    }\n                });\n            } else {\n                // Create new RSVP\n                await this.prisma.eventAttendance.create({\n                    data: {\n                        userId: data.userId,\n                        eventId: data.eventId,\n                        status: data.status\n                    }\n                });\n            }\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"RSVP processed successfully\", {\n                userId: data.userId,\n                eventId: data.eventId\n            });\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to process RSVP\", {\n                error,\n                data\n            });\n            throw error;\n        }\n    }\n    async checkInAttendance(data) {\n        try {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Processing attendance check-in\", {\n                qrCode: data.qrCode,\n                eventId: data.eventId\n            });\n            // Find user by QR code\n            const user = await this.prisma.user.findFirst({\n                where: {\n                    qrCode: data.qrCode\n                }\n            });\n            if (!user) {\n                _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.warn(\"User not found for QR code\", {\n                    qrCode: data.qrCode\n                });\n                return {\n                    success: false,\n                    message: \"Invalid QR code\"\n                };\n            }\n            // Check if event exists\n            const event = await this.prisma.event.findUnique({\n                where: {\n                    id: data.eventId\n                }\n            });\n            if (!event) {\n                _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.warn(\"Event not found\", {\n                    eventId: data.eventId\n                });\n                return {\n                    success: false,\n                    message: \"Event not found\"\n                };\n            }\n            // Check if user is RSVP'd\n            const rsvp = await this.prisma.eventAttendance.findUnique({\n                where: {\n                    userId_eventId: {\n                        userId: user.id,\n                        eventId: data.eventId\n                    }\n                }\n            });\n            if (!rsvp || rsvp.status !== \"attending\") {\n                _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.warn(\"User not RSVP'd as attending\", {\n                    userId: user.id,\n                    eventId: data.eventId\n                });\n                return {\n                    success: false,\n                    message: \"User not RSVP'd as attending\"\n                };\n            }\n            // Update attendance record\n            await this.prisma.eventAttendance.update({\n                where: {\n                    userId_eventId: {\n                        userId: user.id,\n                        eventId: data.eventId\n                    }\n                },\n                data: {\n                    checkedIn: true,\n                    checkInTime: new Date()\n                }\n            });\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Attendance check-in successful\", {\n                userId: user.id,\n                eventId: data.eventId\n            });\n            return {\n                success: true,\n                message: \"Check-in successful\",\n                user\n            };\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to process attendance check-in\", {\n                error,\n                data\n            });\n            throw error;\n        }\n    }\n    async getEventAttendance(eventId) {\n        try {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Fetching event attendance\", {\n                eventId\n            });\n            const attendance = await this.prisma.eventAttendance.findMany({\n                where: {\n                    eventId\n                },\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            name: true,\n                            email: true,\n                            qrCode: true\n                        }\n                    }\n                },\n                orderBy: {\n                    createdAt: \"asc\"\n                }\n            });\n            return attendance;\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to fetch event attendance\", {\n                error,\n                eventId\n            });\n            throw error;\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWtDO2dCQUFFc0MsUUFBUXpCLEtBQUtHLEVBQUU7Z0JBQUVELFNBQVNoQixLQUFLZ0IsT0FBTztZQUFDO1lBQ3ZGLE9BQU87Z0JBQUVpQyxTQUFTO2dCQUFNQyxTQUFTO2dCQUF1QnBDO1lBQUs7UUFDL0QsRUFBRSxPQUFPSSxPQUFPO1lBQ2R2QixpREFBTUEsQ0FBQ3VCLEtBQUssQ0FBQyx5Q0FBeUM7Z0JBQUVBO2dCQUFPbEI7WUFBSztZQUNwRSxNQUFNa0I7UUFDUjtJQUNGO0lBRUEsTUFBTW9DLG1CQUFtQnRDLE9BQWUsRUFBa0I7UUFDeEQsSUFBSTtZQUNGckIsaURBQU1BLENBQUNNLElBQUksQ0FBQyw2QkFBNkI7Z0JBQUVlO1lBQVE7WUFFbkQsTUFBTXVDLGFBQWEsTUFBTSxJQUFJLENBQUN6RCxNQUFNLENBQUNxQyxlQUFlLENBQUNOLFFBQVEsQ0FBQztnQkFDNURSLE9BQU87b0JBQUVMO2dCQUFRO2dCQUNqQkwsU0FBUztvQkFDUEcsTUFBTTt3QkFDSjBDLFFBQVE7NEJBQ052QyxJQUFJOzRCQUNKd0MsTUFBTTs0QkFDTkMsT0FBTzs0QkFDUFosUUFBUTt3QkFDVjtvQkFDRjtnQkFDRjtnQkFDQWhCLFNBQVM7b0JBQUU2QixXQUFXO2dCQUFNO1lBQzlCO1lBRUEsT0FBT0o7UUFDVCxFQUFFLE9BQU9yQyxPQUFPO1lBQ2R2QixpREFBTUEsQ0FBQ3VCLEtBQUssQ0FBQyxvQ0FBb0M7Z0JBQUVBO2dCQUFPRjtZQUFRO1lBQ2xFLE1BQU1FO1FBQ1I7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXJtMzYwLWJhY2tlbmQvLi9zcmMvbWFuYWdlcnMvZXZlbnRNYW5hZ2VyLnRzPzA0MzciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50LCBFdmVudCwgRXZlbnRDYXRlZ29yeSwgQXR0ZW5kYW5jZVR5cGUsIFVzZXIsIFRlYW0gfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2dnZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUV2ZW50RGF0YSB7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBzdGFydFRpbWU6IERhdGU7XG4gIGVuZFRpbWU6IERhdGU7XG4gIGNhdGVnb3J5OiBFdmVudENhdGVnb3J5O1xuICBsaW5rZWRUZWFtSWQ/OiBzdHJpbmc7XG4gIGF0dGVuZGFuY2VUeXBlOiBBdHRlbmRhbmNlVHlwZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVFdmVudERhdGEgZXh0ZW5kcyBQYXJ0aWFsPENyZWF0ZUV2ZW50RGF0YT4ge31cblxuZXhwb3J0IGludGVyZmFjZSBSU1ZQRGF0YSB7XG4gIHVzZXJJZDogc3RyaW5nO1xuICBldmVudElkOiBzdHJpbmc7XG4gIHN0YXR1czogJ2F0dGVuZGluZycgfCAnbm90X2F0dGVuZGluZycgfCAnbWF5YmUnO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF0dGVuZGFuY2VDaGVja0luRGF0YSB7XG4gIHFyQ29kZTogc3RyaW5nO1xuICBldmVudElkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBFdmVudE1hbmFnZXIge1xuICBwcml2YXRlIHByaXNtYTogUHJpc21hQ2xpZW50O1xuXG4gIGNvbnN0cnVjdG9yKHByaXNtYTogUHJpc21hQ2xpZW50KSB7XG4gICAgdGhpcy5wcmlzbWEgPSBwcmlzbWE7XG4gIH1cblxuICBhc3luYyBjcmVhdGVFdmVudChkYXRhOiBDcmVhdGVFdmVudERhdGEpOiBQcm9taXNlPEV2ZW50PiB7XG4gICAgdHJ5IHtcbiAgICAgIGxvZ2dlci5pbmZvKCdDcmVhdGluZyBuZXcgZXZlbnQnLCB7IHRpdGxlOiBkYXRhLnRpdGxlLCBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgZXZlbnQgPSBhd2FpdCB0aGlzLnByaXNtYS5ldmVudC5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgc3RhcnRUaW1lOiBkYXRhLnN0YXJ0VGltZSxcbiAgICAgICAgICBlbmRUaW1lOiBkYXRhLmVuZFRpbWUsXG4gICAgICAgICAgY2F0ZWdvcnk6IGRhdGEuY2F0ZWdvcnksXG4gICAgICAgICAgbGlua2VkVGVhbUlkOiBkYXRhLmxpbmtlZFRlYW1JZCxcbiAgICAgICAgICBhdHRlbmRhbmNlVHlwZTogZGF0YS5hdHRlbmRhbmNlVHlwZSxcbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIGxpbmtlZFRlYW06IHRydWUsXG4gICAgICAgICAgcnN2cHM6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgdXNlcjogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjaGVja0luczoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICB1c2VyOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKCdFdmVudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsIHsgZXZlbnRJZDogZXZlbnQuaWQgfSk7XG4gICAgICByZXR1cm4gZXZlbnQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBldmVudCcsIHsgZXJyb3IsIGRhdGEgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRFdmVudEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8RXZlbnQgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGxvZ2dlci5pbmZvKCdGZXRjaGluZyBldmVudCBieSBJRCcsIHsgZXZlbnRJZDogaWQgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGV2ZW50ID0gYXdhaXQgdGhpcy5wcmlzbWEuZXZlbnQuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBsaW5rZWRUZWFtOiB0cnVlLFxuICAgICAgICAgIHJzdnBzOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHVzZXI6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2hlY2tJbnM6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgdXNlcjogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZXZlbnQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGZldGNoIGV2ZW50IGJ5IElEJywgeyBlcnJvciwgZXZlbnRJZDogaWQgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRBbGxFdmVudHMoZmlsdGVycz86IHtcbiAgICBjYXRlZ29yeT86IEV2ZW50Q2F0ZWdvcnk7XG4gICAgbGlua2VkVGVhbUlkPzogc3RyaW5nO1xuICAgIHN0YXJ0RGF0ZT86IERhdGU7XG4gICAgZW5kRGF0ZT86IERhdGU7XG4gIH0pOiBQcm9taXNlPEV2ZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmluZm8oJ0ZldGNoaW5nIGFsbCBldmVudHMnLCB7IGZpbHRlcnMgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHdoZXJlOiBhbnkgPSB7fTtcbiAgICAgIFxuICAgICAgaWYgKGZpbHRlcnM/LmNhdGVnb3J5KSB7XG4gICAgICAgIHdoZXJlLmNhdGVnb3J5ID0gZmlsdGVycy5jYXRlZ29yeTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKGZpbHRlcnM/LmxpbmtlZFRlYW1JZCkge1xuICAgICAgICB3aGVyZS5saW5rZWRUZWFtSWQgPSBmaWx0ZXJzLmxpbmtlZFRlYW1JZDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKGZpbHRlcnM/LnN0YXJ0RGF0ZSB8fCBmaWx0ZXJzPy5lbmREYXRlKSB7XG4gICAgICAgIHdoZXJlLnN0YXJ0VGltZSA9IHt9O1xuICAgICAgICBpZiAoZmlsdGVycy5zdGFydERhdGUpIHtcbiAgICAgICAgICB3aGVyZS5zdGFydFRpbWUuZ3RlID0gZmlsdGVycy5zdGFydERhdGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbHRlcnMuZW5kRGF0ZSkge1xuICAgICAgICAgIHdoZXJlLnN0YXJ0VGltZS5sdGUgPSBmaWx0ZXJzLmVuZERhdGU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgZXZlbnRzID0gYXdhaXQgdGhpcy5wcmlzbWEuZXZlbnQuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIGxpbmtlZFRlYW06IHRydWUsXG4gICAgICAgICAgcnN2cHM6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgdXNlcjogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjaGVja0luczoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICB1c2VyOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7IHN0YXJ0VGltZTogJ2FzYycgfSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZXZlbnRzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCBldmVudHMnLCB7IGVycm9yLCBmaWx0ZXJzIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdXBkYXRlRXZlbnQoaWQ6IHN0cmluZywgZGF0YTogVXBkYXRlRXZlbnREYXRhKTogUHJvbWlzZTxFdmVudD4ge1xuICAgIHRyeSB7XG4gICAgICBsb2dnZXIuaW5mbygnVXBkYXRpbmcgZXZlbnQnLCB7IGV2ZW50SWQ6IGlkLCB1cGRhdGVzOiBkYXRhIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBldmVudCA9IGF3YWl0IHRoaXMucHJpc21hLmV2ZW50LnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIGRhdGEsXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBsaW5rZWRUZWFtOiB0cnVlLFxuICAgICAgICAgIHJzdnBzOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHVzZXI6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2hlY2tJbnM6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgdXNlcjogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBsb2dnZXIuaW5mbygnRXZlbnQgdXBkYXRlZCBzdWNjZXNzZnVsbHknLCB7IGV2ZW50SWQ6IGlkIH0pO1xuICAgICAgcmV0dXJuIGV2ZW50O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byB1cGRhdGUgZXZlbnQnLCB7IGVycm9yLCBldmVudElkOiBpZCwgZGF0YSB9KTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZUV2ZW50KGlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmluZm8oJ0RlbGV0aW5nIGV2ZW50JywgeyBldmVudElkOiBpZCB9KTtcbiAgICAgIFxuICAgICAgLy8gRGVsZXRlIHJlbGF0ZWQgcmVjb3JkcyBmaXJzdFxuICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuZXZlbnRBdHRlbmRhbmNlLmRlbGV0ZU1hbnkoe1xuICAgICAgICB3aGVyZTogeyBldmVudElkOiBpZCB9LFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGF3YWl0IHRoaXMucHJpc21hLmV2ZW50LmRlbGV0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICB9KTtcblxuICAgICAgbG9nZ2VyLmluZm8oJ0V2ZW50IGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JywgeyBldmVudElkOiBpZCB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZGVsZXRlIGV2ZW50JywgeyBlcnJvciwgZXZlbnRJZDogaWQgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyByc3ZwVG9FdmVudChkYXRhOiBSU1ZQRGF0YSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBsb2dnZXIuaW5mbygnUHJvY2Vzc2luZyBSU1ZQJywgeyB1c2VySWQ6IGRhdGEudXNlcklkLCBldmVudElkOiBkYXRhLmV2ZW50SWQsIHN0YXR1czogZGF0YS5zdGF0dXMgfSk7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgYWxyZWFkeSBSU1ZQJ2RcbiAgICAgIGNvbnN0IGV4aXN0aW5nUlNWUCA9IGF3YWl0IHRoaXMucHJpc21hLmV2ZW50QXR0ZW5kYW5jZS5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB1c2VySWRfZXZlbnRJZDoge1xuICAgICAgICAgICAgdXNlcklkOiBkYXRhLnVzZXJJZCxcbiAgICAgICAgICAgIGV2ZW50SWQ6IGRhdGEuZXZlbnRJZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChleGlzdGluZ1JTVlApIHtcbiAgICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIFJTVlBcbiAgICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuZXZlbnRBdHRlbmRhbmNlLnVwZGF0ZSh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIHVzZXJJZF9ldmVudElkOiB7XG4gICAgICAgICAgICAgIHVzZXJJZDogZGF0YS51c2VySWQsXG4gICAgICAgICAgICAgIGV2ZW50SWQ6IGRhdGEuZXZlbnRJZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ3JlYXRlIG5ldyBSU1ZQXG4gICAgICAgIGF3YWl0IHRoaXMucHJpc21hLmV2ZW50QXR0ZW5kYW5jZS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVzZXJJZDogZGF0YS51c2VySWQsXG4gICAgICAgICAgICBldmVudElkOiBkYXRhLmV2ZW50SWQsXG4gICAgICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBsb2dnZXIuaW5mbygnUlNWUCBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5JywgeyB1c2VySWQ6IGRhdGEudXNlcklkLCBldmVudElkOiBkYXRhLmV2ZW50SWQgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHByb2Nlc3MgUlNWUCcsIHsgZXJyb3IsIGRhdGEgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjaGVja0luQXR0ZW5kYW5jZShkYXRhOiBBdHRlbmRhbmNlQ2hlY2tJbkRhdGEpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nOyB1c2VyPzogVXNlciB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGxvZ2dlci5pbmZvKCdQcm9jZXNzaW5nIGF0dGVuZGFuY2UgY2hlY2staW4nLCB7IHFyQ29kZTogZGF0YS5xckNvZGUsIGV2ZW50SWQ6IGRhdGEuZXZlbnRJZCB9KTtcbiAgICAgIFxuICAgICAgLy8gRmluZCB1c2VyIGJ5IFFSIGNvZGVcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnByaXNtYS51c2VyLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7IHFyQ29kZTogZGF0YS5xckNvZGUgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oJ1VzZXIgbm90IGZvdW5kIGZvciBRUiBjb2RlJywgeyBxckNvZGU6IGRhdGEucXJDb2RlIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ0ludmFsaWQgUVIgY29kZScgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgZXZlbnQgZXhpc3RzXG4gICAgICBjb25zdCBldmVudCA9IGF3YWl0IHRoaXMucHJpc21hLmV2ZW50LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogZGF0YS5ldmVudElkIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFldmVudCkge1xuICAgICAgICBsb2dnZXIud2FybignRXZlbnQgbm90IGZvdW5kJywgeyBldmVudElkOiBkYXRhLmV2ZW50SWQgfSk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnRXZlbnQgbm90IGZvdW5kJyB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGlzIFJTVlAnZFxuICAgICAgY29uc3QgcnN2cCA9IGF3YWl0IHRoaXMucHJpc21hLmV2ZW50QXR0ZW5kYW5jZS5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB1c2VySWRfZXZlbnRJZDoge1xuICAgICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgICAgZXZlbnRJZDogZGF0YS5ldmVudElkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyc3ZwIHx8IHJzdnAuc3RhdHVzICE9PSAnYXR0ZW5kaW5nJykge1xuICAgICAgICBsb2dnZXIud2FybignVXNlciBub3QgUlNWUFxcJ2QgYXMgYXR0ZW5kaW5nJywgeyB1c2VySWQ6IHVzZXIuaWQsIGV2ZW50SWQ6IGRhdGEuZXZlbnRJZCB9KTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdVc2VyIG5vdCBSU1ZQXFwnZCBhcyBhdHRlbmRpbmcnIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBhdHRlbmRhbmNlIHJlY29yZFxuICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuZXZlbnRBdHRlbmRhbmNlLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgdXNlcklkX2V2ZW50SWQ6IHtcbiAgICAgICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgICAgIGV2ZW50SWQ6IGRhdGEuZXZlbnRJZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgY2hlY2tlZEluOiB0cnVlLFxuICAgICAgICAgIGNoZWNrSW5UaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKCdBdHRlbmRhbmNlIGNoZWNrLWluIHN1Y2Nlc3NmdWwnLCB7IHVzZXJJZDogdXNlci5pZCwgZXZlbnRJZDogZGF0YS5ldmVudElkIH0pO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogJ0NoZWNrLWluIHN1Y2Nlc3NmdWwnLCB1c2VyIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHByb2Nlc3MgYXR0ZW5kYW5jZSBjaGVjay1pbicsIHsgZXJyb3IsIGRhdGEgfSk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRFdmVudEF0dGVuZGFuY2UoZXZlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHRyeSB7XG4gICAgICBsb2dnZXIuaW5mbygnRmV0Y2hpbmcgZXZlbnQgYXR0ZW5kYW5jZScsIHsgZXZlbnRJZCB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgYXR0ZW5kYW5jZSA9IGF3YWl0IHRoaXMucHJpc21hLmV2ZW50QXR0ZW5kYW5jZS5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IGV2ZW50SWQgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgICAgIHFyQ29kZTogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdhc2MnIH0sXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGF0dGVuZGFuY2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGZldGNoIGV2ZW50IGF0dGVuZGFuY2UnLCB7IGVycm9yLCBldmVudElkIH0pO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsibG9nZ2VyIiwiRXZlbnRNYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJwcmlzbWEiLCJjcmVhdGVFdmVudCIsImRhdGEiLCJpbmZvIiwidGl0bGUiLCJjYXRlZ29yeSIsImV2ZW50IiwiY3JlYXRlIiwiZGVzY3JpcHRpb24iLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwibGlua2VkVGVhbUlkIiwiYXR0ZW5kYW5jZVR5cGUiLCJpbmNsdWRlIiwibGlua2VkVGVhbSIsInJzdnBzIiwidXNlciIsImNoZWNrSW5zIiwiZXZlbnRJZCIsImlkIiwiZXJyb3IiLCJnZXRFdmVudEJ5SWQiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJnZXRBbGxFdmVudHMiLCJmaWx0ZXJzIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsImd0ZSIsImx0ZSIsImV2ZW50cyIsImZpbmRNYW55Iiwib3JkZXJCeSIsInVwZGF0ZUV2ZW50IiwidXBkYXRlcyIsInVwZGF0ZSIsImRlbGV0ZUV2ZW50IiwiZXZlbnRBdHRlbmRhbmNlIiwiZGVsZXRlTWFueSIsImRlbGV0ZSIsInJzdnBUb0V2ZW50IiwidXNlcklkIiwic3RhdHVzIiwiZXhpc3RpbmdSU1ZQIiwidXNlcklkX2V2ZW50SWQiLCJ1cGRhdGVkQXQiLCJEYXRlIiwiY2hlY2tJbkF0dGVuZGFuY2UiLCJxckNvZGUiLCJmaW5kRmlyc3QiLCJ3YXJuIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJyc3ZwIiwiY2hlY2tlZEluIiwiY2hlY2tJblRpbWUiLCJnZXRFdmVudEF0dGVuZGFuY2UiLCJhdHRlbmRhbmNlIiwic2VsZWN0IiwibmFtZSIsImVtYWlsIiwiY3JlYXRlZEF0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/managers/eventManager.ts\n");

/***/ }),

/***/ "(api)/./src/managers/taskManager.ts":
/*!*************************************!*\
  !*** ./src/managers/taskManager.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TaskManager: () => (/* binding */ TaskManager)\n/* harmony export */ });\n/* harmony import */ var _utils_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/logger */ \"(api)/./src/utils/logger.ts\");\n/* harmony import */ var _tasks_queue__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../tasks/queue */ \"(api)/./src/tasks/queue.ts\");\n/* harmony import */ var _models_prismaClient__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/models/prismaClient */ \"(api)/./src/models/prismaClient.ts\");\n/* harmony import */ var _backgroundTaskManager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./backgroundTaskManager */ \"(api)/./src/managers/backgroundTaskManager.ts\");\n\n\n\n\nclass TaskManager {\n    constructor(){\n        this.emailQueue = _tasks_queue__WEBPACK_IMPORTED_MODULE_1__.emailQueue;\n        this.qrCodeQueue = _tasks_queue__WEBPACK_IMPORTED_MODULE_1__.qrCodeQueue;\n        this.syncGroupsQueue = _tasks_queue__WEBPACK_IMPORTED_MODULE_1__.syncGroupsQueue;\n        this.provisionQueue = _tasks_queue__WEBPACK_IMPORTED_MODULE_1__.provisionQueue;\n    }\n    async enqueueEmailJob(data, options) {\n        try {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Enqueueing email job\", {\n                to: data.to,\n                subject: data.subject\n            });\n            const job = await this.emailQueue.add(\"send-email\", data, {\n                delay: options?.delay || 0,\n                priority: options?.priority || 0,\n                attempts: options?.attempts || 3,\n                backoff: {\n                    type: \"exponential\",\n                    delay: 2000\n                }\n            });\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Email job enqueued successfully\", {\n                jobId: job.id\n            });\n            return job.id;\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to enqueue email job\", {\n                error,\n                data\n            });\n            throw error;\n        }\n    }\n    // High-level provisioning tasks that create DB task + enqueue provision job\n    async enqueueProvisionTask(params) {\n        const backgroundTaskManager = new _backgroundTaskManager__WEBPACK_IMPORTED_MODULE_3__.BackgroundTaskManager(_models_prismaClient__WEBPACK_IMPORTED_MODULE_2__.prisma);\n        const backgroundTask = await backgroundTaskManager.createTask({\n            name: params.name,\n            description: params.description,\n            entityType: params.entityType,\n            entityId: params.entityId,\n            subtaskNames: params.subtaskNames\n        });\n        const job = await this.provisionQueue.add(\"provision\", {\n            backgroundTaskId: backgroundTask.id,\n            provisionType: params.provisionType,\n            payload: params.payload\n        });\n        return {\n            jobId: job.id,\n            backgroundTaskId: backgroundTask.id\n        };\n    }\n    async enqueueQRCodeJob(data, options) {\n        try {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Enqueueing QR code generation job\", {\n                userId: data.userId\n            });\n            const job = await this.qrCodeQueue.add(\"generate-qr-code\", data, {\n                delay: options?.delay || 0,\n                priority: options?.priority || 0,\n                attempts: options?.attempts || 3,\n                backoff: {\n                    type: \"exponential\",\n                    delay: 2000\n                }\n            });\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"QR code job enqueued successfully\", {\n                jobId: job.id\n            });\n            return job.id;\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to enqueue QR code job\", {\n                error,\n                data\n            });\n            throw error;\n        }\n    }\n    async enqueueSyncGroupsJob(data, options) {\n        try {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Enqueueing sync groups job\", {\n                userId: data.userId,\n                force: data.force\n            });\n            const job = await this.syncGroupsQueue.add(\"sync-groups\", data, {\n                delay: options?.delay || 0,\n                priority: options?.priority || 0,\n                attempts: options?.attempts || 3,\n                backoff: {\n                    type: \"exponential\",\n                    delay: 5000\n                }\n            });\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Sync groups job enqueued successfully\", {\n                jobId: job.id\n            });\n            return job.id;\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to enqueue sync groups job\", {\n                error,\n                data\n            });\n            throw error;\n        }\n    }\n    async getJobStatus(queueName, jobId) {\n        try {\n            let queue;\n            switch(queueName){\n                case \"email\":\n                    queue = this.emailQueue;\n                    break;\n                case \"qr-code\":\n                    queue = this.qrCodeQueue;\n                    break;\n                case \"sync-groups\":\n                    queue = this.syncGroupsQueue;\n                    break;\n                default:\n                    throw new Error(`Unknown queue: ${queueName}`);\n            }\n            const job = await queue.getJob(jobId);\n            if (!job) {\n                return {\n                    status: \"not_found\"\n                };\n            }\n            const state = await job.getState();\n            const progress = await job.progress();\n            const failedReason = job.failedReason;\n            return {\n                id: job.id,\n                name: job.name,\n                status: state,\n                progress,\n                failedReason,\n                data: job.data,\n                createdAt: job.timestamp,\n                processedAt: job.processedOn,\n                finishedAt: job.finishedOn\n            };\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to get job status\", {\n                error,\n                queueName,\n                jobId\n            });\n            throw error;\n        }\n    }\n    async getQueueStats(queueName) {\n        try {\n            let queue;\n            switch(queueName){\n                case \"email\":\n                    queue = this.emailQueue;\n                    break;\n                case \"qr-code\":\n                    queue = this.qrCodeQueue;\n                    break;\n                case \"sync-groups\":\n                    queue = this.syncGroupsQueue;\n                    break;\n                default:\n                    throw new Error(`Unknown queue: ${queueName}`);\n            }\n            const [waiting, active, completed, failed, delayed] = await Promise.all([\n                queue.getWaiting(),\n                queue.getActive(),\n                queue.getCompleted(),\n                queue.getFailed(),\n                queue.getDelayed()\n            ]);\n            return {\n                waiting: waiting.length,\n                active: active.length,\n                completed: completed.length,\n                failed: failed.length,\n                delayed: delayed.length,\n                total: waiting.length + active.length + completed.length + failed.length + delayed.length\n            };\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to get queue stats\", {\n                error,\n                queueName\n            });\n            throw error;\n        }\n    }\n    async retryFailedJob(queueName, jobId) {\n        try {\n            let queue;\n            switch(queueName){\n                case \"email\":\n                    queue = this.emailQueue;\n                    break;\n                case \"qr-code\":\n                    queue = this.qrCodeQueue;\n                    break;\n                case \"sync-groups\":\n                    queue = this.syncGroupsQueue;\n                    break;\n                default:\n                    throw new Error(`Unknown queue: ${queueName}`);\n            }\n            const job = await queue.getJob(jobId);\n            if (!job) {\n                throw new Error(\"Job not found\");\n            }\n            await job.retry();\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Job retry initiated\", {\n                queueName,\n                jobId\n            });\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to retry job\", {\n                error,\n                queueName,\n                jobId\n            });\n            throw error;\n        }\n    }\n    async clearCompletedJobs(queueName) {\n        try {\n            let queue;\n            switch(queueName){\n                case \"email\":\n                    queue = this.emailQueue;\n                    break;\n                case \"qr-code\":\n                    queue = this.qrCodeQueue;\n                    break;\n                case \"sync-groups\":\n                    queue = this.syncGroupsQueue;\n                    break;\n                default:\n                    throw new Error(`Unknown queue: ${queueName}`);\n            }\n            await queue.clean(0, 1000, \"completed\");\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Completed jobs cleared\", {\n                queueName\n            });\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Failed to clear completed jobs\", {\n                error,\n                queueName\n            });\n            throw error;\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O2dCQUNOLEtBQUs7b0JBQ0hDLFFBQVEsSUFBSSxDQUFDM0MsVUFBVTtvQkFDdkI7Z0JBQ0YsS0FBSztvQkFDSDJDLFFBQVEsSUFBSSxDQUFDMUMsV0FBVztvQkFDeEI7Z0JBQ0YsS0FBSztvQkFDSDBDLFFBQVEsSUFBSSxDQUFDekMsZUFBZTtvQkFDNUI7Z0JBQ0Y7b0JBQ0UsTUFBTSxJQUFJMEMsTUFBTSxDQUFDLGVBQWUsRUFBRUYsVUFBVSxDQUFDO1lBQ2pEO1lBRUEsTUFBTUMsTUFBTWdDLEtBQUssQ0FBQyxHQUFHLE1BQU07WUFDM0I1RSxpREFBTUEsQ0FBQ1ksSUFBSSxDQUFDLDBCQUEwQjtnQkFBRStCO1lBQVU7UUFDcEQsRUFBRSxPQUFPbkIsT0FBTztZQUNkeEIsaURBQU1BLENBQUN3QixLQUFLLENBQUMsa0NBQWtDO2dCQUFFQTtnQkFBT21CO1lBQVU7WUFDbEUsTUFBTW5CO1FBQ1I7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXJtMzYwLWJhY2tlbmQvLi9zcmMvbWFuYWdlcnMvdGFza01hbmFnZXIudHM/NDRlYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBRdWV1ZSB9IGZyb20gJ2J1bGxtcSc7XHJcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XHJcbmltcG9ydCB7IGVtYWlsUXVldWUsIHFyQ29kZVF1ZXVlLCBzeW5jR3JvdXBzUXVldWUsIHByb3Zpc2lvblF1ZXVlIH0gZnJvbSAnLi4vdGFza3MvcXVldWUnO1xyXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL21vZGVscy9wcmlzbWFDbGllbnQnO1xyXG5pbXBvcnQgeyBCYWNrZ3JvdW5kVGFza01hbmFnZXIgfSBmcm9tICcuL2JhY2tncm91bmRUYXNrTWFuYWdlcic7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEVtYWlsSm9iRGF0YSB7XHJcbiAgdG86IHN0cmluZztcclxuICBzdWJqZWN0OiBzdHJpbmc7XHJcbiAgYm9keTogc3RyaW5nO1xyXG4gIHRlbXBsYXRlPzogc3RyaW5nO1xyXG4gIHZhcmlhYmxlcz86IFJlY29yZDxzdHJpbmcsIGFueT47XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUVJDb2RlSm9iRGF0YSB7XHJcbiAgdXNlcklkOiBzdHJpbmc7XHJcbiAgdXNlckVtYWlsOiBzdHJpbmc7XHJcbiAgdXNlck5hbWU6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBTeW5jR3JvdXBzSm9iRGF0YSB7XHJcbiAgdXNlcklkOiBzdHJpbmc7XHJcbiAgZm9yY2U/OiBib29sZWFuO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVGFza01hbmFnZXIge1xyXG4gIHByaXZhdGUgZW1haWxRdWV1ZTogUXVldWU7XHJcbiAgcHJpdmF0ZSBxckNvZGVRdWV1ZTogUXVldWU7XHJcbiAgcHJpdmF0ZSBzeW5jR3JvdXBzUXVldWU6IFF1ZXVlO1xyXG4gIHByaXZhdGUgcHJvdmlzaW9uUXVldWU6IFF1ZXVlO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuZW1haWxRdWV1ZSA9IGVtYWlsUXVldWU7XHJcbiAgICB0aGlzLnFyQ29kZVF1ZXVlID0gcXJDb2RlUXVldWU7XHJcbiAgICB0aGlzLnN5bmNHcm91cHNRdWV1ZSA9IHN5bmNHcm91cHNRdWV1ZTtcclxuICAgIHRoaXMucHJvdmlzaW9uUXVldWUgPSBwcm92aXNpb25RdWV1ZTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGVucXVldWVFbWFpbEpvYihkYXRhOiBFbWFpbEpvYkRhdGEsIG9wdGlvbnM/OiB7XHJcbiAgICBkZWxheT86IG51bWJlcjtcclxuICAgIHByaW9yaXR5PzogbnVtYmVyO1xyXG4gICAgYXR0ZW1wdHM/OiBudW1iZXI7XHJcbiAgfSk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsb2dnZXIuaW5mbygnRW5xdWV1ZWluZyBlbWFpbCBqb2InLCB7IHRvOiBkYXRhLnRvLCBzdWJqZWN0OiBkYXRhLnN1YmplY3QgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBqb2IgPSBhd2FpdCB0aGlzLmVtYWlsUXVldWUuYWRkKCdzZW5kLWVtYWlsJywgZGF0YSwge1xyXG4gICAgICAgIGRlbGF5OiBvcHRpb25zPy5kZWxheSB8fCAwLFxyXG4gICAgICAgIHByaW9yaXR5OiBvcHRpb25zPy5wcmlvcml0eSB8fCAwLFxyXG4gICAgICAgIGF0dGVtcHRzOiBvcHRpb25zPy5hdHRlbXB0cyB8fCAzLFxyXG4gICAgICAgIGJhY2tvZmY6IHtcclxuICAgICAgICAgIHR5cGU6ICdleHBvbmVudGlhbCcsXHJcbiAgICAgICAgICBkZWxheTogMjAwMCxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGxvZ2dlci5pbmZvKCdFbWFpbCBqb2IgZW5xdWV1ZWQgc3VjY2Vzc2Z1bGx5JywgeyBqb2JJZDogam9iLmlkIH0pO1xyXG4gICAgICByZXR1cm4gam9iLmlkIGFzIHN0cmluZztcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGVucXVldWUgZW1haWwgam9iJywgeyBlcnJvciwgZGF0YSB9KTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBIaWdoLWxldmVsIHByb3Zpc2lvbmluZyB0YXNrcyB0aGF0IGNyZWF0ZSBEQiB0YXNrICsgZW5xdWV1ZSBwcm92aXNpb24gam9iXHJcbiAgYXN5bmMgZW5xdWV1ZVByb3Zpc2lvblRhc2socGFyYW1zOiB7XHJcbiAgICBwcm92aXNpb25UeXBlOiAnVEVBTScgfCAnRVZFTlQnO1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XHJcbiAgICBlbnRpdHlUeXBlPzogc3RyaW5nO1xyXG4gICAgZW50aXR5SWQ/OiBzdHJpbmc7XHJcbiAgICBzdWJ0YXNrTmFtZXM6IHN0cmluZ1tdO1xyXG4gICAgcGF5bG9hZDogYW55O1xyXG4gIH0pOiBQcm9taXNlPHsgam9iSWQ6IHN0cmluZzsgYmFja2dyb3VuZFRhc2tJZDogc3RyaW5nIH0+IHtcclxuICAgIGNvbnN0IGJhY2tncm91bmRUYXNrTWFuYWdlciA9IG5ldyBCYWNrZ3JvdW5kVGFza01hbmFnZXIocHJpc21hKTtcclxuICAgIGNvbnN0IGJhY2tncm91bmRUYXNrID0gYXdhaXQgYmFja2dyb3VuZFRhc2tNYW5hZ2VyLmNyZWF0ZVRhc2soe1xyXG4gICAgICBuYW1lOiBwYXJhbXMubmFtZSxcclxuICAgICAgZGVzY3JpcHRpb246IHBhcmFtcy5kZXNjcmlwdGlvbixcclxuICAgICAgZW50aXR5VHlwZTogcGFyYW1zLmVudGl0eVR5cGUsXHJcbiAgICAgIGVudGl0eUlkOiBwYXJhbXMuZW50aXR5SWQsXHJcbiAgICAgIHN1YnRhc2tOYW1lczogcGFyYW1zLnN1YnRhc2tOYW1lc1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3Qgam9iID0gYXdhaXQgdGhpcy5wcm92aXNpb25RdWV1ZS5hZGQoJ3Byb3Zpc2lvbicsIHtcclxuICAgICAgYmFja2dyb3VuZFRhc2tJZDogYmFja2dyb3VuZFRhc2suaWQsXHJcbiAgICAgIHByb3Zpc2lvblR5cGU6IHBhcmFtcy5wcm92aXNpb25UeXBlLFxyXG4gICAgICBwYXlsb2FkOiBwYXJhbXMucGF5bG9hZFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4geyBqb2JJZDogam9iLmlkIGFzIHN0cmluZywgYmFja2dyb3VuZFRhc2tJZDogYmFja2dyb3VuZFRhc2suaWQgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGVucXVldWVRUkNvZGVKb2IoZGF0YTogUVJDb2RlSm9iRGF0YSwgb3B0aW9ucz86IHtcclxuICAgIGRlbGF5PzogbnVtYmVyO1xyXG4gICAgcHJpb3JpdHk/OiBudW1iZXI7XHJcbiAgICBhdHRlbXB0cz86IG51bWJlcjtcclxuICB9KTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGxvZ2dlci5pbmZvKCdFbnF1ZXVlaW5nIFFSIGNvZGUgZ2VuZXJhdGlvbiBqb2InLCB7IHVzZXJJZDogZGF0YS51c2VySWQgfSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBqb2IgPSBhd2FpdCB0aGlzLnFyQ29kZVF1ZXVlLmFkZCgnZ2VuZXJhdGUtcXItY29kZScsIGRhdGEsIHtcclxuICAgICAgICBkZWxheTogb3B0aW9ucz8uZGVsYXkgfHwgMCxcclxuICAgICAgICBwcmlvcml0eTogb3B0aW9ucz8ucHJpb3JpdHkgfHwgMCxcclxuICAgICAgICBhdHRlbXB0czogb3B0aW9ucz8uYXR0ZW1wdHMgfHwgMyxcclxuICAgICAgICBiYWNrb2ZmOiB7XHJcbiAgICAgICAgICB0eXBlOiAnZXhwb25lbnRpYWwnLFxyXG4gICAgICAgICAgZGVsYXk6IDIwMDAsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBsb2dnZXIuaW5mbygnUVIgY29kZSBqb2IgZW5xdWV1ZWQgc3VjY2Vzc2Z1bGx5JywgeyBqb2JJZDogam9iLmlkIH0pO1xyXG4gICAgICByZXR1cm4gam9iLmlkIGFzIHN0cmluZztcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGVucXVldWUgUVIgY29kZSBqb2InLCB7IGVycm9yLCBkYXRhIH0pO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGVucXVldWVTeW5jR3JvdXBzSm9iKGRhdGE6IFN5bmNHcm91cHNKb2JEYXRhLCBvcHRpb25zPzoge1xyXG4gICAgZGVsYXk/OiBudW1iZXI7XHJcbiAgICBwcmlvcml0eT86IG51bWJlcjtcclxuICAgIGF0dGVtcHRzPzogbnVtYmVyO1xyXG4gIH0pOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbG9nZ2VyLmluZm8oJ0VucXVldWVpbmcgc3luYyBncm91cHMgam9iJywgeyB1c2VySWQ6IGRhdGEudXNlcklkLCBmb3JjZTogZGF0YS5mb3JjZSB9KTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGpvYiA9IGF3YWl0IHRoaXMuc3luY0dyb3Vwc1F1ZXVlLmFkZCgnc3luYy1ncm91cHMnLCBkYXRhLCB7XHJcbiAgICAgICAgZGVsYXk6IG9wdGlvbnM/LmRlbGF5IHx8IDAsXHJcbiAgICAgICAgcHJpb3JpdHk6IG9wdGlvbnM/LnByaW9yaXR5IHx8IDAsXHJcbiAgICAgICAgYXR0ZW1wdHM6IG9wdGlvbnM/LmF0dGVtcHRzIHx8IDMsXHJcbiAgICAgICAgYmFja29mZjoge1xyXG4gICAgICAgICAgdHlwZTogJ2V4cG9uZW50aWFsJyxcclxuICAgICAgICAgIGRlbGF5OiA1MDAwLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbG9nZ2VyLmluZm8oJ1N5bmMgZ3JvdXBzIGpvYiBlbnF1ZXVlZCBzdWNjZXNzZnVsbHknLCB7IGpvYklkOiBqb2IuaWQgfSk7XHJcbiAgICAgIHJldHVybiBqb2IuaWQgYXMgc3RyaW5nO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZW5xdWV1ZSBzeW5jIGdyb3VwcyBqb2InLCB7IGVycm9yLCBkYXRhIH0pO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGdldEpvYlN0YXR1cyhxdWV1ZU5hbWU6IHN0cmluZywgam9iSWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgcXVldWU6IFF1ZXVlO1xyXG4gICAgICBcclxuICAgICAgc3dpdGNoIChxdWV1ZU5hbWUpIHtcclxuICAgICAgICBjYXNlICdlbWFpbCc6XHJcbiAgICAgICAgICBxdWV1ZSA9IHRoaXMuZW1haWxRdWV1ZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3FyLWNvZGUnOlxyXG4gICAgICAgICAgcXVldWUgPSB0aGlzLnFyQ29kZVF1ZXVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnc3luYy1ncm91cHMnOlxyXG4gICAgICAgICAgcXVldWUgPSB0aGlzLnN5bmNHcm91cHNRdWV1ZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gcXVldWU6ICR7cXVldWVOYW1lfWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBqb2IgPSBhd2FpdCBxdWV1ZS5nZXRKb2Ioam9iSWQpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFqb2IpIHtcclxuICAgICAgICByZXR1cm4geyBzdGF0dXM6ICdub3RfZm91bmQnIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgam9iLmdldFN0YXRlKCk7XHJcbiAgICAgIGNvbnN0IHByb2dyZXNzID0gYXdhaXQgam9iLnByb2dyZXNzKCk7XHJcbiAgICAgIGNvbnN0IGZhaWxlZFJlYXNvbiA9IGpvYi5mYWlsZWRSZWFzb247XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGlkOiBqb2IuaWQsXHJcbiAgICAgICAgbmFtZTogam9iLm5hbWUsXHJcbiAgICAgICAgc3RhdHVzOiBzdGF0ZSxcclxuICAgICAgICBwcm9ncmVzcyxcclxuICAgICAgICBmYWlsZWRSZWFzb24sXHJcbiAgICAgICAgZGF0YTogam9iLmRhdGEsXHJcbiAgICAgICAgY3JlYXRlZEF0OiBqb2IudGltZXN0YW1wLFxyXG4gICAgICAgIHByb2Nlc3NlZEF0OiBqb2IucHJvY2Vzc2VkT24sXHJcbiAgICAgICAgZmluaXNoZWRBdDogam9iLmZpbmlzaGVkT24sXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgam9iIHN0YXR1cycsIHsgZXJyb3IsIHF1ZXVlTmFtZSwgam9iSWQgfSk7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0UXVldWVTdGF0cyhxdWV1ZU5hbWU6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgcXVldWU6IFF1ZXVlO1xyXG4gICAgICBcclxuICAgICAgc3dpdGNoIChxdWV1ZU5hbWUpIHtcclxuICAgICAgICBjYXNlICdlbWFpbCc6XHJcbiAgICAgICAgICBxdWV1ZSA9IHRoaXMuZW1haWxRdWV1ZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3FyLWNvZGUnOlxyXG4gICAgICAgICAgcXVldWUgPSB0aGlzLnFyQ29kZVF1ZXVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnc3luYy1ncm91cHMnOlxyXG4gICAgICAgICAgcXVldWUgPSB0aGlzLnN5bmNHcm91cHNRdWV1ZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gcXVldWU6ICR7cXVldWVOYW1lfWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBbd2FpdGluZywgYWN0aXZlLCBjb21wbGV0ZWQsIGZhaWxlZCwgZGVsYXllZF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgICAgcXVldWUuZ2V0V2FpdGluZygpLFxyXG4gICAgICAgIHF1ZXVlLmdldEFjdGl2ZSgpLFxyXG4gICAgICAgIHF1ZXVlLmdldENvbXBsZXRlZCgpLFxyXG4gICAgICAgIHF1ZXVlLmdldEZhaWxlZCgpLFxyXG4gICAgICAgIHF1ZXVlLmdldERlbGF5ZWQoKSxcclxuICAgICAgXSk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHdhaXRpbmc6IHdhaXRpbmcubGVuZ3RoLFxyXG4gICAgICAgIGFjdGl2ZTogYWN0aXZlLmxlbmd0aCxcclxuICAgICAgICBjb21wbGV0ZWQ6IGNvbXBsZXRlZC5sZW5ndGgsXHJcbiAgICAgICAgZmFpbGVkOiBmYWlsZWQubGVuZ3RoLFxyXG4gICAgICAgIGRlbGF5ZWQ6IGRlbGF5ZWQubGVuZ3RoLFxyXG4gICAgICAgIHRvdGFsOiB3YWl0aW5nLmxlbmd0aCArIGFjdGl2ZS5sZW5ndGggKyBjb21wbGV0ZWQubGVuZ3RoICsgZmFpbGVkLmxlbmd0aCArIGRlbGF5ZWQubGVuZ3RoLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZ2V0IHF1ZXVlIHN0YXRzJywgeyBlcnJvciwgcXVldWVOYW1lIH0pO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIHJldHJ5RmFpbGVkSm9iKHF1ZXVlTmFtZTogc3RyaW5nLCBqb2JJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgcXVldWU6IFF1ZXVlO1xyXG4gICAgICBcclxuICAgICAgc3dpdGNoIChxdWV1ZU5hbWUpIHtcclxuICAgICAgICBjYXNlICdlbWFpbCc6XHJcbiAgICAgICAgICBxdWV1ZSA9IHRoaXMuZW1haWxRdWV1ZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3FyLWNvZGUnOlxyXG4gICAgICAgICAgcXVldWUgPSB0aGlzLnFyQ29kZVF1ZXVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnc3luYy1ncm91cHMnOlxyXG4gICAgICAgICAgcXVldWUgPSB0aGlzLnN5bmNHcm91cHNRdWV1ZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gcXVldWU6ICR7cXVldWVOYW1lfWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBqb2IgPSBhd2FpdCBxdWV1ZS5nZXRKb2Ioam9iSWQpO1xyXG4gICAgICBcclxuICAgICAgaWYgKCFqb2IpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0pvYiBub3QgZm91bmQnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYXdhaXQgam9iLnJldHJ5KCk7XHJcbiAgICAgIGxvZ2dlci5pbmZvKCdKb2IgcmV0cnkgaW5pdGlhdGVkJywgeyBxdWV1ZU5hbWUsIGpvYklkIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gcmV0cnkgam9iJywgeyBlcnJvciwgcXVldWVOYW1lLCBqb2JJZCB9KTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBjbGVhckNvbXBsZXRlZEpvYnMocXVldWVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGxldCBxdWV1ZTogUXVldWU7XHJcbiAgICAgIFxyXG4gICAgICBzd2l0Y2ggKHF1ZXVlTmFtZSkge1xyXG4gICAgICAgIGNhc2UgJ2VtYWlsJzpcclxuICAgICAgICAgIHF1ZXVlID0gdGhpcy5lbWFpbFF1ZXVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncXItY29kZSc6XHJcbiAgICAgICAgICBxdWV1ZSA9IHRoaXMucXJDb2RlUXVldWU7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdzeW5jLWdyb3Vwcyc6XHJcbiAgICAgICAgICBxdWV1ZSA9IHRoaXMuc3luY0dyb3Vwc1F1ZXVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBxdWV1ZTogJHtxdWV1ZU5hbWV9YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGF3YWl0IHF1ZXVlLmNsZWFuKDAsIDEwMDAsICdjb21wbGV0ZWQnKTtcclxuICAgICAgbG9nZ2VyLmluZm8oJ0NvbXBsZXRlZCBqb2JzIGNsZWFyZWQnLCB7IHF1ZXVlTmFtZSB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGNsZWFyIGNvbXBsZXRlZCBqb2JzJywgeyBlcnJvciwgcXVldWVOYW1lIH0pO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbImxvZ2dlciIsImVtYWlsUXVldWUiLCJxckNvZGVRdWV1ZSIsInN5bmNHcm91cHNRdWV1ZSIsInByb3Zpc2lvblF1ZXVlIiwicHJpc21hIiwiQmFja2dyb3VuZFRhc2tNYW5hZ2VyIiwiVGFza01hbmFnZXIiLCJjb25zdHJ1Y3RvciIsImVucXVldWVFbWFpbEpvYiIsImRhdGEiLCJvcHRpb25zIiwiaW5mbyIsInRvIiwic3ViamVjdCIsImpvYiIsImFkZCIsImRlbGF5IiwicHJpb3JpdHkiLCJhdHRlbXB0cyIsImJhY2tvZmYiLCJ0eXBlIiwiam9iSWQiLCJpZCIsImVycm9yIiwiZW5xdWV1ZVByb3Zpc2lvblRhc2siLCJwYXJhbXMiLCJiYWNrZ3JvdW5kVGFza01hbmFnZXIiLCJiYWNrZ3JvdW5kVGFzayIsImNyZWF0ZVRhc2siLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJzdWJ0YXNrTmFtZXMiLCJiYWNrZ3JvdW5kVGFza0lkIiwicHJvdmlzaW9uVHlwZSIsInBheWxvYWQiLCJlbnF1ZXVlUVJDb2RlSm9iIiwidXNlcklkIiwiZW5xdWV1ZVN5bmNHcm91cHNKb2IiLCJmb3JjZSIsImdldEpvYlN0YXR1cyIsInF1ZXVlTmFtZSIsInF1ZXVlIiwiRXJyb3IiLCJnZXRKb2IiLCJzdGF0dXMiLCJzdGF0ZSIsImdldFN0YXRlIiwicHJvZ3Jlc3MiLCJmYWlsZWRSZWFzb24iLCJjcmVhdGVkQXQiLCJ0aW1lc3RhbXAiLCJwcm9jZXNzZWRBdCIsInByb2Nlc3NlZE9uIiwiZmluaXNoZWRBdCIsImZpbmlzaGVkT24iLCJnZXRRdWV1ZVN0YXRzIiwid2FpdGluZyIsImFjdGl2ZSIsImNvbXBsZXRlZCIsImZhaWxlZCIsImRlbGF5ZWQiLCJQcm9taXNlIiwiYWxsIiwiZ2V0V2FpdGluZyIsImdldEFjdGl2ZSIsImdldENvbXBsZXRlZCIsImdldEZhaWxlZCIsImdldERlbGF5ZWQiLCJsZW5ndGgiLCJ0b3RhbCIsInJldHJ5RmFpbGVkSm9iIiwicmV0cnkiLCJjbGVhckNvbXBsZXRlZEpvYnMiLCJjbGVhbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/managers/taskManager.ts\n");

/***/ }),

/***/ "(api)/./src/middleware/authMiddleware.ts":
/*!******************************************!*\
  !*** ./src/middleware/authMiddleware.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withAuth: () => (/* binding */ withAuth)\n/* harmony export */ });\n/* harmony import */ var _utils_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/utils/logger */ \"(api)/./src/utils/logger.ts\");\n/* harmony import */ var _utils_roleUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/utils/roleUtils */ \"(api)/./src/utils/roleUtils.ts\");\n\n\n// Helper function to determine effective role based on OIDC groups\nfunction getEffectiveRole(userRole, authentikGroups) {\n    // If user has tech-team group, elevate to admin regardless of base role\n    if (authentikGroups.includes(\"tech-team\")) {\n        _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"User has tech-team group, elevating to admin role\", {\n            originalRole: userRole,\n            authentikGroups\n        });\n        return \"ADMIN\";\n    }\n    // Get the effective system role, ensuring it's not a class rank role\n    return (0,_utils_roleUtils__WEBPACK_IMPORTED_MODULE_1__.getEffectiveSystemRole)(userRole);\n}\nfunction withAuth(handler) {\n    return async (req, res)=>{\n        try {\n            // Get the authorization header\n            const authHeader = req.headers.authorization;\n            if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n                return res.status(401).json({\n                    error: \"Unauthorized\",\n                    message: \"Missing or invalid authorization header\"\n                });\n            }\n            // Extract the token\n            const token = authHeader.substring(7);\n            // Verify the JWT token\n            const decoded = verifyJWT(token);\n            if (!decoded || !decoded.id) {\n                return res.status(401).json({\n                    error: \"Unauthorized\",\n                    message: \"Invalid token\"\n                });\n            }\n            // Get user from database\n            const user = await getUserById(decoded.id);\n            if (!user) {\n                return res.status(401).json({\n                    error: \"Unauthorized\",\n                    message: \"User not found\"\n                });\n            }\n            // Determine effective role based on OIDC groups and system role\n            const effectiveRole = getEffectiveRole(user.role, user.authentikGroups || []);\n            // Add user info to request\n            req.user = {\n                id: user.id,\n                email: user.email,\n                firstName: user.firstName,\n                lastName: user.lastName,\n                role: effectiveRole,\n                groups: user.authentikGroups || []\n            };\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"User authenticated successfully\", {\n                userId: user.id,\n                email: user.email,\n                originalRole: user.role,\n                effectiveRole,\n                authentikGroups: user.authentikGroups\n            });\n            // Call the original handler\n            await handler(req, res);\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Authentication error:\", error);\n            return res.status(401).json({\n                error: \"Unauthorized\",\n                message: \"Authentication failed\"\n            });\n        }\n    };\n}\n// Helper function to verify JWT token\nfunction verifyJWT(token) {\n    try {\n        const jwt = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n        const secret = process.env.JWT_SECRET;\n        if (!secret) {\n            throw new Error(\"JWT_SECRET not configured\");\n        }\n        return jwt.verify(token, secret);\n    } catch (error) {\n        _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"JWT verification failed:\", error);\n        return null;\n    }\n}\n// Helper function to get user by ID\nasync function getUserById(userId) {\n    try {\n        const { prisma } = __webpack_require__(/*! @/models/prismaClient */ \"(api)/./src/models/prismaClient.ts\");\n        const user = await prisma.user.findUnique({\n            where: {\n                id: userId\n            },\n            select: {\n                id: true,\n                email: true,\n                firstName: true,\n                lastName: true,\n                role: true,\n                authentikId: true\n            }\n        });\n        if (!user) {\n            return null;\n        }\n        // For now, we'll assume authentikGroups is empty\n        // This would need to be populated from the OIDC provider\n        user.authentikGroups = [];\n        return user;\n    } catch (error) {\n        _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Error getting user by ID:\", error);\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TztJQUNUO0FBQ0Y7QUFFQSxvQ0FBb0M7QUFDcEMsZUFBZVEsWUFBWU8sTUFBYztJQUN2QyxJQUFJO1FBQ0YsTUFBTSxFQUFFUyxNQUFNLEVBQUUsR0FBR1AsbUJBQU9BLENBQUM7UUFFM0IsTUFBTVYsT0FBTyxNQUFNaUIsT0FBT2pCLElBQUksQ0FBQ2tCLFVBQVUsQ0FBQztZQUN4Q0MsT0FBTztnQkFBRXBCLElBQUlTO1lBQU87WUFDcEJZLFFBQVE7Z0JBQ05yQixJQUFJO2dCQUNKSyxPQUFPO2dCQUNQQyxXQUFXO2dCQUNYQyxVQUFVO2dCQUNWSCxNQUFNO2dCQUNOa0IsYUFBYTtZQUNmO1FBQ0Y7UUFFQSxJQUFJLENBQUNyQixNQUFNO1lBQ1QsT0FBTztRQUNUO1FBRUEsaURBQWlEO1FBQ2pELHlEQUF5RDtRQUN6REEsS0FBS3JCLGVBQWUsR0FBRyxFQUFFO1FBRXpCLE9BQU9xQjtJQUNULEVBQUUsT0FBT1AsT0FBTztRQUNkbEIsaURBQU1BLENBQUNrQixLQUFLLENBQUMsNkJBQTZCQTtRQUMxQyxPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL21ybTM2MC1iYWNrZW5kLy4vc3JjL21pZGRsZXdhcmUvYXV0aE1pZGRsZXdhcmUudHM/Mjg0ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBnZXRFZmZlY3RpdmVTeXN0ZW1Sb2xlIH0gZnJvbSAnQC91dGlscy9yb2xlVXRpbHMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhlbnRpY2F0ZWRSZXF1ZXN0IGV4dGVuZHMgTmV4dEFwaVJlcXVlc3Qge1xuICB1c2VyOiB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBlbWFpbDogc3RyaW5nO1xuICAgIGZpcnN0TmFtZTogc3RyaW5nO1xuICAgIGxhc3ROYW1lOiBzdHJpbmc7XG4gICAgcm9sZTogc3RyaW5nO1xuICAgIGdyb3Vwczogc3RyaW5nW107XG4gIH07XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBkZXRlcm1pbmUgZWZmZWN0aXZlIHJvbGUgYmFzZWQgb24gT0lEQyBncm91cHNcbmZ1bmN0aW9uIGdldEVmZmVjdGl2ZVJvbGUodXNlclJvbGU6IHN0cmluZywgYXV0aGVudGlrR3JvdXBzOiBzdHJpbmdbXSk6IHN0cmluZyB7XG4gIC8vIElmIHVzZXIgaGFzIHRlY2gtdGVhbSBncm91cCwgZWxldmF0ZSB0byBhZG1pbiByZWdhcmRsZXNzIG9mIGJhc2Ugcm9sZVxuICBpZiAoYXV0aGVudGlrR3JvdXBzLmluY2x1ZGVzKCd0ZWNoLXRlYW0nKSkge1xuICAgIGxvZ2dlci5pbmZvKCdVc2VyIGhhcyB0ZWNoLXRlYW0gZ3JvdXAsIGVsZXZhdGluZyB0byBhZG1pbiByb2xlJywge1xuICAgICAgb3JpZ2luYWxSb2xlOiB1c2VyUm9sZSxcbiAgICAgIGF1dGhlbnRpa0dyb3Vwc1xuICAgIH0pO1xuICAgIHJldHVybiAnQURNSU4nO1xuICB9XG4gIFxuICAvLyBHZXQgdGhlIGVmZmVjdGl2ZSBzeXN0ZW0gcm9sZSwgZW5zdXJpbmcgaXQncyBub3QgYSBjbGFzcyByYW5rIHJvbGVcbiAgcmV0dXJuIGdldEVmZmVjdGl2ZVN5c3RlbVJvbGUodXNlclJvbGUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gd2l0aEF1dGgoaGFuZGxlcjogKHJlcTogQXV0aGVudGljYXRlZFJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSA9PiBQcm9taXNlPHZvaWQ+KSB7XG4gIHJldHVybiBhc3luYyAocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IHRoZSBhdXRob3JpemF0aW9uIGhlYWRlclxuICAgICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XG4gICAgICBcbiAgICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgXG4gICAgICAgICAgZXJyb3I6ICdVbmF1dGhvcml6ZWQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdNaXNzaW5nIG9yIGludmFsaWQgYXV0aG9yaXphdGlvbiBoZWFkZXInIFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gRXh0cmFjdCB0aGUgdG9rZW5cbiAgICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5zdWJzdHJpbmcoNyk7XG4gICAgICBcbiAgICAgIC8vIFZlcmlmeSB0aGUgSldUIHRva2VuXG4gICAgICBjb25zdCBkZWNvZGVkID0gdmVyaWZ5SldUKHRva2VuKTtcbiAgICAgIFxuICAgICAgaWYgKCFkZWNvZGVkIHx8ICFkZWNvZGVkLmlkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IFxuICAgICAgICAgIGVycm9yOiAnVW5hdXRob3JpemVkJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCB0b2tlbicgXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdXNlciBmcm9tIGRhdGFiYXNlXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgZ2V0VXNlckJ5SWQoZGVjb2RlZC5pZCk7XG4gICAgICBcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBcbiAgICAgICAgICBlcnJvcjogJ1VuYXV0aG9yaXplZCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyBcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIERldGVybWluZSBlZmZlY3RpdmUgcm9sZSBiYXNlZCBvbiBPSURDIGdyb3VwcyBhbmQgc3lzdGVtIHJvbGVcbiAgICAgIGNvbnN0IGVmZmVjdGl2ZVJvbGUgPSBnZXRFZmZlY3RpdmVSb2xlKHVzZXIucm9sZSwgdXNlci5hdXRoZW50aWtHcm91cHMgfHwgW10pO1xuXG4gICAgICAvLyBBZGQgdXNlciBpbmZvIHRvIHJlcXVlc3RcbiAgICAgIChyZXEgYXMgQXV0aGVudGljYXRlZFJlcXVlc3QpLnVzZXIgPSB7XG4gICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgZmlyc3ROYW1lOiB1c2VyLmZpcnN0TmFtZSxcbiAgICAgICAgbGFzdE5hbWU6IHVzZXIubGFzdE5hbWUsXG4gICAgICAgIHJvbGU6IGVmZmVjdGl2ZVJvbGUsXG4gICAgICAgIGdyb3VwczogdXNlci5hdXRoZW50aWtHcm91cHMgfHwgW11cbiAgICAgIH07XG5cbiAgICAgIGxvZ2dlci5pbmZvKCdVc2VyIGF1dGhlbnRpY2F0ZWQgc3VjY2Vzc2Z1bGx5Jywge1xuICAgICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICBvcmlnaW5hbFJvbGU6IHVzZXIucm9sZSxcbiAgICAgICAgZWZmZWN0aXZlUm9sZSxcbiAgICAgICAgYXV0aGVudGlrR3JvdXBzOiB1c2VyLmF1dGhlbnRpa0dyb3Vwc1xuICAgICAgfSk7XG5cbiAgICAgIC8vIENhbGwgdGhlIG9yaWdpbmFsIGhhbmRsZXJcbiAgICAgIGF3YWl0IGhhbmRsZXIocmVxIGFzIEF1dGhlbnRpY2F0ZWRSZXF1ZXN0LCByZXMpO1xuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignQXV0aGVudGljYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgXG4gICAgICAgIGVycm9yOiAnVW5hdXRob3JpemVkJyxcbiAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCcgXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byB2ZXJpZnkgSldUIHRva2VuXG5mdW5jdGlvbiB2ZXJpZnlKV1QodG9rZW46IHN0cmluZyk6IGFueSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XG4gICAgY29uc3Qgc2VjcmV0ID0gcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVDtcbiAgICBcbiAgICBpZiAoIXNlY3JldCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdKV1RfU0VDUkVUIG5vdCBjb25maWd1cmVkJyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBqd3QudmVyaWZ5KHRva2VuLCBzZWNyZXQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignSldUIHZlcmlmaWNhdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgdXNlciBieSBJRFxuYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckJ5SWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgcHJpc21hIH0gPSByZXF1aXJlKCdAL21vZGVscy9wcmlzbWFDbGllbnQnKTtcbiAgICBcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICBzZWxlY3Q6IHtcbiAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICByb2xlOiB0cnVlLFxuICAgICAgICBhdXRoZW50aWtJZDogdHJ1ZVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBGb3Igbm93LCB3ZSdsbCBhc3N1bWUgYXV0aGVudGlrR3JvdXBzIGlzIGVtcHR5XG4gICAgLy8gVGhpcyB3b3VsZCBuZWVkIHRvIGJlIHBvcHVsYXRlZCBmcm9tIHRoZSBPSURDIHByb3ZpZGVyXG4gICAgdXNlci5hdXRoZW50aWtHcm91cHMgPSBbXTtcblxuICAgIHJldHVybiB1c2VyO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZ2V0dGluZyB1c2VyIGJ5IElEOicsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImxvZ2dlciIsImdldEVmZmVjdGl2ZVN5c3RlbVJvbGUiLCJnZXRFZmZlY3RpdmVSb2xlIiwidXNlclJvbGUiLCJhdXRoZW50aWtHcm91cHMiLCJpbmNsdWRlcyIsImluZm8iLCJvcmlnaW5hbFJvbGUiLCJ3aXRoQXV0aCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJzdGFydHNXaXRoIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwibWVzc2FnZSIsInRva2VuIiwic3Vic3RyaW5nIiwiZGVjb2RlZCIsInZlcmlmeUpXVCIsImlkIiwidXNlciIsImdldFVzZXJCeUlkIiwiZWZmZWN0aXZlUm9sZSIsInJvbGUiLCJlbWFpbCIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwiZ3JvdXBzIiwidXNlcklkIiwiand0IiwicmVxdWlyZSIsInNlY3JldCIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUIiwiRXJyb3IiLCJ2ZXJpZnkiLCJwcmlzbWEiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJzZWxlY3QiLCJhdXRoZW50aWtJZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/middleware/authMiddleware.ts\n");

/***/ }),

/***/ "(api)/./src/middleware/corsMiddleware.ts":
/*!******************************************!*\
  !*** ./src/middleware/corsMiddleware.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withCORS: () => (/* binding */ withCORS)\n/* harmony export */ });\nfunction withCORS(handler) {\n    return async (req, res)=>{\n        // Set CORS headers\n        const allowedOrigin = process.env.FRONTEND_URL || \"http://localhost:3011\";\n        res.setHeader(\"Access-Control-Allow-Credentials\", \"true\");\n        res.setHeader(\"Access-Control-Allow-Origin\", allowedOrigin);\n        res.setHeader(\"Access-Control-Allow-Methods\", \"GET,OPTIONS,PATCH,DELETE,POST,PUT\");\n        res.setHeader(\"Access-Control-Allow-Headers\", \"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization\");\n        // Handle preflight request\n        if (req.method === \"OPTIONS\") {\n            res.status(200).end();\n            return;\n        }\n        // Call the original handler\n        await handler(req, res);\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbWlkZGxld2FyZS9jb3JzTWlkZGxld2FyZS50cyIsIm1hcHBpbmdzIjoiOzs7O0FBRU8sU0FBU0EsU0FBU0MsT0FBcUU7SUFDNUYsT0FBTyxPQUFPQyxLQUFxQkM7UUFDakMsbUJBQW1CO1FBQ25CLE1BQU1DLGdCQUFnQkMsUUFBUUMsR0FBRyxDQUFDQyxZQUFZLElBQUk7UUFFbERKLElBQUlLLFNBQVMsQ0FBQyxvQ0FBb0M7UUFDbERMLElBQUlLLFNBQVMsQ0FBQywrQkFBK0JKO1FBQzdDRCxJQUFJSyxTQUFTLENBQUMsZ0NBQWdDO1FBQzlDTCxJQUFJSyxTQUFTLENBQUMsZ0NBQWdDO1FBRTlDLDJCQUEyQjtRQUMzQixJQUFJTixJQUFJTyxNQUFNLEtBQUssV0FBVztZQUM1Qk4sSUFBSU8sTUFBTSxDQUFDLEtBQUtDLEdBQUc7WUFDbkI7UUFDRjtRQUVBLDRCQUE0QjtRQUM1QixNQUFNVixRQUFRQyxLQUFLQztJQUNyQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXJtMzYwLWJhY2tlbmQvLi9zcmMvbWlkZGxld2FyZS9jb3JzTWlkZGxld2FyZS50cz8zYjljIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcblxuZXhwb3J0IGZ1bmN0aW9uIHdpdGhDT1JTKGhhbmRsZXI6IChyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkgPT4gUHJvbWlzZTx2b2lkPikge1xuICByZXR1cm4gYXN5bmMgKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSA9PiB7XG4gICAgLy8gU2V0IENPUlMgaGVhZGVyc1xuICAgIGNvbnN0IGFsbG93ZWRPcmlnaW4gPSBwcm9jZXNzLmVudi5GUk9OVEVORF9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAxMSc7XG4gICAgXG4gICAgcmVzLnNldEhlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctQ3JlZGVudGlhbHMnLCAndHJ1ZScpO1xuICAgIHJlcy5zZXRIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsIGFsbG93ZWRPcmlnaW4pO1xuICAgIHJlcy5zZXRIZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMnLCAnR0VULE9QVElPTlMsUEFUQ0gsREVMRVRFLFBPU1QsUFVUJyk7XG4gICAgcmVzLnNldEhlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycycsICdYLUNTUkYtVG9rZW4sIFgtUmVxdWVzdGVkLVdpdGgsIEFjY2VwdCwgQWNjZXB0LVZlcnNpb24sIENvbnRlbnQtTGVuZ3RoLCBDb250ZW50LU1ENSwgQ29udGVudC1UeXBlLCBEYXRlLCBYLUFwaS1WZXJzaW9uLCBBdXRob3JpemF0aW9uJyk7XG5cbiAgICAvLyBIYW5kbGUgcHJlZmxpZ2h0IHJlcXVlc3RcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ09QVElPTlMnKSB7XG4gICAgICByZXMuc3RhdHVzKDIwMCkuZW5kKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ2FsbCB0aGUgb3JpZ2luYWwgaGFuZGxlclxuICAgIGF3YWl0IGhhbmRsZXIocmVxLCByZXMpO1xuICB9O1xufVxuIl0sIm5hbWVzIjpbIndpdGhDT1JTIiwiaGFuZGxlciIsInJlcSIsInJlcyIsImFsbG93ZWRPcmlnaW4iLCJwcm9jZXNzIiwiZW52IiwiRlJPTlRFTkRfVVJMIiwic2V0SGVhZGVyIiwibWV0aG9kIiwic3RhdHVzIiwiZW5kIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/middleware/corsMiddleware.ts\n");

/***/ }),

/***/ "(api)/./src/middleware/permissionMiddleware.ts":
/*!************************************************!*\
  !*** ./src/middleware/permissionMiddleware.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withPermissions: () => (/* binding */ withPermissions)\n/* harmony export */ });\n/* harmony import */ var _utils_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/utils/logger */ \"(api)/./src/utils/logger.ts\");\n/* harmony import */ var _utils_roleUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/utils/roleUtils */ \"(api)/./src/utils/roleUtils.ts\");\n\n\nfunction withPermissions(handler, requiredPermissions) {\n    return async (req, res)=>{\n        try {\n            // Get the required permissions\n            const permissions = typeof requiredPermissions === \"function\" ? requiredPermissions(req) : requiredPermissions;\n            // Get user from request (should be set by auth middleware)\n            const user = req.user;\n            if (!user) {\n                return res.status(401).json({\n                    error: \"Unauthorized\",\n                    message: \"User not authenticated\"\n                });\n            }\n            // Check permissions\n            const hasPermission = await checkPermissions(user, permissions);\n            if (!hasPermission) {\n                return res.status(403).json({\n                    error: \"Forbidden\",\n                    message: \"Permission check failed\"\n                });\n            }\n            // Call the handler\n            await handler(req, res);\n        } catch (error) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Permission middleware error:\", error);\n            return res.status(500).json({\n                error: \"Internal server error\",\n                message: \"Permission check failed\"\n            });\n        }\n    };\n}\nasync function checkPermissions(user, requiredPermissions) {\n    // For now, implement a simple role-based permission system\n    // This can be enhanced later with a more sophisticated permission system\n    const rolePermissions = {\n        \"ADMIN\": [\n            \"users:read\",\n            \"users:create\",\n            \"users:update\",\n            \"users:delete\",\n            \"groups:read\",\n            \"groups:create\",\n            \"groups:update\",\n            \"groups:delete\",\n            \"events:read\",\n            \"events:create\",\n            \"events:update\",\n            \"events:delete\",\n            \"teams:read\",\n            \"teams:write\",\n            \"teams:create\",\n            \"teams:update\",\n            \"teams:delete\",\n            \"tasks:read\",\n            \"tasks:create\",\n            \"tasks:update\",\n            \"tasks:delete\",\n            \"tasks:enqueue\"\n        ],\n        \"EXEC_BOARD\": [\n            \"users:read\",\n            \"users:create\",\n            \"users:update\",\n            \"groups:read\",\n            \"groups:create\",\n            \"groups:update\",\n            \"events:read\",\n            \"events:create\",\n            \"events:update\",\n            \"teams:read\",\n            \"teams:write\",\n            \"teams:create\",\n            \"teams:update\",\n            \"tasks:read\",\n            \"tasks:create\",\n            \"tasks:update\"\n        ],\n        \"MEMBER\": [\n            \"users:read\",\n            \"groups:read\",\n            \"events:read\",\n            \"teams:read\",\n            \"tasks:read\"\n        ]\n    };\n    // Check if user has tech-team group in authentikGroups (OIDC groups)\n    // If they do, give them admin permissions regardless of their role\n    let effectiveRole = (0,_utils_roleUtils__WEBPACK_IMPORTED_MODULE_1__.getEffectiveSystemRole)(user.role);\n    if (user.authentikGroups && Array.isArray(user.authentikGroups)) {\n        if (user.authentikGroups.includes(\"tech-team\")) {\n            effectiveRole = \"ADMIN\";\n            _utils_logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"User has tech-team group, elevating to admin permissions\", {\n                userId: user.id,\n                originalRole: user.role,\n                effectiveRole,\n                authentikGroups: user.authentikGroups\n            });\n        }\n    }\n    const userPermissions = rolePermissions[effectiveRole] || [];\n    // Check if user has all required permissions\n    return requiredPermissions.every((permission)=>userPermissions.includes(permission));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbWlkZGxld2FyZS9wZXJtaXNzaW9uTWlkZGxld2FyZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFDd0M7QUFDbUI7QUFhcEQsU0FBU0UsZ0JBQ2RDLE9BQXdFLEVBQ3hFQyxtQkFBbUU7SUFFbkUsT0FBTyxPQUFPQyxLQUFxQkM7UUFDakMsSUFBSTtZQUNGLCtCQUErQjtZQUMvQixNQUFNQyxjQUFjLE9BQU9ILHdCQUF3QixhQUMvQ0Esb0JBQW9CQyxPQUNwQkQ7WUFFSiwyREFBMkQ7WUFDM0QsTUFBTUksT0FBTyxJQUFhQSxJQUFJO1lBRTlCLElBQUksQ0FBQ0EsTUFBTTtnQkFDVCxPQUFPRixJQUFJRyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUMxQkMsT0FBTztvQkFDUEMsU0FBUztnQkFDWDtZQUNGO1lBRUEsb0JBQW9CO1lBQ3BCLE1BQU1DLGdCQUFnQixNQUFNQyxpQkFBaUJOLE1BQU1EO1lBRW5ELElBQUksQ0FBQ00sZUFBZTtnQkFDbEIsT0FBT1AsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFDMUJDLE9BQU87b0JBQ1BDLFNBQVM7Z0JBQ1g7WUFDRjtZQUVBLG1CQUFtQjtZQUNuQixNQUFNVCxRQUFRRSxLQUEwQkM7UUFFMUMsRUFBRSxPQUFPSyxPQUFPO1lBQ2RYLGlEQUFNQSxDQUFDVyxLQUFLLENBQUMsZ0NBQWdDQTtZQUM3QyxPQUFPTCxJQUFJRyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQkMsT0FBTztnQkFDUEMsU0FBUztZQUNYO1FBQ0Y7SUFDRjtBQUNGO0FBRUEsZUFBZUUsaUJBQWlCTixJQUFTLEVBQUVKLG1CQUE2QjtJQUN0RSwyREFBMkQ7SUFDM0QseUVBQXlFO0lBRXpFLE1BQU1XLGtCQUE0QztRQUNoRCxTQUFTO1lBQ1A7WUFBYztZQUFnQjtZQUFnQjtZQUM5QztZQUFlO1lBQWlCO1lBQWlCO1lBQ2pEO1lBQWU7WUFBaUI7WUFBaUI7WUFDakQ7WUFBYztZQUFlO1lBQWdCO1lBQWdCO1lBQzdEO1lBQWM7WUFBZ0I7WUFBZ0I7WUFBZ0I7U0FDL0Q7UUFDRCxjQUFjO1lBQ1o7WUFBYztZQUFnQjtZQUM5QjtZQUFlO1lBQWlCO1lBQ2hDO1lBQWU7WUFBaUI7WUFDaEM7WUFBYztZQUFlO1lBQWdCO1lBQzdDO1lBQWM7WUFBZ0I7U0FDL0I7UUFDRCxVQUFVO1lBQ1I7WUFDQTtZQUNBO1lBQ0E7WUFDQTtTQUNEO0lBQ0g7SUFFQSxxRUFBcUU7SUFDckUsbUVBQW1FO0lBQ25FLElBQUlDLGdCQUFnQmYsd0VBQXNCQSxDQUFDTyxLQUFLUyxJQUFJO0lBQ3BELElBQUlULEtBQUtVLGVBQWUsSUFBSUMsTUFBTUMsT0FBTyxDQUFDWixLQUFLVSxlQUFlLEdBQUc7UUFDL0QsSUFBSVYsS0FBS1UsZUFBZSxDQUFDRyxRQUFRLENBQUMsY0FBYztZQUM5Q0wsZ0JBQWdCO1lBQ2hCaEIsaURBQU1BLENBQUNzQixJQUFJLENBQUMsNERBQTREO2dCQUN0RUMsUUFBUWYsS0FBS2dCLEVBQUU7Z0JBQ2ZDLGNBQWNqQixLQUFLUyxJQUFJO2dCQUN2QkQ7Z0JBQ0FFLGlCQUFpQlYsS0FBS1UsZUFBZTtZQUN2QztRQUNGO0lBQ0Y7SUFFQSxNQUFNUSxrQkFBa0JYLGVBQWUsQ0FBQ0MsY0FBYyxJQUFJLEVBQUU7SUFFNUQsNkNBQTZDO0lBQzdDLE9BQU9aLG9CQUFvQnVCLEtBQUssQ0FBQ0MsQ0FBQUEsYUFBY0YsZ0JBQWdCTCxRQUFRLENBQUNPO0FBQzFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXJtMzYwLWJhY2tlbmQvLi9zcmMvbWlkZGxld2FyZS9wZXJtaXNzaW9uTWlkZGxld2FyZS50cz9mODE0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ0AvdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IGdldEVmZmVjdGl2ZVN5c3RlbVJvbGUgfSBmcm9tICdAL3V0aWxzL3JvbGVVdGlscyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVybWlzc2lvblJlcXVlc3QgZXh0ZW5kcyBOZXh0QXBpUmVxdWVzdCB7XG4gIHVzZXI6IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIGVtYWlsOiBzdHJpbmc7XG4gICAgZmlyc3ROYW1lOiBzdHJpbmc7XG4gICAgbGFzdE5hbWU6IHN0cmluZztcbiAgICByb2xlOiBzdHJpbmc7XG4gICAgZ3JvdXBzOiBzdHJpbmdbXTtcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdpdGhQZXJtaXNzaW9ucyhcbiAgaGFuZGxlcjogKHJlcTogUGVybWlzc2lvblJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSA9PiBQcm9taXNlPHZvaWQ+LFxuICByZXF1aXJlZFBlcm1pc3Npb25zOiBzdHJpbmdbXSB8ICgocmVxOiBOZXh0QXBpUmVxdWVzdCkgPT4gc3RyaW5nW10pXG4pIHtcbiAgcmV0dXJuIGFzeW5jIChyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgdGhlIHJlcXVpcmVkIHBlcm1pc3Npb25zXG4gICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IHR5cGVvZiByZXF1aXJlZFBlcm1pc3Npb25zID09PSAnZnVuY3Rpb24nIFxuICAgICAgICA/IHJlcXVpcmVkUGVybWlzc2lvbnMocmVxKSBcbiAgICAgICAgOiByZXF1aXJlZFBlcm1pc3Npb25zO1xuXG4gICAgICAvLyBHZXQgdXNlciBmcm9tIHJlcXVlc3QgKHNob3VsZCBiZSBzZXQgYnkgYXV0aCBtaWRkbGV3YXJlKVxuICAgICAgY29uc3QgdXNlciA9IChyZXEgYXMgYW55KS51c2VyO1xuICAgICAgXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgXG4gICAgICAgICAgZXJyb3I6ICdVbmF1dGhvcml6ZWQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBhdXRoZW50aWNhdGVkJyBcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHBlcm1pc3Npb25zXG4gICAgICBjb25zdCBoYXNQZXJtaXNzaW9uID0gYXdhaXQgY2hlY2tQZXJtaXNzaW9ucyh1c2VyLCBwZXJtaXNzaW9ucyk7XG4gICAgICBcbiAgICAgIGlmICghaGFzUGVybWlzc2lvbikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBcbiAgICAgICAgICBlcnJvcjogJ0ZvcmJpZGRlbicsXG4gICAgICAgICAgbWVzc2FnZTogJ1Blcm1pc3Npb24gY2hlY2sgZmFpbGVkJyBcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGwgdGhlIGhhbmRsZXJcbiAgICAgIGF3YWl0IGhhbmRsZXIocmVxIGFzIFBlcm1pc3Npb25SZXF1ZXN0LCByZXMpO1xuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignUGVybWlzc2lvbiBtaWRkbGV3YXJlIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdQZXJtaXNzaW9uIGNoZWNrIGZhaWxlZCcgXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNoZWNrUGVybWlzc2lvbnModXNlcjogYW55LCByZXF1aXJlZFBlcm1pc3Npb25zOiBzdHJpbmdbXSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAvLyBGb3Igbm93LCBpbXBsZW1lbnQgYSBzaW1wbGUgcm9sZS1iYXNlZCBwZXJtaXNzaW9uIHN5c3RlbVxuICAvLyBUaGlzIGNhbiBiZSBlbmhhbmNlZCBsYXRlciB3aXRoIGEgbW9yZSBzb3BoaXN0aWNhdGVkIHBlcm1pc3Npb24gc3lzdGVtXG4gIFxuICBjb25zdCByb2xlUGVybWlzc2lvbnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPiA9IHtcbiAgICAnQURNSU4nOiBbXG4gICAgICAndXNlcnM6cmVhZCcsICd1c2VyczpjcmVhdGUnLCAndXNlcnM6dXBkYXRlJywgJ3VzZXJzOmRlbGV0ZScsXG4gICAgICAnZ3JvdXBzOnJlYWQnLCAnZ3JvdXBzOmNyZWF0ZScsICdncm91cHM6dXBkYXRlJywgJ2dyb3VwczpkZWxldGUnLFxuICAgICAgJ2V2ZW50czpyZWFkJywgJ2V2ZW50czpjcmVhdGUnLCAnZXZlbnRzOnVwZGF0ZScsICdldmVudHM6ZGVsZXRlJyxcbiAgICAgICd0ZWFtczpyZWFkJywgJ3RlYW1zOndyaXRlJywgJ3RlYW1zOmNyZWF0ZScsICd0ZWFtczp1cGRhdGUnLCAndGVhbXM6ZGVsZXRlJyxcbiAgICAgICd0YXNrczpyZWFkJywgJ3Rhc2tzOmNyZWF0ZScsICd0YXNrczp1cGRhdGUnLCAndGFza3M6ZGVsZXRlJywgJ3Rhc2tzOmVucXVldWUnXG4gICAgXSxcbiAgICAnRVhFQ19CT0FSRCc6IFtcbiAgICAgICd1c2VyczpyZWFkJywgJ3VzZXJzOmNyZWF0ZScsICd1c2Vyczp1cGRhdGUnLFxuICAgICAgJ2dyb3VwczpyZWFkJywgJ2dyb3VwczpjcmVhdGUnLCAnZ3JvdXBzOnVwZGF0ZScsXG4gICAgICAnZXZlbnRzOnJlYWQnLCAnZXZlbnRzOmNyZWF0ZScsICdldmVudHM6dXBkYXRlJyxcbiAgICAgICd0ZWFtczpyZWFkJywgJ3RlYW1zOndyaXRlJywgJ3RlYW1zOmNyZWF0ZScsICd0ZWFtczp1cGRhdGUnLFxuICAgICAgJ3Rhc2tzOnJlYWQnLCAndGFza3M6Y3JlYXRlJywgJ3Rhc2tzOnVwZGF0ZSdcbiAgICBdLFxuICAgICdNRU1CRVInOiBbXG4gICAgICAndXNlcnM6cmVhZCcsXG4gICAgICAnZ3JvdXBzOnJlYWQnLFxuICAgICAgJ2V2ZW50czpyZWFkJyxcbiAgICAgICd0ZWFtczpyZWFkJyxcbiAgICAgICd0YXNrczpyZWFkJ1xuICAgIF1cbiAgfTtcblxuICAvLyBDaGVjayBpZiB1c2VyIGhhcyB0ZWNoLXRlYW0gZ3JvdXAgaW4gYXV0aGVudGlrR3JvdXBzIChPSURDIGdyb3VwcylcbiAgLy8gSWYgdGhleSBkbywgZ2l2ZSB0aGVtIGFkbWluIHBlcm1pc3Npb25zIHJlZ2FyZGxlc3Mgb2YgdGhlaXIgcm9sZVxuICBsZXQgZWZmZWN0aXZlUm9sZSA9IGdldEVmZmVjdGl2ZVN5c3RlbVJvbGUodXNlci5yb2xlKTtcbiAgaWYgKHVzZXIuYXV0aGVudGlrR3JvdXBzICYmIEFycmF5LmlzQXJyYXkodXNlci5hdXRoZW50aWtHcm91cHMpKSB7XG4gICAgaWYgKHVzZXIuYXV0aGVudGlrR3JvdXBzLmluY2x1ZGVzKCd0ZWNoLXRlYW0nKSkge1xuICAgICAgZWZmZWN0aXZlUm9sZSA9ICdBRE1JTic7XG4gICAgICBsb2dnZXIuaW5mbygnVXNlciBoYXMgdGVjaC10ZWFtIGdyb3VwLCBlbGV2YXRpbmcgdG8gYWRtaW4gcGVybWlzc2lvbnMnLCB7XG4gICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgb3JpZ2luYWxSb2xlOiB1c2VyLnJvbGUsXG4gICAgICAgIGVmZmVjdGl2ZVJvbGUsXG4gICAgICAgIGF1dGhlbnRpa0dyb3VwczogdXNlci5hdXRoZW50aWtHcm91cHNcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHVzZXJQZXJtaXNzaW9ucyA9IHJvbGVQZXJtaXNzaW9uc1tlZmZlY3RpdmVSb2xlXSB8fCBbXTtcbiAgXG4gIC8vIENoZWNrIGlmIHVzZXIgaGFzIGFsbCByZXF1aXJlZCBwZXJtaXNzaW9uc1xuICByZXR1cm4gcmVxdWlyZWRQZXJtaXNzaW9ucy5ldmVyeShwZXJtaXNzaW9uID0+IHVzZXJQZXJtaXNzaW9ucy5pbmNsdWRlcyhwZXJtaXNzaW9uKSk7XG59XG4iXSwibmFtZXMiOlsibG9nZ2VyIiwiZ2V0RWZmZWN0aXZlU3lzdGVtUm9sZSIsIndpdGhQZXJtaXNzaW9ucyIsImhhbmRsZXIiLCJyZXF1aXJlZFBlcm1pc3Npb25zIiwicmVxIiwicmVzIiwicGVybWlzc2lvbnMiLCJ1c2VyIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwibWVzc2FnZSIsImhhc1Blcm1pc3Npb24iLCJjaGVja1Blcm1pc3Npb25zIiwicm9sZVBlcm1pc3Npb25zIiwiZWZmZWN0aXZlUm9sZSIsInJvbGUiLCJhdXRoZW50aWtHcm91cHMiLCJBcnJheSIsImlzQXJyYXkiLCJpbmNsdWRlcyIsImluZm8iLCJ1c2VySWQiLCJpZCIsIm9yaWdpbmFsUm9sZSIsInVzZXJQZXJtaXNzaW9ucyIsImV2ZXJ5IiwicGVybWlzc2lvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/middleware/permissionMiddleware.ts\n");

/***/ }),

/***/ "(api)/./src/models/prismaClient.ts":
/*!************************************!*\
  !*** ./src/models/prismaClient.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst prisma = globalThis.__prisma || new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log:  true ? [\n        \"query\",\n        \"error\",\n        \"warn\"\n    ] : 0\n});\nif (true) {\n    globalThis.__prisma = prisma;\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (prisma);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbW9kZWxzL3ByaXNtYUNsaWVudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQThDO0FBTXZDLE1BQU1DLFNBQVNDLFdBQVdDLFFBQVEsSUFBSSxJQUFJSCx3REFBWUEsQ0FBQztJQUM1REksS0FBS0MsS0FBeUIsR0FBZ0I7UUFBQztRQUFTO1FBQVM7S0FBTyxHQUFHLENBQVM7QUFDdEYsR0FBRztBQUVILElBQUlBLElBQXlCLEVBQWM7SUFDekNILFdBQVdDLFFBQVEsR0FBR0Y7QUFDeEI7QUFFQSxpRUFBZUEsTUFBTUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL21ybTM2MC1iYWNrZW5kLy4vc3JjL21vZGVscy9wcmlzbWFDbGllbnQudHM/N2M1MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XHJcblxyXG5kZWNsYXJlIGdsb2JhbCB7XHJcbiAgdmFyIF9fcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBwcmlzbWEgPSBnbG9iYWxUaGlzLl9fcHJpc21hIHx8IG5ldyBQcmlzbWFDbGllbnQoe1xyXG4gIGxvZzogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBbJ3F1ZXJ5JywgJ2Vycm9yJywgJ3dhcm4nXSA6IFsnZXJyb3InXSxcclxufSk7XHJcblxyXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gIGdsb2JhbFRoaXMuX19wcmlzbWEgPSBwcmlzbWE7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHByaXNtYTtcclxuIl0sIm5hbWVzIjpbIlByaXNtYUNsaWVudCIsInByaXNtYSIsImdsb2JhbFRoaXMiLCJfX3ByaXNtYSIsImxvZyIsInByb2Nlc3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/models/prismaClient.ts\n");

/***/ }),

/***/ "(api)/./src/pages/api/events/index.ts":
/*!***************************************!*\
  !*** ./src/pages/api/events/index.ts ***!
  \***************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"zod\");\n/* harmony import */ var _models_prismaClient__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../models/prismaClient */ \"(api)/./src/models/prismaClient.ts\");\n/* harmony import */ var _managers_eventManager__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../managers/eventManager */ \"(api)/./src/managers/eventManager.ts\");\n/* harmony import */ var _managers_taskManager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/managers/taskManager */ \"(api)/./src/managers/taskManager.ts\");\n/* harmony import */ var _middleware_corsMiddleware__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../middleware/corsMiddleware */ \"(api)/./src/middleware/corsMiddleware.ts\");\n/* harmony import */ var _middleware_authMiddleware__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../middleware/authMiddleware */ \"(api)/./src/middleware/authMiddleware.ts\");\n/* harmony import */ var _middleware_permissionMiddleware__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../middleware/permissionMiddleware */ \"(api)/./src/middleware/permissionMiddleware.ts\");\n/* harmony import */ var _utils_logger__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../utils/logger */ \"(api)/./src/utils/logger.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([zod__WEBPACK_IMPORTED_MODULE_0__]);\nzod__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\n\n// Validation schemas\nconst createEventSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    title: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1).max(200),\n    description: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    startTime: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().transform((val)=>new Date(val)),\n    endTime: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().transform((val)=>new Date(val)),\n    category: zod__WEBPACK_IMPORTED_MODULE_0__.z.enum([\n        \"MEETING\",\n        \"COMPETITION\",\n        \"WORKSHOP\",\n        \"SOCIAL\",\n        \"TRAINING\"\n    ]),\n    linkedTeamId: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    attendanceType: zod__WEBPACK_IMPORTED_MODULE_0__.z.enum([\n        \"STRICT\",\n        \"SOFT\"\n    ])\n});\nconst listEventsSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    page: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional().transform((val)=>parseInt(val || \"1\")),\n    limit: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional().transform((val)=>parseInt(val || \"20\")),\n    search: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    category: zod__WEBPACK_IMPORTED_MODULE_0__.z.enum([\n        \"MEETING\",\n        \"COMPETITION\",\n        \"WORKSHOP\",\n        \"SOCIAL\",\n        \"TRAINING\"\n    ]).optional(),\n    linkedTeamId: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    startDate: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional().transform((val)=>val ? new Date(val) : undefined),\n    endDate: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional().transform((val)=>val ? new Date(val) : undefined)\n});\n/**\n * @swagger\n * /api/events:\n *   get:\n *     summary: List events with filtering and pagination\n *     tags: [Events]\n *     security:\n *       - sessionAuth: []\n *     parameters:\n *       - in: query\n *         name: page\n *         schema:\n *           type: integer\n *           default: 1\n *         description: Page number for pagination\n *       - in: query\n *         name: limit\n *         schema:\n *           type: integer\n *           default: 20\n *         description: Number of events per page\n *       - in: query\n *         name: search\n *         schema:\n *           type: string\n *         description: Search term for event title\n *       - in: query\n *         name: category\n *         schema:\n *           type: string\n *           enum: [MEETING, COMPETITION, WORKSHOP, SOCIAL, OTHER]\n *         description: Filter by event category\n *       - in: query\n *         name: linkedTeamId\n *         schema:\n *           type: string\n *         description: Filter by linked team\n *       - in: query\n *         name: startDate\n *         schema:\n *           type: string\n *           format: date\n *         description: Filter events starting from this date\n *       - in: query\n *         name: endDate\n *         schema:\n *           type: string\n *           format: date\n *         description: Filter events starting before this date\n *     responses:\n *       200:\n *         description: List of events\n *         content:\n *           application/json:\n *             schema:\n *               type: object\n *               properties:\n *                 events:\n *                   type: array\n *                   items:\n *                     $ref: '#/components/schemas/Event'\n *                 pagination:\n *                   type: object\n *                   properties:\n *                     page:\n *                       type: integer\n *                     limit:\n *                       type: integer\n *                     total:\n *                       type: integer\n *                     totalPages:\n *                       type: integer\n *       401:\n *         description: Unauthorized\n *       403:\n *         description: Forbidden - insufficient permissions\n *       500:\n *         description: Internal server error\n *   post:\n *     summary: Create a new event\n *     tags: [Events]\n *     security:\n *       - sessionAuth: []\n *     requestBody:\n *       required: true\n *       content:\n *         application/json:\n *           schema:\n *             type: object\n *             required:\n *               - title\n *               - startTime\n *               - endTime\n *               - category\n *               - attendanceType\n *             properties:\n *               title:\n *                 type: string\n *                 minLength: 1\n *                 maxLength: 200\n *               description:\n *                 type: string\n *               startTime:\n *                 type: string\n *                 format: date-time\n *               endTime:\n *                 type: string\n *                 format: date-time\n *               category:\n *                 type: string\n *                 enum: [MEETING, COMPETITION, WORKSHOP, SOCIAL, OTHER]\n *               linkedTeamId:\n *                 type: string\n *               attendanceType:\n *                 type: string\n *                 enum: [STRICT, SOFT]\n *     responses:\n *       201:\n *         description: Event created successfully\n *         content:\n *           application/json:\n *             schema:\n *               $ref: '#/components/schemas/Event'\n *       400:\n *         description: Bad request - validation error\n *       401:\n *         description: Unauthorized\n *       403:\n *         description: Forbidden - insufficient permissions\n *       500:\n *         description: Internal server error\n */ async function handler(req, res) {\n    const eventManager = new _managers_eventManager__WEBPACK_IMPORTED_MODULE_2__.EventManager(_models_prismaClient__WEBPACK_IMPORTED_MODULE_1__.prisma);\n    const taskManager = new _managers_taskManager__WEBPACK_IMPORTED_MODULE_3__.TaskManager();\n    try {\n        if (req.method === \"GET\") {\n            // List events\n            const queryParams = listEventsSchema.parse(req.query);\n            const result = await eventManager.getAllEvents({\n                category: queryParams.category,\n                linkedTeamId: queryParams.linkedTeamId,\n                startDate: queryParams.startDate,\n                endDate: queryParams.endDate\n            });\n            // Simple pagination (in production, implement proper pagination)\n            const page = queryParams.page;\n            const limit = queryParams.limit;\n            const startIndex = (page - 1) * limit;\n            const endIndex = startIndex + limit;\n            const paginatedEvents = result.slice(startIndex, endIndex);\n            const total = result.length;\n            const totalPages = Math.ceil(total / limit);\n            res.status(200).json({\n                success: true,\n                data: paginatedEvents,\n                pagination: {\n                    page,\n                    limit,\n                    total,\n                    totalPages\n                }\n            });\n        } else if (req.method === \"POST\") {\n            // Create event\n            const body = createEventSchema.parse(req.body);\n            const event = await eventManager.createEvent(body);\n            // Enqueue simulated event setup task\n            const subtaskNames = [\n                \"Validate event details\",\n                \"Create internal records\",\n                \"Create Nextcloud calendar entry (simulated)\",\n                \"Generate RSVP link (simulated)\",\n                \"Prepare Wiretap/OpenStack resources (simulated)\"\n            ];\n            await taskManager.enqueueProvisionTask({\n                provisionType: \"EVENT\",\n                name: `Provision resources for event ${event.title}`,\n                description: \"Simulated event resource setup\",\n                entityType: \"EVENT\",\n                entityId: event.id,\n                subtaskNames,\n                payload: {\n                    eventId: event.id\n                }\n            });\n            res.status(201).json({\n                success: true,\n                data: event\n            });\n        } else {\n            res.status(405).json({\n                error: \"Method not allowed\"\n            });\n        }\n    } catch (error) {\n        if (error instanceof zod__WEBPACK_IMPORTED_MODULE_0__.z.ZodError) {\n            _utils_logger__WEBPACK_IMPORTED_MODULE_7__.logger.warn(\"Validation error in events API\", {\n                errors: error.errors\n            });\n            return res.status(400).json({\n                error: \"Validation error\",\n                details: error.errors\n            });\n        }\n        _utils_logger__WEBPACK_IMPORTED_MODULE_7__.logger.error(\"Error in events API\", {\n            error,\n            method: req.method\n        });\n        res.status(500).json({\n            error: \"Internal server error\"\n        });\n    }\n}\n// Apply middleware: CORS, authentication then permissions\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_middleware_corsMiddleware__WEBPACK_IMPORTED_MODULE_4__.withCORS)((0,_middleware_authMiddleware__WEBPACK_IMPORTED_MODULE_5__.withAuth)((0,_middleware_permissionMiddleware__WEBPACK_IMPORTED_MODULE_6__.withPermissions)(handler, (req)=>{\n    // GET requests only need read permission, POST requests need create permission\n    if (req.method === \"GET\") {\n        return [\n            \"events:read\"\n        ];\n    } else if (req.method === \"POST\") {\n        return [\n            \"events:create\"\n        ];\n    }\n    return [];\n}))));\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGtDQUFrQztnQkFBRUMsUUFBUUgsTUFBTUcsTUFBTTtZQUFDO1lBQ3JFLE9BQU90QyxJQUFJa0IsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRWdCLE9BQU87Z0JBQW9CSSxTQUFTSixNQUFNRyxNQUFNO1lBQUM7UUFDakY7UUFFQWxFLGlEQUFNQSxDQUFDK0QsS0FBSyxDQUFDLHVCQUF1QjtZQUFFQTtZQUFPaEMsUUFBUUosSUFBSUksTUFBTTtRQUFDO1FBQ2hFSCxJQUFJa0IsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFZ0IsT0FBTztRQUF3QjtJQUN4RDtBQUNGO0FBRUEsMERBQTBEO0FBQzFELGlFQUFlbEUsb0VBQVFBLENBQ3JCQyxvRUFBUUEsQ0FDTkMsaUZBQWVBLENBQ2IyQixTQUNBLENBQUNDO0lBQ0MsK0VBQStFO0lBQy9FLElBQUlBLElBQUlJLE1BQU0sS0FBSyxPQUFPO1FBQ3hCLE9BQU87WUFBQztTQUFjO0lBQ3hCLE9BQU8sSUFBSUosSUFBSUksTUFBTSxLQUFLLFFBQVE7UUFDaEMsT0FBTztZQUFDO1NBQWdCO0lBQzFCO0lBQ0EsT0FBTyxFQUFFO0FBQ1gsTUFHSiIsInNvdXJjZXMiOlsid2VicGFjazovL21ybTM2MC1iYWNrZW5kLy4vc3JjL3BhZ2VzL2FwaS9ldmVudHMvaW5kZXgudHM/ZjA3OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uLy4uLy4uL21vZGVscy9wcmlzbWFDbGllbnQnO1xuaW1wb3J0IHsgRXZlbnRNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vLi4vbWFuYWdlcnMvZXZlbnRNYW5hZ2VyJztcbmltcG9ydCB7IFRhc2tNYW5hZ2VyIH0gZnJvbSAnQC9tYW5hZ2Vycy90YXNrTWFuYWdlcic7XG5pbXBvcnQgeyB3aXRoQ09SUyB9IGZyb20gJy4uLy4uLy4uL21pZGRsZXdhcmUvY29yc01pZGRsZXdhcmUnO1xuaW1wb3J0IHsgd2l0aEF1dGggfSBmcm9tICcuLi8uLi8uLi9taWRkbGV3YXJlL2F1dGhNaWRkbGV3YXJlJztcbmltcG9ydCB7IHdpdGhQZXJtaXNzaW9ucyB9IGZyb20gJy4uLy4uLy4uL21pZGRsZXdhcmUvcGVybWlzc2lvbk1pZGRsZXdhcmUnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvbG9nZ2VyJztcblxuLy8gVmFsaWRhdGlvbiBzY2hlbWFzXG5jb25zdCBjcmVhdGVFdmVudFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgdGl0bGU6IHouc3RyaW5nKCkubWluKDEpLm1heCgyMDApLFxuICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBzdGFydFRpbWU6IHouc3RyaW5nKCkudHJhbnNmb3JtKHZhbCA9PiBuZXcgRGF0ZSh2YWwpKSxcbiAgZW5kVGltZTogei5zdHJpbmcoKS50cmFuc2Zvcm0odmFsID0+IG5ldyBEYXRlKHZhbCkpLFxuICBjYXRlZ29yeTogei5lbnVtKFsnTUVFVElORycsICdDT01QRVRJVElPTicsICdXT1JLU0hPUCcsICdTT0NJQUwnLCAnVFJBSU5JTkcnXSksXG4gIGxpbmtlZFRlYW1JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBhdHRlbmRhbmNlVHlwZTogei5lbnVtKFsnU1RSSUNUJywgJ1NPRlQnXSksXG59KTtcblxuY29uc3QgbGlzdEV2ZW50c1NjaGVtYSA9IHoub2JqZWN0KHtcbiAgcGFnZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLnRyYW5zZm9ybSh2YWwgPT4gcGFyc2VJbnQodmFsIHx8ICcxJykpLFxuICBsaW1pdDogei5zdHJpbmcoKS5vcHRpb25hbCgpLnRyYW5zZm9ybSh2YWwgPT4gcGFyc2VJbnQodmFsIHx8ICcyMCcpKSxcbiAgc2VhcmNoOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGNhdGVnb3J5OiB6LmVudW0oWydNRUVUSU5HJywgJ0NPTVBFVElUSU9OJywgJ1dPUktTSE9QJywgJ1NPQ0lBTCcsICdUUkFJTklORyddKS5vcHRpb25hbCgpLFxuICBsaW5rZWRUZWFtSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgc3RhcnREYXRlOiB6LnN0cmluZygpLm9wdGlvbmFsKCkudHJhbnNmb3JtKHZhbCA9PiB2YWwgPyBuZXcgRGF0ZSh2YWwpIDogdW5kZWZpbmVkKSxcbiAgZW5kRGF0ZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLnRyYW5zZm9ybSh2YWwgPT4gdmFsID8gbmV3IERhdGUodmFsKSA6IHVuZGVmaW5lZCksXG59KTtcblxuLyoqXG4gKiBAc3dhZ2dlclxuICogL2FwaS9ldmVudHM6XG4gKiAgIGdldDpcbiAqICAgICBzdW1tYXJ5OiBMaXN0IGV2ZW50cyB3aXRoIGZpbHRlcmluZyBhbmQgcGFnaW5hdGlvblxuICogICAgIHRhZ3M6IFtFdmVudHNdXG4gKiAgICAgc2VjdXJpdHk6XG4gKiAgICAgICAtIHNlc3Npb25BdXRoOiBbXVxuICogICAgIHBhcmFtZXRlcnM6XG4gKiAgICAgICAtIGluOiBxdWVyeVxuICogICAgICAgICBuYW1lOiBwYWdlXG4gKiAgICAgICAgIHNjaGVtYTpcbiAqICAgICAgICAgICB0eXBlOiBpbnRlZ2VyXG4gKiAgICAgICAgICAgZGVmYXVsdDogMVxuICogICAgICAgICBkZXNjcmlwdGlvbjogUGFnZSBudW1iZXIgZm9yIHBhZ2luYXRpb25cbiAqICAgICAgIC0gaW46IHF1ZXJ5XG4gKiAgICAgICAgIG5hbWU6IGxpbWl0XG4gKiAgICAgICAgIHNjaGVtYTpcbiAqICAgICAgICAgICB0eXBlOiBpbnRlZ2VyXG4gKiAgICAgICAgICAgZGVmYXVsdDogMjBcbiAqICAgICAgICAgZGVzY3JpcHRpb246IE51bWJlciBvZiBldmVudHMgcGVyIHBhZ2VcbiAqICAgICAgIC0gaW46IHF1ZXJ5XG4gKiAgICAgICAgIG5hbWU6IHNlYXJjaFxuICogICAgICAgICBzY2hlbWE6XG4gKiAgICAgICAgICAgdHlwZTogc3RyaW5nXG4gKiAgICAgICAgIGRlc2NyaXB0aW9uOiBTZWFyY2ggdGVybSBmb3IgZXZlbnQgdGl0bGVcbiAqICAgICAgIC0gaW46IHF1ZXJ5XG4gKiAgICAgICAgIG5hbWU6IGNhdGVnb3J5XG4gKiAgICAgICAgIHNjaGVtYTpcbiAqICAgICAgICAgICB0eXBlOiBzdHJpbmdcbiAqICAgICAgICAgICBlbnVtOiBbTUVFVElORywgQ09NUEVUSVRJT04sIFdPUktTSE9QLCBTT0NJQUwsIE9USEVSXVxuICogICAgICAgICBkZXNjcmlwdGlvbjogRmlsdGVyIGJ5IGV2ZW50IGNhdGVnb3J5XG4gKiAgICAgICAtIGluOiBxdWVyeVxuICogICAgICAgICBuYW1lOiBsaW5rZWRUZWFtSWRcbiAqICAgICAgICAgc2NoZW1hOlxuICogICAgICAgICAgIHR5cGU6IHN0cmluZ1xuICogICAgICAgICBkZXNjcmlwdGlvbjogRmlsdGVyIGJ5IGxpbmtlZCB0ZWFtXG4gKiAgICAgICAtIGluOiBxdWVyeVxuICogICAgICAgICBuYW1lOiBzdGFydERhdGVcbiAqICAgICAgICAgc2NoZW1hOlxuICogICAgICAgICAgIHR5cGU6IHN0cmluZ1xuICogICAgICAgICAgIGZvcm1hdDogZGF0ZVxuICogICAgICAgICBkZXNjcmlwdGlvbjogRmlsdGVyIGV2ZW50cyBzdGFydGluZyBmcm9tIHRoaXMgZGF0ZVxuICogICAgICAgLSBpbjogcXVlcnlcbiAqICAgICAgICAgbmFtZTogZW5kRGF0ZVxuICogICAgICAgICBzY2hlbWE6XG4gKiAgICAgICAgICAgdHlwZTogc3RyaW5nXG4gKiAgICAgICAgICAgZm9ybWF0OiBkYXRlXG4gKiAgICAgICAgIGRlc2NyaXB0aW9uOiBGaWx0ZXIgZXZlbnRzIHN0YXJ0aW5nIGJlZm9yZSB0aGlzIGRhdGVcbiAqICAgICByZXNwb25zZXM6XG4gKiAgICAgICAyMDA6XG4gKiAgICAgICAgIGRlc2NyaXB0aW9uOiBMaXN0IG9mIGV2ZW50c1xuICogICAgICAgICBjb250ZW50OlxuICogICAgICAgICAgIGFwcGxpY2F0aW9uL2pzb246XG4gKiAgICAgICAgICAgICBzY2hlbWE6XG4gKiAgICAgICAgICAgICAgIHR5cGU6IG9iamVjdFxuICogICAgICAgICAgICAgICBwcm9wZXJ0aWVzOlxuICogICAgICAgICAgICAgICAgIGV2ZW50czpcbiAqICAgICAgICAgICAgICAgICAgIHR5cGU6IGFycmF5XG4gKiAgICAgICAgICAgICAgICAgICBpdGVtczpcbiAqICAgICAgICAgICAgICAgICAgICAgJHJlZjogJyMvY29tcG9uZW50cy9zY2hlbWFzL0V2ZW50J1xuICogICAgICAgICAgICAgICAgIHBhZ2luYXRpb246XG4gKiAgICAgICAgICAgICAgICAgICB0eXBlOiBvYmplY3RcbiAqICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6XG4gKiAgICAgICAgICAgICAgICAgICAgIHBhZ2U6XG4gKiAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogaW50ZWdlclxuICogICAgICAgICAgICAgICAgICAgICBsaW1pdDpcbiAqICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBpbnRlZ2VyXG4gKiAgICAgICAgICAgICAgICAgICAgIHRvdGFsOlxuICogICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGludGVnZXJcbiAqICAgICAgICAgICAgICAgICAgICAgdG90YWxQYWdlczpcbiAqICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBpbnRlZ2VyXG4gKiAgICAgICA0MDE6XG4gKiAgICAgICAgIGRlc2NyaXB0aW9uOiBVbmF1dGhvcml6ZWRcbiAqICAgICAgIDQwMzpcbiAqICAgICAgICAgZGVzY3JpcHRpb246IEZvcmJpZGRlbiAtIGluc3VmZmljaWVudCBwZXJtaXNzaW9uc1xuICogICAgICAgNTAwOlxuICogICAgICAgICBkZXNjcmlwdGlvbjogSW50ZXJuYWwgc2VydmVyIGVycm9yXG4gKiAgIHBvc3Q6XG4gKiAgICAgc3VtbWFyeTogQ3JlYXRlIGEgbmV3IGV2ZW50XG4gKiAgICAgdGFnczogW0V2ZW50c11cbiAqICAgICBzZWN1cml0eTpcbiAqICAgICAgIC0gc2Vzc2lvbkF1dGg6IFtdXG4gKiAgICAgcmVxdWVzdEJvZHk6XG4gKiAgICAgICByZXF1aXJlZDogdHJ1ZVxuICogICAgICAgY29udGVudDpcbiAqICAgICAgICAgYXBwbGljYXRpb24vanNvbjpcbiAqICAgICAgICAgICBzY2hlbWE6XG4gKiAgICAgICAgICAgICB0eXBlOiBvYmplY3RcbiAqICAgICAgICAgICAgIHJlcXVpcmVkOlxuICogICAgICAgICAgICAgICAtIHRpdGxlXG4gKiAgICAgICAgICAgICAgIC0gc3RhcnRUaW1lXG4gKiAgICAgICAgICAgICAgIC0gZW5kVGltZVxuICogICAgICAgICAgICAgICAtIGNhdGVnb3J5XG4gKiAgICAgICAgICAgICAgIC0gYXR0ZW5kYW5jZVR5cGVcbiAqICAgICAgICAgICAgIHByb3BlcnRpZXM6XG4gKiAgICAgICAgICAgICAgIHRpdGxlOlxuICogICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xuICogICAgICAgICAgICAgICAgIG1pbkxlbmd0aDogMVxuICogICAgICAgICAgICAgICAgIG1heExlbmd0aDogMjAwXG4gKiAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICogICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xuICogICAgICAgICAgICAgICBzdGFydFRpbWU6XG4gKiAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXG4gKiAgICAgICAgICAgICAgICAgZm9ybWF0OiBkYXRlLXRpbWVcbiAqICAgICAgICAgICAgICAgZW5kVGltZTpcbiAqICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcbiAqICAgICAgICAgICAgICAgICBmb3JtYXQ6IGRhdGUtdGltZVxuICogICAgICAgICAgICAgICBjYXRlZ29yeTpcbiAqICAgICAgICAgICAgICAgICB0eXBlOiBzdHJpbmdcbiAqICAgICAgICAgICAgICAgICBlbnVtOiBbTUVFVElORywgQ09NUEVUSVRJT04sIFdPUktTSE9QLCBTT0NJQUwsIE9USEVSXVxuICogICAgICAgICAgICAgICBsaW5rZWRUZWFtSWQ6XG4gKiAgICAgICAgICAgICAgICAgdHlwZTogc3RyaW5nXG4gKiAgICAgICAgICAgICAgIGF0dGVuZGFuY2VUeXBlOlxuICogICAgICAgICAgICAgICAgIHR5cGU6IHN0cmluZ1xuICogICAgICAgICAgICAgICAgIGVudW06IFtTVFJJQ1QsIFNPRlRdXG4gKiAgICAgcmVzcG9uc2VzOlxuICogICAgICAgMjAxOlxuICogICAgICAgICBkZXNjcmlwdGlvbjogRXZlbnQgY3JlYXRlZCBzdWNjZXNzZnVsbHlcbiAqICAgICAgICAgY29udGVudDpcbiAqICAgICAgICAgICBhcHBsaWNhdGlvbi9qc29uOlxuICogICAgICAgICAgICAgc2NoZW1hOlxuICogICAgICAgICAgICAgICAkcmVmOiAnIy9jb21wb25lbnRzL3NjaGVtYXMvRXZlbnQnXG4gKiAgICAgICA0MDA6XG4gKiAgICAgICAgIGRlc2NyaXB0aW9uOiBCYWQgcmVxdWVzdCAtIHZhbGlkYXRpb24gZXJyb3JcbiAqICAgICAgIDQwMTpcbiAqICAgICAgICAgZGVzY3JpcHRpb246IFVuYXV0aG9yaXplZFxuICogICAgICAgNDAzOlxuICogICAgICAgICBkZXNjcmlwdGlvbjogRm9yYmlkZGVuIC0gaW5zdWZmaWNpZW50IHBlcm1pc3Npb25zXG4gKiAgICAgICA1MDA6XG4gKiAgICAgICAgIGRlc2NyaXB0aW9uOiBJbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcbiAqL1xuYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xuICBjb25zdCBldmVudE1hbmFnZXIgPSBuZXcgRXZlbnRNYW5hZ2VyKHByaXNtYSk7XG4gIGNvbnN0IHRhc2tNYW5hZ2VyID0gbmV3IFRhc2tNYW5hZ2VyKCk7XG5cbiAgdHJ5IHtcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ0dFVCcpIHtcbiAgICAgIC8vIExpc3QgZXZlbnRzXG4gICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IGxpc3RFdmVudHNTY2hlbWEucGFyc2UocmVxLnF1ZXJ5KTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXZlbnRNYW5hZ2VyLmdldEFsbEV2ZW50cyh7XG4gICAgICAgIGNhdGVnb3J5OiBxdWVyeVBhcmFtcy5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgIGxpbmtlZFRlYW1JZDogcXVlcnlQYXJhbXMubGlua2VkVGVhbUlkLFxuICAgICAgICBzdGFydERhdGU6IHF1ZXJ5UGFyYW1zLnN0YXJ0RGF0ZSxcbiAgICAgICAgZW5kRGF0ZTogcXVlcnlQYXJhbXMuZW5kRGF0ZSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTaW1wbGUgcGFnaW5hdGlvbiAoaW4gcHJvZHVjdGlvbiwgaW1wbGVtZW50IHByb3BlciBwYWdpbmF0aW9uKVxuICAgICAgY29uc3QgcGFnZSA9IHF1ZXJ5UGFyYW1zLnBhZ2U7XG4gICAgICBjb25zdCBsaW1pdCA9IHF1ZXJ5UGFyYW1zLmxpbWl0O1xuICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcbiAgICAgIGNvbnN0IGVuZEluZGV4ID0gc3RhcnRJbmRleCArIGxpbWl0O1xuICAgICAgXG4gICAgICBjb25zdCBwYWdpbmF0ZWRFdmVudHMgPSByZXN1bHQuc2xpY2Uoc3RhcnRJbmRleCwgZW5kSW5kZXgpO1xuICAgICAgY29uc3QgdG90YWwgPSByZXN1bHQubGVuZ3RoO1xuICAgICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbCAvIGxpbWl0KTtcblxuICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBwYWdpbmF0ZWRFdmVudHMsXG4gICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICBwYWdlLFxuICAgICAgICAgIGxpbWl0LFxuICAgICAgICAgIHRvdGFsLFxuICAgICAgICAgIHRvdGFsUGFnZXMsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHJlcS5tZXRob2QgPT09ICdQT1NUJykge1xuICAgICAgLy8gQ3JlYXRlIGV2ZW50XG4gICAgICBjb25zdCBib2R5ID0gY3JlYXRlRXZlbnRTY2hlbWEucGFyc2UocmVxLmJvZHkpO1xuICAgICAgXG4gICAgICBjb25zdCBldmVudCA9IGF3YWl0IGV2ZW50TWFuYWdlci5jcmVhdGVFdmVudChib2R5KTtcbiAgICAgIFxuICAgICAgLy8gRW5xdWV1ZSBzaW11bGF0ZWQgZXZlbnQgc2V0dXAgdGFza1xuICAgICAgY29uc3Qgc3VidGFza05hbWVzID0gW1xuICAgICAgICAnVmFsaWRhdGUgZXZlbnQgZGV0YWlscycsXG4gICAgICAgICdDcmVhdGUgaW50ZXJuYWwgcmVjb3JkcycsXG4gICAgICAgICdDcmVhdGUgTmV4dGNsb3VkIGNhbGVuZGFyIGVudHJ5IChzaW11bGF0ZWQpJyxcbiAgICAgICAgJ0dlbmVyYXRlIFJTVlAgbGluayAoc2ltdWxhdGVkKScsXG4gICAgICAgICdQcmVwYXJlIFdpcmV0YXAvT3BlblN0YWNrIHJlc291cmNlcyAoc2ltdWxhdGVkKSdcbiAgICAgIF07XG4gICAgICBhd2FpdCB0YXNrTWFuYWdlci5lbnF1ZXVlUHJvdmlzaW9uVGFzayh7XG4gICAgICAgIHByb3Zpc2lvblR5cGU6ICdFVkVOVCcsXG4gICAgICAgIG5hbWU6IGBQcm92aXNpb24gcmVzb3VyY2VzIGZvciBldmVudCAke2V2ZW50LnRpdGxlfWAsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnU2ltdWxhdGVkIGV2ZW50IHJlc291cmNlIHNldHVwJyxcbiAgICAgICAgZW50aXR5VHlwZTogJ0VWRU5UJyxcbiAgICAgICAgZW50aXR5SWQ6IGV2ZW50LmlkLFxuICAgICAgICBzdWJ0YXNrTmFtZXMsXG4gICAgICAgIHBheWxvYWQ6IHsgZXZlbnRJZDogZXZlbnQuaWQgfVxuICAgICAgfSk7XG5cbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogZXZlbnQgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICBsb2dnZXIud2FybignVmFsaWRhdGlvbiBlcnJvciBpbiBldmVudHMgQVBJJywgeyBlcnJvcnM6IGVycm9yLmVycm9ycyB9KTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnVmFsaWRhdGlvbiBlcnJvcicsIGRldGFpbHM6IGVycm9yLmVycm9ycyB9KTtcbiAgICB9XG4gICAgXG4gICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBldmVudHMgQVBJJywgeyBlcnJvciwgbWV0aG9kOiByZXEubWV0aG9kIH0pO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xuICB9XG59XG5cbi8vIEFwcGx5IG1pZGRsZXdhcmU6IENPUlMsIGF1dGhlbnRpY2F0aW9uIHRoZW4gcGVybWlzc2lvbnNcbmV4cG9ydCBkZWZhdWx0IHdpdGhDT1JTKFxuICB3aXRoQXV0aChcbiAgICB3aXRoUGVybWlzc2lvbnMoXG4gICAgICBoYW5kbGVyLFxuICAgICAgKHJlcTogTmV4dEFwaVJlcXVlc3QpID0+IHtcbiAgICAgICAgLy8gR0VUIHJlcXVlc3RzIG9ubHkgbmVlZCByZWFkIHBlcm1pc3Npb24sIFBPU1QgcmVxdWVzdHMgbmVlZCBjcmVhdGUgcGVybWlzc2lvblxuICAgICAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ0dFVCcpIHtcbiAgICAgICAgICByZXR1cm4gWydldmVudHM6cmVhZCddO1xuICAgICAgICB9IGVsc2UgaWYgKHJlcS5tZXRob2QgPT09ICdQT1NUJykge1xuICAgICAgICAgIHJldHVybiBbJ2V2ZW50czpjcmVhdGUnXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgKVxuICApXG4pO1xuIl0sIm5hbWVzIjpbInoiLCJwcmlzbWEiLCJFdmVudE1hbmFnZXIiLCJUYXNrTWFuYWdlciIsIndpdGhDT1JTIiwid2l0aEF1dGgiLCJ3aXRoUGVybWlzc2lvbnMiLCJsb2dnZXIiLCJjcmVhdGVFdmVudFNjaGVtYSIsIm9iamVjdCIsInRpdGxlIiwic3RyaW5nIiwibWluIiwibWF4IiwiZGVzY3JpcHRpb24iLCJvcHRpb25hbCIsInN0YXJ0VGltZSIsInRyYW5zZm9ybSIsInZhbCIsIkRhdGUiLCJlbmRUaW1lIiwiY2F0ZWdvcnkiLCJlbnVtIiwibGlua2VkVGVhbUlkIiwiYXR0ZW5kYW5jZVR5cGUiLCJsaXN0RXZlbnRzU2NoZW1hIiwicGFnZSIsInBhcnNlSW50IiwibGltaXQiLCJzZWFyY2giLCJzdGFydERhdGUiLCJ1bmRlZmluZWQiLCJlbmREYXRlIiwiaGFuZGxlciIsInJlcSIsInJlcyIsImV2ZW50TWFuYWdlciIsInRhc2tNYW5hZ2VyIiwibWV0aG9kIiwicXVlcnlQYXJhbXMiLCJwYXJzZSIsInF1ZXJ5IiwicmVzdWx0IiwiZ2V0QWxsRXZlbnRzIiwic3RhcnRJbmRleCIsImVuZEluZGV4IiwicGFnaW5hdGVkRXZlbnRzIiwic2xpY2UiLCJ0b3RhbCIsImxlbmd0aCIsInRvdGFsUGFnZXMiLCJNYXRoIiwiY2VpbCIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsInBhZ2luYXRpb24iLCJib2R5IiwiZXZlbnQiLCJjcmVhdGVFdmVudCIsInN1YnRhc2tOYW1lcyIsImVucXVldWVQcm92aXNpb25UYXNrIiwicHJvdmlzaW9uVHlwZSIsIm5hbWUiLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJpZCIsInBheWxvYWQiLCJldmVudElkIiwiZXJyb3IiLCJab2RFcnJvciIsIndhcm4iLCJlcnJvcnMiLCJkZXRhaWxzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/events/index.ts\n");

/***/ }),

/***/ "(api)/./src/tasks/queue.ts":
/*!****************************!*\
  !*** ./src/tasks/queue.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   QUEUE_NAMES: () => (/* binding */ QUEUE_NAMES),\n/* harmony export */   addJobToQueue: () => (/* binding */ addJobToQueue),\n/* harmony export */   authentikQueue: () => (/* binding */ authentikQueue),\n/* harmony export */   closeQueues: () => (/* binding */ closeQueues),\n/* harmony export */   discordQueue: () => (/* binding */ discordQueue),\n/* harmony export */   emailQueue: () => (/* binding */ emailQueue),\n/* harmony export */   getQueueHealth: () => (/* binding */ getQueueHealth),\n/* harmony export */   listmonkQueue: () => (/* binding */ listmonkQueue),\n/* harmony export */   provisionQueue: () => (/* binding */ provisionQueue),\n/* harmony export */   qrCodeQueue: () => (/* binding */ qrCodeQueue),\n/* harmony export */   syncGroupsQueue: () => (/* binding */ syncGroupsQueue),\n/* harmony export */   teamProvisioningQueue: () => (/* binding */ teamProvisioningQueue)\n/* harmony export */ });\n/* harmony import */ var bullmq__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bullmq */ \"bullmq\");\n/* harmony import */ var bullmq__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(bullmq__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _utils_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/utils/logger */ \"(api)/./src/utils/logger.ts\");\n\n\n\n// Redis connection with BullMQ-compatible options\nconst redis = new (ioredis__WEBPACK_IMPORTED_MODULE_1___default())(process.env.REDIS_URL || \"redis://localhost:6379\", {\n    maxRetriesPerRequest: null\n});\n// Queue names\nconst QUEUE_NAMES = {\n    EMAIL: \"email\",\n    QR_CODE: \"qr-code\",\n    SYNC_GROUPS: \"sync-groups\",\n    PROVISION: \"provision\",\n    TEAM_PROVISIONING: \"team-provisioning\",\n    DISCORD: \"discord\",\n    LISTMONK: \"listmonk\",\n    AUTHENTIK: \"authentik\"\n};\n// Create queues\nconst emailQueue = new bullmq__WEBPACK_IMPORTED_MODULE_0__.Queue(QUEUE_NAMES.EMAIL, {\n    connection: redis,\n    defaultJobOptions: {\n        attempts: 3,\n        backoff: {\n            type: \"exponential\",\n            delay: 2000\n        }\n    }\n});\nconst qrCodeQueue = new bullmq__WEBPACK_IMPORTED_MODULE_0__.Queue(QUEUE_NAMES.QR_CODE, {\n    connection: redis,\n    defaultJobOptions: {\n        attempts: 2,\n        backoff: {\n            type: \"exponential\",\n            delay: 1000\n        }\n    }\n});\nconst syncGroupsQueue = new bullmq__WEBPACK_IMPORTED_MODULE_0__.Queue(QUEUE_NAMES.SYNC_GROUPS, {\n    connection: redis,\n    defaultJobOptions: {\n        attempts: 5,\n        backoff: {\n            type: \"exponential\",\n            delay: 5000\n        }\n    }\n});\nconst provisionQueue = new bullmq__WEBPACK_IMPORTED_MODULE_0__.Queue(QUEUE_NAMES.PROVISION, {\n    connection: redis,\n    defaultJobOptions: {\n        attempts: 1\n    }\n});\nconst teamProvisioningQueue = new bullmq__WEBPACK_IMPORTED_MODULE_0__.Queue(QUEUE_NAMES.TEAM_PROVISIONING, {\n    connection: redis,\n    defaultJobOptions: {\n        attempts: 3,\n        backoff: {\n            type: \"exponential\",\n            delay: 5000\n        }\n    }\n});\nconst discordQueue = new bullmq__WEBPACK_IMPORTED_MODULE_0__.Queue(QUEUE_NAMES.DISCORD, {\n    connection: redis,\n    defaultJobOptions: {\n        attempts: 3,\n        backoff: {\n            type: \"exponential\",\n            delay: 2000\n        }\n    }\n});\nconst listmonkQueue = new bullmq__WEBPACK_IMPORTED_MODULE_0__.Queue(QUEUE_NAMES.LISTMONK, {\n    connection: redis,\n    defaultJobOptions: {\n        attempts: 3,\n        backoff: {\n            type: \"exponential\",\n            delay: 3000\n        }\n    }\n});\nconst authentikQueue = new bullmq__WEBPACK_IMPORTED_MODULE_0__.Queue(QUEUE_NAMES.AUTHENTIK, {\n    connection: redis,\n    defaultJobOptions: {\n        attempts: 3,\n        backoff: {\n            type: \"exponential\",\n            delay: 2000\n        }\n    }\n});\n// Note: Not using QueueScheduler due to BullMQ version constraints\n// Note: BullMQ event handlers may need to be configured differently\n// For now, we'll log queue status through other means\n_utils_logger__WEBPACK_IMPORTED_MODULE_2__.logger.info(\"All queues created and configured\");\n// Helper function to add jobs to queues\nasync function addJobToQueue(queueName, data, options) {\n    const queue = getQueueByName(queueName);\n    if (!queue) {\n        throw new Error(`Unknown queue: ${queueName}`);\n    }\n    const job = await queue.add(queueName, data, {\n        delay: options?.delay,\n        priority: options?.priority,\n        attempts: options?.attempts\n    });\n    _utils_logger__WEBPACK_IMPORTED_MODULE_2__.logger.info(`Added job ${job.id} to ${queueName} queue`);\n    return job;\n}\nfunction getQueueByName(queueName) {\n    switch(queueName){\n        case \"EMAIL\":\n            return emailQueue;\n        case \"QR_CODE\":\n            return qrCodeQueue;\n        case \"SYNC_GROUPS\":\n            return syncGroupsQueue;\n        case \"PROVISION\":\n            return provisionQueue;\n        case \"TEAM_PROVISIONING\":\n            return teamProvisioningQueue;\n        case \"DISCORD\":\n            return discordQueue;\n        case \"LISTMONK\":\n            return listmonkQueue;\n        default:\n            return null;\n    }\n}\n// Graceful shutdown\nasync function closeQueues() {\n    await emailQueue.close();\n    await qrCodeQueue.close();\n    await syncGroupsQueue.close();\n    await provisionQueue.close();\n    await teamProvisioningQueue.close();\n    await discordQueue.close();\n    await listmonkQueue.close();\n    await redis.quit();\n    _utils_logger__WEBPACK_IMPORTED_MODULE_2__.logger.info(\"All queues closed\");\n}\n// Health check\nasync function getQueueHealth() {\n    try {\n        await redis.ping();\n        return {\n            redis: \"healthy\",\n            queues: {\n                email: await emailQueue.getJobCounts(),\n                qrCode: await qrCodeQueue.getJobCounts(),\n                syncGroups: await syncGroupsQueue.getJobCounts(),\n                provision: await provisionQueue.getJobCounts(),\n                teamProvisioning: await teamProvisioningQueue.getJobCounts(),\n                discord: await discordQueue.getJobCounts(),\n                listmonk: await listmonkQueue.getJobCounts()\n            }\n        };\n    } catch (error) {\n        _utils_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Queue health check failed:\", error);\n        return {\n            redis: \"unhealthy\",\n            error: error instanceof Error ? error.message : \"Unknown error\"\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WUFBWTtZQUM1QztRQUNGO0lBQ0YsRUFBRSxPQUFPTyxPQUFPO1FBQ2R2RCxpREFBTUEsQ0FBQ3VELEtBQUssQ0FBQyw4QkFBOEJBO1FBQzNDLE9BQU87WUFDTHRELE9BQU87WUFDUHNELE9BQU9BLGlCQUFpQm5CLFFBQVFtQixNQUFNQyxPQUFPLEdBQUc7UUFDbEQ7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXJtMzYwLWJhY2tlbmQvLi9zcmMvdGFza3MvcXVldWUudHM/NjI5MSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBRdWV1ZSB9IGZyb20gJ2J1bGxtcSc7XG5pbXBvcnQgUmVkaXMgZnJvbSAnaW9yZWRpcyc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL3V0aWxzL2xvZ2dlcic7XG5cbi8vIFJlZGlzIGNvbm5lY3Rpb24gd2l0aCBCdWxsTVEtY29tcGF0aWJsZSBvcHRpb25zXG5jb25zdCByZWRpcyA9IG5ldyBSZWRpcyhwcm9jZXNzLmVudi5SRURJU19VUkwgfHwgJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzknLCB7XG4gIG1heFJldHJpZXNQZXJSZXF1ZXN0OiBudWxsXG59KTtcblxuLy8gUXVldWUgbmFtZXNcbmV4cG9ydCBjb25zdCBRVUVVRV9OQU1FUyA9IHtcbiAgRU1BSUw6ICdlbWFpbCcsXG4gIFFSX0NPREU6ICdxci1jb2RlJyxcbiAgU1lOQ19HUk9VUFM6ICdzeW5jLWdyb3VwcycsXG4gIFBST1ZJU0lPTjogJ3Byb3Zpc2lvbicsXG4gIFRFQU1fUFJPVklTSU9OSU5HOiAndGVhbS1wcm92aXNpb25pbmcnLFxuICBESVNDT1JEOiAnZGlzY29yZCcsXG4gIExJU1RNT05LOiAnbGlzdG1vbmsnLFxuICBBVVRIRU5USUs6ICdhdXRoZW50aWsnXG59IGFzIGNvbnN0O1xuXG4vLyBDcmVhdGUgcXVldWVzXG5leHBvcnQgY29uc3QgZW1haWxRdWV1ZSA9IG5ldyBRdWV1ZShRVUVVRV9OQU1FUy5FTUFJTCwge1xuICBjb25uZWN0aW9uOiByZWRpcyxcbiAgZGVmYXVsdEpvYk9wdGlvbnM6IHtcbiAgICBhdHRlbXB0czogMyxcbiAgICBiYWNrb2ZmOiB7XG4gICAgICB0eXBlOiAnZXhwb25lbnRpYWwnLFxuICAgICAgZGVsYXk6IDIwMDBcbiAgICB9XG4gIH1cbn0pO1xuXG5leHBvcnQgY29uc3QgcXJDb2RlUXVldWUgPSBuZXcgUXVldWUoUVVFVUVfTkFNRVMuUVJfQ09ERSwge1xuICBjb25uZWN0aW9uOiByZWRpcyxcbiAgZGVmYXVsdEpvYk9wdGlvbnM6IHtcbiAgICBhdHRlbXB0czogMixcbiAgICBiYWNrb2ZmOiB7XG4gICAgICB0eXBlOiAnZXhwb25lbnRpYWwnLFxuICAgICAgZGVsYXk6IDEwMDBcbiAgICB9XG4gIH1cbn0pO1xuXG5leHBvcnQgY29uc3Qgc3luY0dyb3Vwc1F1ZXVlID0gbmV3IFF1ZXVlKFFVRVVFX05BTUVTLlNZTkNfR1JPVVBTLCB7XG4gIGNvbm5lY3Rpb246IHJlZGlzLFxuICBkZWZhdWx0Sm9iT3B0aW9uczoge1xuICAgIGF0dGVtcHRzOiA1LFxuICAgIGJhY2tvZmY6IHtcbiAgICAgIHR5cGU6ICdleHBvbmVudGlhbCcsXG4gICAgICBkZWxheTogNTAwMFxuICAgIH1cbiAgfVxufSk7XG5cbmV4cG9ydCBjb25zdCBwcm92aXNpb25RdWV1ZSA9IG5ldyBRdWV1ZShRVUVVRV9OQU1FUy5QUk9WSVNJT04sIHtcbiAgY29ubmVjdGlvbjogcmVkaXMsXG4gIGRlZmF1bHRKb2JPcHRpb25zOiB7XG4gICAgYXR0ZW1wdHM6IDFcbiAgfVxufSk7XG5cbmV4cG9ydCBjb25zdCB0ZWFtUHJvdmlzaW9uaW5nUXVldWUgPSBuZXcgUXVldWUoUVVFVUVfTkFNRVMuVEVBTV9QUk9WSVNJT05JTkcsIHtcbiAgY29ubmVjdGlvbjogcmVkaXMsXG4gIGRlZmF1bHRKb2JPcHRpb25zOiB7XG4gICAgYXR0ZW1wdHM6IDMsXG4gICAgYmFja29mZjoge1xuICAgICAgdHlwZTogJ2V4cG9uZW50aWFsJyxcbiAgICAgIGRlbGF5OiA1MDAwXG4gICAgfVxuICB9XG59KTtcblxuZXhwb3J0IGNvbnN0IGRpc2NvcmRRdWV1ZSA9IG5ldyBRdWV1ZShRVUVVRV9OQU1FUy5ESVNDT1JELCB7XG4gIGNvbm5lY3Rpb246IHJlZGlzLFxuICBkZWZhdWx0Sm9iT3B0aW9uczoge1xuICAgIGF0dGVtcHRzOiAzLFxuICAgIGJhY2tvZmY6IHtcbiAgICAgIHR5cGU6ICdleHBvbmVudGlhbCcsXG4gICAgICBkZWxheTogMjAwMFxuICAgIH1cbiAgfVxufSk7XG5cbmV4cG9ydCBjb25zdCBsaXN0bW9ua1F1ZXVlID0gbmV3IFF1ZXVlKFFVRVVFX05BTUVTLkxJU1RNT05LLCB7XG4gIGNvbm5lY3Rpb246IHJlZGlzLFxuICBkZWZhdWx0Sm9iT3B0aW9uczoge1xuICAgIGF0dGVtcHRzOiAzLFxuICAgIGJhY2tvZmY6IHtcbiAgICAgIHR5cGU6ICdleHBvbmVudGlhbCcsXG4gICAgICBkZWxheTogMzAwMFxuICAgIH1cbiAgfVxufSk7XG5cbmV4cG9ydCBjb25zdCBhdXRoZW50aWtRdWV1ZSA9IG5ldyBRdWV1ZShRVUVVRV9OQU1FUy5BVVRIRU5USUssIHtcbiAgY29ubmVjdGlvbjogcmVkaXMsXG4gIGRlZmF1bHRKb2JPcHRpb25zOiB7XG4gICAgYXR0ZW1wdHM6IDMsXG4gICAgYmFja29mZjoge1xuICAgICAgdHlwZTogJ2V4cG9uZW50aWFsJyxcbiAgICAgIGRlbGF5OiAyMDAwXG4gICAgfVxuICB9XG59KTtcblxuLy8gTm90ZTogTm90IHVzaW5nIFF1ZXVlU2NoZWR1bGVyIGR1ZSB0byBCdWxsTVEgdmVyc2lvbiBjb25zdHJhaW50c1xuLy8gTm90ZTogQnVsbE1RIGV2ZW50IGhhbmRsZXJzIG1heSBuZWVkIHRvIGJlIGNvbmZpZ3VyZWQgZGlmZmVyZW50bHlcbi8vIEZvciBub3csIHdlJ2xsIGxvZyBxdWV1ZSBzdGF0dXMgdGhyb3VnaCBvdGhlciBtZWFuc1xubG9nZ2VyLmluZm8oJ0FsbCBxdWV1ZXMgY3JlYXRlZCBhbmQgY29uZmlndXJlZCcpO1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gYWRkIGpvYnMgdG8gcXVldWVzXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYWRkSm9iVG9RdWV1ZShcbiAgcXVldWVOYW1lOiBrZXlvZiB0eXBlb2YgUVVFVUVfTkFNRVMsXG4gIGRhdGE6IGFueSxcbiAgb3B0aW9ucz86IHtcbiAgICBkZWxheT86IG51bWJlcjtcbiAgICBwcmlvcml0eT86IG51bWJlcjtcbiAgICBhdHRlbXB0cz86IG51bWJlcjtcbiAgfVxuKSB7XG4gIGNvbnN0IHF1ZXVlID0gZ2V0UXVldWVCeU5hbWUocXVldWVOYW1lKTtcbiAgaWYgKCFxdWV1ZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBxdWV1ZTogJHtxdWV1ZU5hbWV9YCk7XG4gIH1cblxuICBjb25zdCBqb2IgPSBhd2FpdCBxdWV1ZS5hZGQoXG4gICAgcXVldWVOYW1lLFxuICAgIGRhdGEsXG4gICAge1xuICAgICAgZGVsYXk6IG9wdGlvbnM/LmRlbGF5LFxuICAgICAgcHJpb3JpdHk6IG9wdGlvbnM/LnByaW9yaXR5LFxuICAgICAgYXR0ZW1wdHM6IG9wdGlvbnM/LmF0dGVtcHRzXG4gICAgfVxuICApO1xuXG4gIGxvZ2dlci5pbmZvKGBBZGRlZCBqb2IgJHtqb2IuaWR9IHRvICR7cXVldWVOYW1lfSBxdWV1ZWApO1xuICByZXR1cm4gam9iO1xufVxuXG5mdW5jdGlvbiBnZXRRdWV1ZUJ5TmFtZShxdWV1ZU5hbWU6IGtleW9mIHR5cGVvZiBRVUVVRV9OQU1FUykge1xuICBzd2l0Y2ggKHF1ZXVlTmFtZSkge1xuICAgIGNhc2UgJ0VNQUlMJzpcbiAgICAgIHJldHVybiBlbWFpbFF1ZXVlO1xuICAgIGNhc2UgJ1FSX0NPREUnOlxuICAgICAgcmV0dXJuIHFyQ29kZVF1ZXVlO1xuICAgIGNhc2UgJ1NZTkNfR1JPVVBTJzpcbiAgICAgIHJldHVybiBzeW5jR3JvdXBzUXVldWU7XG4gICAgY2FzZSAnUFJPVklTSU9OJzpcbiAgICAgIHJldHVybiBwcm92aXNpb25RdWV1ZTtcbiAgICBjYXNlICdURUFNX1BST1ZJU0lPTklORyc6XG4gICAgICByZXR1cm4gdGVhbVByb3Zpc2lvbmluZ1F1ZXVlO1xuICAgIGNhc2UgJ0RJU0NPUkQnOlxuICAgICAgcmV0dXJuIGRpc2NvcmRRdWV1ZTtcbiAgICBjYXNlICdMSVNUTU9OSyc6XG4gICAgICByZXR1cm4gbGlzdG1vbmtRdWV1ZTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLy8gR3JhY2VmdWwgc2h1dGRvd25cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbG9zZVF1ZXVlcygpIHtcbiAgYXdhaXQgZW1haWxRdWV1ZS5jbG9zZSgpO1xuICBhd2FpdCBxckNvZGVRdWV1ZS5jbG9zZSgpO1xuICBhd2FpdCBzeW5jR3JvdXBzUXVldWUuY2xvc2UoKTtcbiAgYXdhaXQgcHJvdmlzaW9uUXVldWUuY2xvc2UoKTtcbiAgYXdhaXQgdGVhbVByb3Zpc2lvbmluZ1F1ZXVlLmNsb3NlKCk7XG4gIGF3YWl0IGRpc2NvcmRRdWV1ZS5jbG9zZSgpO1xuICBhd2FpdCBsaXN0bW9ua1F1ZXVlLmNsb3NlKCk7XG4gIGF3YWl0IHJlZGlzLnF1aXQoKTtcbiAgbG9nZ2VyLmluZm8oJ0FsbCBxdWV1ZXMgY2xvc2VkJyk7XG59XG5cbi8vIEhlYWx0aCBjaGVja1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFF1ZXVlSGVhbHRoKCkge1xuICB0cnkge1xuICAgIGF3YWl0IHJlZGlzLnBpbmcoKTtcbiAgICByZXR1cm4ge1xuICAgICAgcmVkaXM6ICdoZWFsdGh5JyxcbiAgICAgIHF1ZXVlczoge1xuICAgICAgICBlbWFpbDogYXdhaXQgZW1haWxRdWV1ZS5nZXRKb2JDb3VudHMoKSxcbiAgICAgICAgcXJDb2RlOiBhd2FpdCBxckNvZGVRdWV1ZS5nZXRKb2JDb3VudHMoKSxcbiAgICAgICAgc3luY0dyb3VwczogYXdhaXQgc3luY0dyb3Vwc1F1ZXVlLmdldEpvYkNvdW50cygpLFxuICAgICAgICBwcm92aXNpb246IGF3YWl0IHByb3Zpc2lvblF1ZXVlLmdldEpvYkNvdW50cygpLFxuICAgICAgICB0ZWFtUHJvdmlzaW9uaW5nOiBhd2FpdCB0ZWFtUHJvdmlzaW9uaW5nUXVldWUuZ2V0Sm9iQ291bnRzKCksXG4gICAgICAgIGRpc2NvcmQ6IGF3YWl0IGRpc2NvcmRRdWV1ZS5nZXRKb2JDb3VudHMoKSxcbiAgICAgICAgbGlzdG1vbms6IGF3YWl0IGxpc3Rtb25rUXVldWUuZ2V0Sm9iQ291bnRzKClcbiAgICAgIH1cbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignUXVldWUgaGVhbHRoIGNoZWNrIGZhaWxlZDonLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlZGlzOiAndW5oZWFsdGh5JyxcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ1xuICAgIH07XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJRdWV1ZSIsIlJlZGlzIiwibG9nZ2VyIiwicmVkaXMiLCJwcm9jZXNzIiwiZW52IiwiUkVESVNfVVJMIiwibWF4UmV0cmllc1BlclJlcXVlc3QiLCJRVUVVRV9OQU1FUyIsIkVNQUlMIiwiUVJfQ09ERSIsIlNZTkNfR1JPVVBTIiwiUFJPVklTSU9OIiwiVEVBTV9QUk9WSVNJT05JTkciLCJESVNDT1JEIiwiTElTVE1PTksiLCJBVVRIRU5USUsiLCJlbWFpbFF1ZXVlIiwiY29ubmVjdGlvbiIsImRlZmF1bHRKb2JPcHRpb25zIiwiYXR0ZW1wdHMiLCJiYWNrb2ZmIiwidHlwZSIsImRlbGF5IiwicXJDb2RlUXVldWUiLCJzeW5jR3JvdXBzUXVldWUiLCJwcm92aXNpb25RdWV1ZSIsInRlYW1Qcm92aXNpb25pbmdRdWV1ZSIsImRpc2NvcmRRdWV1ZSIsImxpc3Rtb25rUXVldWUiLCJhdXRoZW50aWtRdWV1ZSIsImluZm8iLCJhZGRKb2JUb1F1ZXVlIiwicXVldWVOYW1lIiwiZGF0YSIsIm9wdGlvbnMiLCJxdWV1ZSIsImdldFF1ZXVlQnlOYW1lIiwiRXJyb3IiLCJqb2IiLCJhZGQiLCJwcmlvcml0eSIsImlkIiwiY2xvc2VRdWV1ZXMiLCJjbG9zZSIsInF1aXQiLCJnZXRRdWV1ZUhlYWx0aCIsInBpbmciLCJxdWV1ZXMiLCJlbWFpbCIsImdldEpvYkNvdW50cyIsInFyQ29kZSIsInN5bmNHcm91cHMiLCJwcm92aXNpb24iLCJ0ZWFtUHJvdmlzaW9uaW5nIiwiZGlzY29yZCIsImxpc3Rtb25rIiwiZXJyb3IiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/tasks/queue.ts\n");

/***/ }),

/***/ "(api)/./src/utils/logger.ts":
/*!*****************************!*\
  !*** ./src/utils/logger.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LogLevel: () => (/* binding */ LogLevel),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   logger: () => (/* binding */ logger)\n/* harmony export */ });\nvar LogLevel;\n(function(LogLevel) {\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\n    LogLevel[LogLevel[\"INFO\"] = 1] = \"INFO\";\n    LogLevel[LogLevel[\"WARN\"] = 2] = \"WARN\";\n    LogLevel[LogLevel[\"ERROR\"] = 3] = \"ERROR\";\n})(LogLevel || (LogLevel = {}));\nclass Logger {\n    constructor(level = 1){\n        this.level = level;\n    }\n    formatMessage(level, message, meta) {\n        const timestamp = new Date().toISOString();\n        const metaStr = meta ? ` ${JSON.stringify(meta)}` : \"\";\n        return `[${timestamp}] ${level}: ${message}${metaStr}`;\n    }\n    log(level, levelName, message, meta) {\n        if (level >= this.level) {\n            const formattedMessage = this.formatMessage(levelName, message, meta);\n            switch(level){\n                case 3:\n                    console.error(formattedMessage);\n                    break;\n                case 2:\n                    console.warn(formattedMessage);\n                    break;\n                case 1:\n                    console.info(formattedMessage);\n                    break;\n                case 0:\n                    console.debug(formattedMessage);\n                    break;\n            }\n        }\n    }\n    debug(message, meta) {\n        this.log(0, \"DEBUG\", message, meta);\n    }\n    info(message, meta) {\n        this.log(1, \"INFO\", message, meta);\n    }\n    warn(message, meta) {\n        this.log(2, \"WARN\", message, meta);\n    }\n    error(message, meta) {\n        this.log(3, \"ERROR\", message, meta);\n    }\n    setLevel(level) {\n        this.level = level;\n    }\n}\nconst logger = new Logger( true ? 0 : 0);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (logger);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvdXRpbHMvbG9nZ2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7VUFBWUE7Ozs7O0dBQUFBLGFBQUFBO0FBT1osTUFBTUM7SUFHSkMsWUFBWUMsU0FBK0IsQ0FBRTtRQUMzQyxJQUFJLENBQUNBLEtBQUssR0FBR0E7SUFDZjtJQUVRQyxjQUFjRCxLQUFhLEVBQUVFLE9BQWUsRUFBRUMsSUFBVSxFQUFVO1FBQ3hFLE1BQU1DLFlBQVksSUFBSUMsT0FBT0MsV0FBVztRQUN4QyxNQUFNQyxVQUFVSixPQUFPLENBQUMsQ0FBQyxFQUFFSyxLQUFLQyxTQUFTLENBQUNOLE1BQU0sQ0FBQyxHQUFHO1FBQ3BELE9BQU8sQ0FBQyxDQUFDLEVBQUVDLFVBQVUsRUFBRSxFQUFFSixNQUFNLEVBQUUsRUFBRUUsUUFBUSxFQUFFSyxRQUFRLENBQUM7SUFDeEQ7SUFFUUcsSUFBSVYsS0FBZSxFQUFFVyxTQUFpQixFQUFFVCxPQUFlLEVBQUVDLElBQVUsRUFBRTtRQUMzRSxJQUFJSCxTQUFTLElBQUksQ0FBQ0EsS0FBSyxFQUFFO1lBQ3ZCLE1BQU1ZLG1CQUFtQixJQUFJLENBQUNYLGFBQWEsQ0FBQ1UsV0FBV1QsU0FBU0M7WUFFaEUsT0FBUUg7Z0JBQ047b0JBQ0VhLFFBQVFDLEtBQUssQ0FBQ0Y7b0JBQ2Q7Z0JBQ0Y7b0JBQ0VDLFFBQVFFLElBQUksQ0FBQ0g7b0JBQ2I7Z0JBQ0Y7b0JBQ0VDLFFBQVFHLElBQUksQ0FBQ0o7b0JBQ2I7Z0JBQ0Y7b0JBQ0VDLFFBQVFJLEtBQUssQ0FBQ0w7b0JBQ2Q7WUFDSjtRQUNGO0lBQ0Y7SUFFQUssTUFBTWYsT0FBZSxFQUFFQyxJQUFVLEVBQUU7UUFDakMsSUFBSSxDQUFDTyxHQUFHLElBQWlCLFNBQVNSLFNBQVNDO0lBQzdDO0lBRUFhLEtBQUtkLE9BQWUsRUFBRUMsSUFBVSxFQUFFO1FBQ2hDLElBQUksQ0FBQ08sR0FBRyxJQUFnQixRQUFRUixTQUFTQztJQUMzQztJQUVBWSxLQUFLYixPQUFlLEVBQUVDLElBQVUsRUFBRTtRQUNoQyxJQUFJLENBQUNPLEdBQUcsSUFBZ0IsUUFBUVIsU0FBU0M7SUFDM0M7SUFFQVcsTUFBTVosT0FBZSxFQUFFQyxJQUFVLEVBQUU7UUFDakMsSUFBSSxDQUFDTyxHQUFHLElBQWlCLFNBQVNSLFNBQVNDO0lBQzdDO0lBRUFlLFNBQVNsQixLQUFlLEVBQUU7UUFDeEIsSUFBSSxDQUFDQSxLQUFLLEdBQUdBO0lBQ2Y7QUFDRjtBQUVPLE1BQU1tQixTQUFTLElBQUlyQixPQUN4QnNCLEtBQXlCLFVBQ3pCO0FBRUYsaUVBQWVELE1BQU1BLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tcm0zNjAtYmFja2VuZC8uL3NyYy91dGlscy9sb2dnZXIudHM/N2NmZiJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZW51bSBMb2dMZXZlbCB7XHJcbiAgREVCVUcgPSAwLFxyXG4gIElORk8gPSAxLFxyXG4gIFdBUk4gPSAyLFxyXG4gIEVSUk9SID0gM1xyXG59XHJcblxyXG5jbGFzcyBMb2dnZXIge1xyXG4gIHByaXZhdGUgbGV2ZWw6IExvZ0xldmVsO1xyXG5cclxuICBjb25zdHJ1Y3RvcihsZXZlbDogTG9nTGV2ZWwgPSBMb2dMZXZlbC5JTkZPKSB7XHJcbiAgICB0aGlzLmxldmVsID0gbGV2ZWw7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGZvcm1hdE1lc3NhZ2UobGV2ZWw6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcclxuICAgIGNvbnN0IG1ldGFTdHIgPSBtZXRhID8gYCAke0pTT04uc3RyaW5naWZ5KG1ldGEpfWAgOiAnJztcclxuICAgIHJldHVybiBgWyR7dGltZXN0YW1wfV0gJHtsZXZlbH06ICR7bWVzc2FnZX0ke21ldGFTdHJ9YDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgbG9nKGxldmVsOiBMb2dMZXZlbCwgbGV2ZWxOYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkge1xyXG4gICAgaWYgKGxldmVsID49IHRoaXMubGV2ZWwpIHtcclxuICAgICAgY29uc3QgZm9ybWF0dGVkTWVzc2FnZSA9IHRoaXMuZm9ybWF0TWVzc2FnZShsZXZlbE5hbWUsIG1lc3NhZ2UsIG1ldGEpO1xyXG4gICAgICBcclxuICAgICAgc3dpdGNoIChsZXZlbCkge1xyXG4gICAgICAgIGNhc2UgTG9nTGV2ZWwuRVJST1I6XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGZvcm1hdHRlZE1lc3NhZ2UpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBMb2dMZXZlbC5XQVJOOlxyXG4gICAgICAgICAgY29uc29sZS53YXJuKGZvcm1hdHRlZE1lc3NhZ2UpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBMb2dMZXZlbC5JTkZPOlxyXG4gICAgICAgICAgY29uc29sZS5pbmZvKGZvcm1hdHRlZE1lc3NhZ2UpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBMb2dMZXZlbC5ERUJVRzpcclxuICAgICAgICAgIGNvbnNvbGUuZGVidWcoZm9ybWF0dGVkTWVzc2FnZSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZGVidWcobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSB7XHJcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5ERUJVRywgJ0RFQlVHJywgbWVzc2FnZSwgbWV0YSk7XHJcbiAgfVxyXG5cclxuICBpbmZvKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkge1xyXG4gICAgdGhpcy5sb2coTG9nTGV2ZWwuSU5GTywgJ0lORk8nLCBtZXNzYWdlLCBtZXRhKTtcclxuICB9XHJcblxyXG4gIHdhcm4obWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSB7XHJcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5XQVJOLCAnV0FSTicsIG1lc3NhZ2UsIG1ldGEpO1xyXG4gIH1cclxuXHJcbiAgZXJyb3IobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSB7XHJcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5FUlJPUiwgJ0VSUk9SJywgbWVzc2FnZSwgbWV0YSk7XHJcbiAgfVxyXG5cclxuICBzZXRMZXZlbChsZXZlbDogTG9nTGV2ZWwpIHtcclxuICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKFxyXG4gIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnID8gTG9nTGV2ZWwuREVCVUcgOiBMb2dMZXZlbC5JTkZPXHJcbik7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBsb2dnZXI7XHJcbiJdLCJuYW1lcyI6WyJMb2dMZXZlbCIsIkxvZ2dlciIsImNvbnN0cnVjdG9yIiwibGV2ZWwiLCJmb3JtYXRNZXNzYWdlIiwibWVzc2FnZSIsIm1ldGEiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJtZXRhU3RyIiwiSlNPTiIsInN0cmluZ2lmeSIsImxvZyIsImxldmVsTmFtZSIsImZvcm1hdHRlZE1lc3NhZ2UiLCJjb25zb2xlIiwiZXJyb3IiLCJ3YXJuIiwiaW5mbyIsImRlYnVnIiwic2V0TGV2ZWwiLCJsb2dnZXIiLCJwcm9jZXNzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/utils/logger.ts\n");

/***/ }),

/***/ "(api)/./src/utils/roleUtils.ts":
/*!********************************!*\
  !*** ./src/utils/roleUtils.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CLASS_RANK_ROLES: () => (/* binding */ CLASS_RANK_ROLES),\n/* harmony export */   SYSTEM_ROLES: () => (/* binding */ SYSTEM_ROLES),\n/* harmony export */   getDefaultSystemRole: () => (/* binding */ getDefaultSystemRole),\n/* harmony export */   getEffectiveSystemRole: () => (/* binding */ getEffectiveSystemRole),\n/* harmony export */   isClassRankRole: () => (/* binding */ isClassRankRole),\n/* harmony export */   isSystemRole: () => (/* binding */ isSystemRole),\n/* harmony export */   validateClassRankRole: () => (/* binding */ validateClassRankRole),\n/* harmony export */   validateSystemRole: () => (/* binding */ validateSystemRole)\n/* harmony export */ });\n/**\n * Utility functions for handling user roles and class ranks\n */ // System roles that control permissions and access\nconst SYSTEM_ROLES = [\n    \"ADMIN\",\n    \"EXEC_BOARD\",\n    \"MEMBER\"\n];\n// Class rank roles that are used for Discord role assignment\nconst CLASS_RANK_ROLES = [\n    \"FIRST_YEAR\",\n    \"SECOND_YEAR\",\n    \"THIRD_YEAR\",\n    \"FOURTH_YEAR\",\n    \"ALUMNI_OTHER\"\n];\n/**\n * Check if a role is a system role (ADMIN, EXEC_BOARD, MEMBER)\n */ function isSystemRole(role) {\n    return SYSTEM_ROLES.includes(role);\n}\n/**\n * Check if a role is a class rank role (FIRST_YEAR, SECOND_YEAR, etc.)\n */ function isClassRankRole(role) {\n    return CLASS_RANK_ROLES.includes(role);\n}\n/**\n * Get the default system role for new users\n */ function getDefaultSystemRole() {\n    return \"MEMBER\";\n}\n/**\n * Validate that a role is a valid system role\n * Throws an error if the role is a class rank role\n */ function validateSystemRole(role) {\n    if (isClassRankRole(role)) {\n        throw new Error(`Invalid system role: ${role} is a class rank role, not a system role`);\n    }\n    if (!isSystemRole(role)) {\n        throw new Error(`Invalid system role: ${role}`);\n    }\n    return role;\n}\n/**\n * Validate that a class rank is a valid class rank role\n * Throws an error if the role is a system role\n */ function validateClassRankRole(role) {\n    if (isSystemRole(role)) {\n        throw new Error(`Invalid class rank: ${role} is a system role, not a class rank role`);\n    }\n    if (!isClassRankRole(role)) {\n        throw new Error(`Invalid class rank: ${role}`);\n    }\n    return role;\n}\n/**\n * Get a user's effective system role, ensuring it's not a class rank role\n * If the user has a class rank role, default to MEMBER\n */ function getEffectiveSystemRole(userRole) {\n    if (isSystemRole(userRole)) {\n        return userRole;\n    }\n    // If the user has a class rank role, they should have MEMBER as their system role\n    if (isClassRankRole(userRole)) {\n        return \"MEMBER\";\n    }\n    // Default fallback\n    return \"MEMBER\";\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvdXRpbHMvcm9sZVV0aWxzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBRUE7O0NBRUMsR0FFRCxtREFBbUQ7QUFDNUMsTUFBTUEsZUFBZTtJQUFDO0lBQVM7SUFBYztDQUFTLENBQVU7QUFHdkUsNkRBQTZEO0FBQ3RELE1BQU1DLG1CQUFtQjtJQUFDO0lBQWM7SUFBZTtJQUFjO0lBQWU7Q0FBZSxDQUFVO0FBR3BIOztDQUVDLEdBQ00sU0FBU0MsYUFBYUMsSUFBWTtJQUN2QyxPQUFPSCxhQUFhSSxRQUFRLENBQUNEO0FBQy9CO0FBRUE7O0NBRUMsR0FDTSxTQUFTRSxnQkFBZ0JGLElBQVk7SUFDMUMsT0FBT0YsaUJBQWlCRyxRQUFRLENBQUNEO0FBQ25DO0FBRUE7O0NBRUMsR0FDTSxTQUFTRztJQUNkLE9BQU87QUFDVDtBQUVBOzs7Q0FHQyxHQUNNLFNBQVNDLG1CQUFtQkosSUFBWTtJQUM3QyxJQUFJRSxnQkFBZ0JGLE9BQU87UUFDekIsTUFBTSxJQUFJSyxNQUFNLENBQUMscUJBQXFCLEVBQUVMLEtBQUssd0NBQXdDLENBQUM7SUFDeEY7SUFFQSxJQUFJLENBQUNELGFBQWFDLE9BQU87UUFDdkIsTUFBTSxJQUFJSyxNQUFNLENBQUMscUJBQXFCLEVBQUVMLEtBQUssQ0FBQztJQUNoRDtJQUVBLE9BQU9BO0FBQ1Q7QUFFQTs7O0NBR0MsR0FDTSxTQUFTTSxzQkFBc0JOLElBQVk7SUFDaEQsSUFBSUQsYUFBYUMsT0FBTztRQUN0QixNQUFNLElBQUlLLE1BQU0sQ0FBQyxvQkFBb0IsRUFBRUwsS0FBSyx3Q0FBd0MsQ0FBQztJQUN2RjtJQUVBLElBQUksQ0FBQ0UsZ0JBQWdCRixPQUFPO1FBQzFCLE1BQU0sSUFBSUssTUFBTSxDQUFDLG9CQUFvQixFQUFFTCxLQUFLLENBQUM7SUFDL0M7SUFFQSxPQUFPQTtBQUNUO0FBRUE7OztDQUdDLEdBQ00sU0FBU08sdUJBQXVCQyxRQUFnQjtJQUNyRCxJQUFJVCxhQUFhUyxXQUFXO1FBQzFCLE9BQU9BO0lBQ1Q7SUFFQSxrRkFBa0Y7SUFDbEYsSUFBSU4sZ0JBQWdCTSxXQUFXO1FBQzdCLE9BQU87SUFDVDtJQUVBLG1CQUFtQjtJQUNuQixPQUFPO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tcm0zNjAtYmFja2VuZC8uL3NyYy91dGlscy9yb2xlVXRpbHMudHM/ZDVmZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb2xlIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG4vKipcbiAqIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBoYW5kbGluZyB1c2VyIHJvbGVzIGFuZCBjbGFzcyByYW5rc1xuICovXG5cbi8vIFN5c3RlbSByb2xlcyB0aGF0IGNvbnRyb2wgcGVybWlzc2lvbnMgYW5kIGFjY2Vzc1xuZXhwb3J0IGNvbnN0IFNZU1RFTV9ST0xFUyA9IFsnQURNSU4nLCAnRVhFQ19CT0FSRCcsICdNRU1CRVInXSBhcyBjb25zdDtcbmV4cG9ydCB0eXBlIFN5c3RlbVJvbGUgPSB0eXBlb2YgU1lTVEVNX1JPTEVTW251bWJlcl07XG5cbi8vIENsYXNzIHJhbmsgcm9sZXMgdGhhdCBhcmUgdXNlZCBmb3IgRGlzY29yZCByb2xlIGFzc2lnbm1lbnRcbmV4cG9ydCBjb25zdCBDTEFTU19SQU5LX1JPTEVTID0gWydGSVJTVF9ZRUFSJywgJ1NFQ09ORF9ZRUFSJywgJ1RISVJEX1lFQVInLCAnRk9VUlRIX1lFQVInLCAnQUxVTU5JX09USEVSJ10gYXMgY29uc3Q7XG5leHBvcnQgdHlwZSBDbGFzc1JhbmtSb2xlID0gdHlwZW9mIENMQVNTX1JBTktfUk9MRVNbbnVtYmVyXTtcblxuLyoqXG4gKiBDaGVjayBpZiBhIHJvbGUgaXMgYSBzeXN0ZW0gcm9sZSAoQURNSU4sIEVYRUNfQk9BUkQsIE1FTUJFUilcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzU3lzdGVtUm9sZShyb2xlOiBzdHJpbmcpOiByb2xlIGlzIFN5c3RlbVJvbGUge1xuICByZXR1cm4gU1lTVEVNX1JPTEVTLmluY2x1ZGVzKHJvbGUgYXMgU3lzdGVtUm9sZSk7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYSByb2xlIGlzIGEgY2xhc3MgcmFuayByb2xlIChGSVJTVF9ZRUFSLCBTRUNPTkRfWUVBUiwgZXRjLilcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzQ2xhc3NSYW5rUm9sZShyb2xlOiBzdHJpbmcpOiByb2xlIGlzIENsYXNzUmFua1JvbGUge1xuICByZXR1cm4gQ0xBU1NfUkFOS19ST0xFUy5pbmNsdWRlcyhyb2xlIGFzIENsYXNzUmFua1JvbGUpO1xufVxuXG4vKipcbiAqIEdldCB0aGUgZGVmYXVsdCBzeXN0ZW0gcm9sZSBmb3IgbmV3IHVzZXJzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0U3lzdGVtUm9sZSgpOiBTeXN0ZW1Sb2xlIHtcbiAgcmV0dXJuICdNRU1CRVInO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYSByb2xlIGlzIGEgdmFsaWQgc3lzdGVtIHJvbGVcbiAqIFRocm93cyBhbiBlcnJvciBpZiB0aGUgcm9sZSBpcyBhIGNsYXNzIHJhbmsgcm9sZVxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVTeXN0ZW1Sb2xlKHJvbGU6IHN0cmluZyk6IFN5c3RlbVJvbGUge1xuICBpZiAoaXNDbGFzc1JhbmtSb2xlKHJvbGUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHN5c3RlbSByb2xlOiAke3JvbGV9IGlzIGEgY2xhc3MgcmFuayByb2xlLCBub3QgYSBzeXN0ZW0gcm9sZWApO1xuICB9XG4gIFxuICBpZiAoIWlzU3lzdGVtUm9sZShyb2xlKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzeXN0ZW0gcm9sZTogJHtyb2xlfWApO1xuICB9XG4gIFxuICByZXR1cm4gcm9sZTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IGEgY2xhc3MgcmFuayBpcyBhIHZhbGlkIGNsYXNzIHJhbmsgcm9sZVxuICogVGhyb3dzIGFuIGVycm9yIGlmIHRoZSByb2xlIGlzIGEgc3lzdGVtIHJvbGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQ2xhc3NSYW5rUm9sZShyb2xlOiBzdHJpbmcpOiBDbGFzc1JhbmtSb2xlIHtcbiAgaWYgKGlzU3lzdGVtUm9sZShyb2xlKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBjbGFzcyByYW5rOiAke3JvbGV9IGlzIGEgc3lzdGVtIHJvbGUsIG5vdCBhIGNsYXNzIHJhbmsgcm9sZWApO1xuICB9XG4gIFxuICBpZiAoIWlzQ2xhc3NSYW5rUm9sZShyb2xlKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBjbGFzcyByYW5rOiAke3JvbGV9YCk7XG4gIH1cbiAgXG4gIHJldHVybiByb2xlO1xufVxuXG4vKipcbiAqIEdldCBhIHVzZXIncyBlZmZlY3RpdmUgc3lzdGVtIHJvbGUsIGVuc3VyaW5nIGl0J3Mgbm90IGEgY2xhc3MgcmFuayByb2xlXG4gKiBJZiB0aGUgdXNlciBoYXMgYSBjbGFzcyByYW5rIHJvbGUsIGRlZmF1bHQgdG8gTUVNQkVSXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRFZmZlY3RpdmVTeXN0ZW1Sb2xlKHVzZXJSb2xlOiBzdHJpbmcpOiBTeXN0ZW1Sb2xlIHtcbiAgaWYgKGlzU3lzdGVtUm9sZSh1c2VyUm9sZSkpIHtcbiAgICByZXR1cm4gdXNlclJvbGU7XG4gIH1cbiAgXG4gIC8vIElmIHRoZSB1c2VyIGhhcyBhIGNsYXNzIHJhbmsgcm9sZSwgdGhleSBzaG91bGQgaGF2ZSBNRU1CRVIgYXMgdGhlaXIgc3lzdGVtIHJvbGVcbiAgaWYgKGlzQ2xhc3NSYW5rUm9sZSh1c2VyUm9sZSkpIHtcbiAgICByZXR1cm4gJ01FTUJFUic7XG4gIH1cbiAgXG4gIC8vIERlZmF1bHQgZmFsbGJhY2tcbiAgcmV0dXJuICdNRU1CRVInO1xufVxuIl0sIm5hbWVzIjpbIlNZU1RFTV9ST0xFUyIsIkNMQVNTX1JBTktfUk9MRVMiLCJpc1N5c3RlbVJvbGUiLCJyb2xlIiwiaW5jbHVkZXMiLCJpc0NsYXNzUmFua1JvbGUiLCJnZXREZWZhdWx0U3lzdGVtUm9sZSIsInZhbGlkYXRlU3lzdGVtUm9sZSIsIkVycm9yIiwidmFsaWRhdGVDbGFzc1JhbmtSb2xlIiwiZ2V0RWZmZWN0aXZlU3lzdGVtUm9sZSIsInVzZXJSb2xlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/utils/roleUtils.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fevents&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fevents%2Findex.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();